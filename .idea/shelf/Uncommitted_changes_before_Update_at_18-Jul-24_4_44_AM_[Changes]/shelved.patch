Index: src/java/controller/user/UserDashboardController.java
===================================================================
diff --git a/src/java/controller/user/UserDashboardController.java b/src/java/controller/user/UserDashboardController.java
deleted file mode 100644
--- a/src/java/controller/user/UserDashboardController.java	(revision d6ad1445e1c07c5da0ab8951156084fe4a182d1f)
+++ /dev/null	(revision d6ad1445e1c07c5da0ab8951156084fe4a182d1f)
@@ -1,79 +0,0 @@
-/*
- * Click nbfs://nbhost/SystemFileSystem/Templates/Licenses/license-default.txt to change this license
- * Click nbfs://nbhost/SystemFileSystem/Templates/JSP_Servlet/Servlet.java to edit this template
- */
-
-package controller.user;
-
-import java.io.IOException;
-import java.io.PrintWriter;
-
-import jakarta.servlet.ServletException;
-import jakarta.servlet.http.HttpServlet;
-import jakarta.servlet.http.HttpServletRequest;
-import jakarta.servlet.http.HttpServletResponse;
-
-/**
- * @author PC
- */
-public class UserDashboardController extends HttpServlet {
-
-    /**
-     * Processes requests for both HTTP <code>GET</code> and <code>POST</code> methods.
-     *
-     * @param request  servlet request
-     * @param response servlet response
-     * @throws ServletException if a servlet-specific error occurs
-     * @throws IOException      if an I/O error occurs
-     */
-    protected void processRequest(HttpServletRequest request, HttpServletResponse response)
-            throws ServletException, IOException {
-        response.setContentType("text/html;charset=UTF-8");
-        try {
-            request.getRequestDispatcher("/user-dashboard.jsp").forward(request, response);
-        } catch (ServletException | IOException e) {
-            throw new RuntimeException(e);
-        }
-    }
-
-    // <editor-fold defaultstate="collapsed" desc="HttpServlet methods. Click on the + sign on the left to edit the code.">
-
-    /**
-     * Handles the HTTP <code>GET</code> method.
-     *
-     * @param request  servlet request
-     * @param response servlet response
-     * @throws ServletException if a servlet-specific error occurs
-     * @throws IOException      if an I/O error occurs
-     */
-    @Override
-    protected void doGet(HttpServletRequest request, HttpServletResponse response)
-            throws ServletException, IOException {
-        processRequest(request, response);
-    }
-
-    /**
-     * Handles the HTTP <code>POST</code> method.
-     *
-     * @param request  servlet request
-     * @param response servlet response
-     * @throws ServletException if a servlet-specific error occurs
-     * @throws IOException      if an I/O error occurs
-     */
-    @Override
-    protected void doPost(HttpServletRequest request, HttpServletResponse response)
-            throws ServletException, IOException {
-        processRequest(request, response);
-    }
-
-    /**
-     * Returns a short description of the servlet.
-     *
-     * @return a String containing servlet description
-     */
-    @Override
-    public String getServletInfo() {
-        return "Short description";
-    }// </editor-fold>
-
-}
Index: src/java/controller/material/MaterialServlet.java
===================================================================
diff --git a/src/java/controller/material/MaterialServlet.java b/src/java/controller/material/MaterialServlet.java
deleted file mode 100644
--- a/src/java/controller/material/MaterialServlet.java	(revision d6ad1445e1c07c5da0ab8951156084fe4a182d1f)
+++ /dev/null	(revision d6ad1445e1c07c5da0ab8951156084fe4a182d1f)
@@ -1,124 +0,0 @@
-package controller.material;
-
-import common.FileHandler;
-import dal.MaterialDAO;
-import java.io.IOException;
-import java.io.PrintWriter;
-import jakarta.servlet.ServletException;
-import jakarta.servlet.annotation.MultipartConfig;
-import jakarta.servlet.annotation.WebServlet;
-import jakarta.servlet.http.HttpServlet;
-import jakarta.servlet.http.HttpServletRequest;
-import jakarta.servlet.http.HttpServletResponse;
-import jakarta.servlet.http.HttpSession;
-import jakarta.servlet.http.Part;
-import java.sql.SQLException;
-import model.user.User;
-
-@MultipartConfig
-@WebServlet(name = "MaterialServlet", urlPatterns = {"/material", "/material/new"})
-public class MaterialServlet extends HttpServlet {
-
-    protected void processRequest(HttpServletRequest request, HttpServletResponse response)
-            throws ServletException, IOException {
-        response.setContentType("text/html;charset=UTF-8");
-        try (PrintWriter out = response.getWriter()) {
-            /* TODO output your page here. You may use following sample code. */
-            out.println("<!DOCTYPE html>");
-            out.println("<html>");
-            out.println("<head>");
-            out.println("<title>Servlet MaterialServlet</title>");
-            out.println("</head>");
-            out.println("<body>");
-            out.println("<h1>Servlet MaterialServlet at " + request.getContextPath() + "</h1>");
-            out.println("</body>");
-            out.println("</html>");
-        }
-    }
-
-    MaterialDAO materialDAO = new MaterialDAO();
-    FileHandler fileHandler;
-
-    void refreshSession(HttpServletRequest request) {
-        HttpSession session = request.getSession();
-        session.setAttribute("user", session.getAttribute("user"));
-    }
-
-    private String getWorkingDir() {
-        String directory = getServletContext().getRealPath("") + "";
-        return directory.replace("\\build\\web\\", "\\web\\");
-    }
-
-    @Override
-    protected void doGet(HttpServletRequest request, HttpServletResponse response)
-            throws ServletException, IOException {
-        doPost(request, response);
-    }
-
-    @Override
-    protected void doPost(HttpServletRequest request, HttpServletResponse response)
-            throws ServletException, IOException {
-        /*
-        HttpSession session = request.getSession();
-        User user = (User) session.getAttribute("user");
-        if (user == null) {
-            response.sendRedirect(request.getContextPath() + "/login.jsp");
-        } else if (user.getRole() != 0) {
-            response.sendRedirect("../home");
-        } else {
-            refreshSession(request);
-         */
-        String action = request.getServletPath();
-        System.out.println(action);
-        switch (action) {
-            case "/material":
-                viewMaterialList(request, response);
-                break;
-            case "/material/new":
-                addNewMaterial(request, response);
-                break;
-        }
-
-    }
-    //}
-
-    private void addNewMaterial(HttpServletRequest request, HttpServletResponse response)
-            throws IOException, ServletException {
-        Part filePart = request.getPart("newmaterial");
-        String workingDir = getWorkingDir();
-        String workingFolder = "assets\\material";
-        int lessonId = Integer.parseInt(request.getParameter("lessonid"));
-        fileHandler = new FileHandler(workingFolder);
-
-        String uri = fileHandler.fileUpload(workingDir, filePart);
-
-        try {
-            materialDAO.insertMaterial(uri, lessonId);
-        } catch (SQLException e) {
-            System.out.println(e.getMessage());
-        }
-
-        request.setAttribute("lessonid", lessonId);
-        response.sendRedirect("../material");
-
-    }
-
-    private void viewMaterialList(HttpServletRequest request, HttpServletResponse response)
-            throws ServletException, IOException {
-
-        String workingDir = getWorkingDir();
-
-        int lessonId = Integer.parseInt(request.getParameter("lessonid"));
-        System.out.println(lessonId);
-
-        request.setAttribute("list", materialDAO.getAllMaterialOfALesson(lessonId, workingDir));
-        request.setAttribute("lessonid", lessonId);
-        request.getRequestDispatcher("/WEB-INF/views/material/materiallist.jsp").forward(request, response);
-    }
-
-    @Override
-    public String getServletInfo() {
-        return "Short description";
-    }// </editor-fold>
-
-}
Index: web/WEB-INF/views/material/materiallist.jsp
===================================================================
diff --git a/web/WEB-INF/views/material/materiallist.jsp b/web/WEB-INF/views/material/materiallist.jsp
deleted file mode 100644
--- a/web/WEB-INF/views/material/materiallist.jsp	(revision d6ad1445e1c07c5da0ab8951156084fe4a182d1f)
+++ /dev/null	(revision d6ad1445e1c07c5da0ab8951156084fe4a182d1f)
@@ -1,235 +0,0 @@
-<%@page isELIgnored="false" %>
-<%@taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
-<%@page contentType="text/html" pageEncoding="UTF-8"%>
-<html
-    lang="en"
-    class="light-style layout-menu-fixed layout-compact"
-    dir="ltr"
-    data-theme="theme-default"
-    data-assets-path="../assets/"
-    data-template="vertical-menu-template-free">
-    <head>
-        <meta charset="utf-8" />
-        <meta
-            name="viewport"
-            content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0" />
-
-        <title>Lesson list</title>
-
-        <meta name="description" content="" />
-
-        <!-- Favicon -->
-        <link rel="icon" type="image/x-icon" href="../assets/img/favicon/favicon.ico" />
-
-        <!-- Fonts -->
-        <link rel="preconnect" href="https://fonts.googleapis.com" />
-        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
-        <link
-            href="https://fonts.googleapis.com/css2?family=Public+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&display=swap"
-            rel="stylesheet" />
-
-        <link rel="stylesheet" href="../assets/vendor/fonts/boxicons.css" />
-
-        <!-- Core CSS -->
-        <link rel="stylesheet" href="../assets/vendor/css/core.css" class="template-customizer-core-css" />
-        <link rel="stylesheet" href="../assets/vendor/css/theme-default.css" class="template-customizer-theme-css" />
-        <link rel="stylesheet" href="../assets/css/demo.css" />
-
-        <!-- Vendors CSS -->
-        <link rel="stylesheet" href="../assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.css" />
-        <link rel="stylesheet" href="../assets/vendor/libs/apex-charts/apex-charts.css" />
-
-        <!-- Page CSS -->
-
-        <!-- Favicon -->
-        <link href="../img/favicon.ico" rel="icon">
-
-        <!-- Google Web Fonts -->
-        <link rel="preconnect" href="https://fonts.gstatic.com">
-        <link href="https://fonts.googleapis.com/css2?family=Jost:wght@500;600;700&family=Open+Sans:wght@400;600&display=swap" rel="stylesheet"> 
-
-        <!-- Font Awesome -->
-        <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css" rel="stylesheet">
-
-        <!-- Libraries Stylesheet -->
-        <link href="../lib/owlcarousel/assets/owl.carousel.min.css" rel="stylesheet">
-
-        <!-- Customized Bootstrap Stylesheet -->
-        <link href="../css/style.css" rel="stylesheet">
-
-        <!-- Helpers -->
-        <script src="../assets/vendor/js/helpers.js"></script>
-        <!--! Template customizer & Theme config files MUST be included after core stylesheets and helpers.js in the <head> section -->
-        <!--? Config:  Mandatory theme config file contain global vars & default theme options, Set your preferred theme option in this file.  -->
-        <script src="../assets/js/config.js"></script>
-    </head>
-
-    <body>
-        <!-- Layout wrapper -->
-        <div class="layout-wrapper layout-content-navbar">
-            <div class="layout-container">
-                <!-- Menu -->
-
-                <aside id="layout-menu" class="layout-menu menu-vertical menu bg-menu-theme">
-                    <div class="app-brand demo">
-                        <a href="${pageContext.request.contextPath}/home" class="app-brand-link">
-                            <h1 class="m-0 text-uppercase text-primary"><i class="fa fa-book-reader mr-3"></i>KRS</h1>
-                        </a>
-
-                        <a href="javascript:void(0);" class="layout-menu-toggle menu-link text-large ms-auto d-block d-xl-none">
-                            <i class="bx bx-chevron-left bx-sm align-middle"></i>
-                        </a>
-                    </div>
-
-                    <div class="menu-inner-shadow"></div>
-
-                    <ul class="menu-inner py-1">
-
-                        <li class="menu-header small text-uppercase">
-                            <span class="menu-header-text">Administration</span>
-                        </li>
-                        <!-- Apps -->
-                        <li class="menu-item">
-                            <a href="${pageContext.request.contextPath}/userlist" class="menu-link">
-                                <i class="menu-icon tf-icons bx bx-user"></i>
-                                <div data-i18n="User list">User list</div>
-                            </a>
-                        </li>
-                        <li class="menu-item">
-                            <a href="${pageContext.request.contextPath}/subjectlist" class="menu-link">
-                                <i class="menu-icon tf-icons bx bx-book-open"></i>
-                                <div data-i18n="Subject list">Subject list</div>
-                            </a>
-                        </li>
-                        <li class="menu-item">
-                            <a href="${pageContext.request.contextPath}/classlist" class="menu-link">
-                                <i class="menu-icon tf-icons bx bx-chalkboard"></i>
-                                <div data-i18n="Class list">Class list</div>
-                            </a>
-                        </li>
-
-                        <li class="menu-header small text-uppercase">
-                            <span class="menu-header-text">Navigation</span>
-                        </li>
-
-                        <li class="menu-item">
-                            <a href="${pageContext.request.contextPath}/home" class="menu-link">
-                                <i class="menu-icon tf-icons bx bx-home"></i>
-                                <div data-i18n="Home">Home</div>
-                            </a>
-                        </li>
-
-                        <li class="menu-item">
-                            <a href="${pageContext.request.contextPath}/dashboard.jsp" class="menu-link">
-                                <i class="menu-icon tf-icons bx bx-bar-chart"></i>
-                                <div data-i18n="Dashboard">Dashboard</div>
-                            </a>
-                        </li>
-
-                    </ul>
-                </aside>
-                <!-- / Menu -->
-
-                <!-- Layout container -->
-                <div class="layout-page">
-
-                    <!-- Content wrapper -->
-                    <div class="content-wrapper">
-                        <!-- Content -->
-                        <jsp:include page="/WEB-INF/common/header.jsp"/>
-
-                        <div class="container-xxl flex-grow-1 container-p-y">
-
-                            <div>
-                                <form action="${pageContext.request.contextPath}/material/new" method="post" enctype="multipart/form-data">
-                                    <input type="hidden" name="lessonid" value="${requestScope.lessonid}"/>
-                                    <input style="width: 300px;" type="file" name="newmaterial" />
-                                    <button class="btn btn-primary px-3">
-                                        <i class="fa fa-plus-square mr-3"></i>
-                                        Add material
-                                    </button>
-                                </form>
-                            </div>
-
-                            <h4 class="py-3 mb-4"><span class="text-muted fw-light">Material /</span> Material list</h4>
-
-                            <!-- Basic Bootstrap Table -->
-                            <div class="card">
-                                <h5 class="card-header">Lesson list for ${requestScope.subject.code}</h5>
-                                <div class="table-responsive text-nowrap">
-                                    <table class="table">
-                                        <thead>
-                                            <tr>
-                                                <th>#</th>
-                                                <th>Name</th>
-                                                <th></th>
-                                            </tr>
-                                        </thead>
-                                        <tbody class="table-border-bottom-0">
-                                            <c:forEach items="${requestScope.list}" var="material">
-                                                <tr>
-                                                    <td>${material.id}</td>
-                                                    <td>
-                                                        <a href="${material.webUri}" download="${material.name}">
-                                                            ${material.name}
-                                                        </a>
-                                                    </td>
-                                                    <td>
-                                                        <i class="bx bx-trash"></i>
-                                                    </td>
-                                                </tr>
-                                            </c:forEach>
-                                        </tbody>
-                                    </table>
-                                </div>
-                            </div>
-                            <!--/ Basic Bootstrap Table -->
-
-                        </div>
-                        <!-- / Content -->
-
-                        <jsp:include page="/WEB-INF/common/footer.jsp"/>
-                    </div>
-                    <!-- Content wrapper -->
-
-
-                </div>
-                <!-- / Layout page -->
-            </div>
-        </div>
-        <!-- / Layout wrapper -->
-
-        <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
-        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.bundle.min.js"></script>
-        <script src="../lib/easing/easing.min.js"></script>
-        <script src="../lib/waypoints/waypoints.min.js"></script>
-        <script src="../lib/counterup/counterup.min.js"></script>
-        <script src="../lib/owlcarousel/owl.carousel.min.js"></script>
-
-        <!-- Template Javascript -->
-        <script src="../js/main.js"></script>
-
-        <!-- Core JS -->
-        <!-- build:js assets/vendor/js/core.js -->
-
-        <script src="../assets/vendor/libs/jquery/jquery.js"></script>
-        <script src="../assets/vendor/libs/popper/popper.js"></script>
-        <script src="../assets/vendor/js/bootstrap.js"></script>
-        <script src="../assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.js"></script>
-        <script src="../assets/vendor/js/menu.js"></script>
-
-        <!-- endbuild -->
-
-        <!-- Vendors JS -->
-        <script src="../assets/vendor/libs/apex-charts/apexcharts.js"></script>
-
-        <!-- Main JS -->
-        <script src="../assets/js/main.js"></script>
-
-        <!-- Page JS -->
-        <script src="assets/js/dashboards-analytics.js"></script>
-
-        <!-- Place this tag in your head or just before your close body tag. -->
-        <script async defer src="https://buttons.github.io/buttons.js"></script>
-    </body>
-</html>
Index: web/WEB-INF/views/lesson/newlesson.jsp
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><%@page isELIgnored=\"false\" %>\r\n<%@taglib prefix=\"c\" uri=\"http://java.sun.com/jsp/jstl/core\" %>\r\n<%@page contentType=\"text/html\" pageEncoding=\"UTF-8\"%>\r\n<html\r\n    lang=\"en\"\r\n    class=\"light-style layout-menu-fixed layout-compact\"\r\n    dir=\"ltr\"\r\n    data-theme=\"theme-default\"\r\n    data-assets-path=\"../assets/\"\r\n    data-template=\"vertical-menu-template-free\">\r\n    <head>\r\n        <meta charset=\"utf-8\" />\r\n        <meta\r\n            name=\"viewport\"\r\n            content=\"width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0\" />\r\n\r\n        <title>New lesson</title>\r\n\r\n        <meta name=\"description\" content=\"\" />\r\n\r\n        <!-- Favicon -->\r\n        <link rel=\"icon\" type=\"image/x-icon\" href=\"../assets/img/favicon/favicon.ico\" />\r\n\r\n        <!-- Fonts -->\r\n        <link rel=\"preconnect\" href=\"https://fonts.googleapis.com\" />\r\n        <link rel=\"preconnect\" href=\"https://fonts.gstatic.com\" crossorigin />\r\n        <link\r\n            href=\"https://fonts.googleapis.com/css2?family=Public+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&display=swap\"\r\n            rel=\"stylesheet\" />\r\n\r\n        <link rel=\"stylesheet\" href=\"../assets/vendor/fonts/boxicons.css\" />\r\n\r\n        <!-- Core CSS -->\r\n        <link rel=\"stylesheet\" href=\"../assets/vendor/css/core.css\" class=\"template-customizer-core-css\" />\r\n        <link rel=\"stylesheet\" href=\"../assets/vendor/css/theme-default.css\" class=\"template-customizer-theme-css\" />\r\n        <link rel=\"stylesheet\" href=\"../assets/css/demo.css\" />\r\n\r\n        <!-- Vendors CSS -->\r\n        <link rel=\"stylesheet\" href=\"../assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.css\" />\r\n        <link rel=\"stylesheet\" href=\"../assets/vendor/libs/apex-charts/apex-charts.css\" />\r\n\r\n        <!-- Page CSS -->\r\n\r\n        <!-- Favicon -->\r\n        <link href=\"../img/favicon.ico\" rel=\"icon\">\r\n\r\n        <!-- Google Web Fonts -->\r\n        <link rel=\"preconnect\" href=\"https://fonts.gstatic.com\">\r\n        <link href=\"https://fonts.googleapis.com/css2?family=Jost:wght@500;600;700&family=Open+Sans:wght@400;600&display=swap\" rel=\"stylesheet\"> \r\n\r\n        <!-- Font Awesome -->\r\n        <link href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css\" rel=\"stylesheet\">\r\n\r\n        <!-- Libraries Stylesheet -->\r\n        <link href=\"../lib/owlcarousel/assets/owl.carousel.min.css\" rel=\"stylesheet\">\r\n\r\n        <!-- Customized Bootstrap Stylesheet -->\r\n        <link href=\"../css/style.css\" rel=\"stylesheet\">\r\n\r\n        <!-- Helpers -->\r\n        <script src=\"../assets/vendor/js/helpers.js\"></script>\r\n        <!--! Template customizer & Theme config files MUST be included after core stylesheets and helpers.js in the <head> section -->\r\n        <!--? Config:  Mandatory theme config file contain global vars & default theme options, Set your preferred theme option in this file.  -->\r\n        <script src=\"../assets/js/config.js\"></script>\r\n\r\n\r\n    </head>\r\n\r\n    <body>\r\n        <!-- Layout wrapper -->\r\n        <div class=\"layout-wrapper layout-content-navbar\">\r\n            <div class=\"layout-container\">\r\n                <!-- Menu -->\r\n\r\n                <jsp:include page=\"/WEB-INF/common/sider.jsp\"/>\r\n                <!-- / Menu -->\r\n\r\n                <!-- Layout container -->\r\n                <div class=\"layout-page\">\r\n\r\n                    <!-- Content wrapper -->\r\n                    <div class=\"content-wrapper\">\r\n                        <!-- Content -->\r\n                        <jsp:include page=\"/WEB-INF/common/header.jsp\"/>\r\n\r\n                        <div class=\"container-xxl flex-grow-1 container-p-y\">\r\n\r\n\r\n                            <h4 class=\"py-3 mb-4\"><span class=\"text-muted fw-light\">Lesson /</span> New lesson</h4>\r\n                            <form action=\"${pageContext.request.contextPath}/lesson/insert\">\r\n                                <input type=\"hidden\" name=\"action\" value=\"addNew\"/>\r\n                                <label for=\"subjectSelect\">Subject: </label>\r\n                                <select name=\"subjectId\" id=\"subjectSelect\" class=\"ml-2\">\r\n                                    <c:forEach items=\"${requestScope.subjectList}\" var=\"subject\">\r\n                                        <c:if test=\"${requestScope.subject.id == subject.id}\">\r\n                                            <option value=\"${subject.id}\" selected>${subject.code}</option>\r\n                                        </c:if>\r\n                                        <c:if test=\"${requestScope.subject.id != subject.id}\">\r\n                                            <option value=\"${subject.id}\">${subject.code}</option>\r\n                                        </c:if>\r\n                                    </c:forEach>\r\n                                </select>\r\n                                <div class=\"col-xxl\">\r\n                                    <div class=\"card mb-4\">\r\n                                        <div class=\"card-header d-flex align-items-center justify-content-between mb-3\">\r\n                                            <small class=\"text-muted float-end\">Input subject name and materials</small>\r\n                                        </div>\r\n                                        <div class=\"card-body\">\r\n                                            <div class=\"row mb-3\">\r\n                                                <label class=\"col-sm-2 col-form-label\" for=\"basic-icon-default-fullname\">Name</label>\r\n                                                <div class=\"col-sm-10\">\r\n                                                    <div class=\"input-group input-group-merge\">\r\n                                                        <span id=\"basic-icon-default-fullname2\" class=\"input-group-text\">\r\n                                                            <i class=\"bx bx-rename\"></i></span>\r\n                                                        <input\r\n                                                            type=\"text\"\r\n                                                            class=\"form-control\"\r\n                                                            id=\"basic-icon-default-fullname\"\r\n                                                            name=\"name\"\r\n                                                            placeholder=\"Subject name\"\r\n                                                            aria-label=\"Subject name\"\r\n                                                            aria-describedby=\"basic-icon-default-fullname2\" \r\n                                                            value=\"${requestScope.name}\"/>\r\n                                                    </div>\r\n                                                </div>\r\n                                            </div>\r\n                                            <c:if test=\"${requestScope.err != null && !requestScope.err.isEmpty()}\">\r\n                                                <div class=\"row mb-3\">\r\n                                                    <div class=\"col-sm-2\"></div>\r\n                                                    <div class=\"col-sm-10\">\r\n                                                        <h6 style=\"color: red;\">${requestScope.err}</h6>\r\n                                                    </div>\r\n                                                </div>\r\n                                            </c:if>\r\n                                            <div class=\"row justify-content-end\">\r\n                                                <div class=\"col-sm-10\">\r\n                                                    <button type=\"submit\" class=\"btn btn-primary\">Add lesson</button>\r\n                                                </div>\r\n                                            </div>\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n                            </form>\r\n                            <hr class=\"my-5\" />\r\n\r\n                        </div>\r\n                        <!-- / Content -->\r\n\r\n                        <div class=\"content-backdrop fade\"></div>\r\n                        <jsp:include page=\"/WEB-INF/common/footer.jsp\"/>\r\n                    </div>\r\n                    <!-- Content wrapper -->\r\n\r\n\r\n                </div>\r\n                <!-- / Layout page -->\r\n            </div>\r\n        </div>\r\n        <!-- / Layout wrapper -->\r\n\r\n        <script src=\"https://code.jquery.com/jquery-3.4.1.min.js\"></script>\r\n        <script src=\"https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.bundle.min.js\"></script>\r\n        <script src=\"../lib/easing/easing.min.js\"></script>\r\n        <script src=\"../lib/waypoints/waypoints.min.js\"></script>\r\n        <script src=\"../lib/counterup/counterup.min.js\"></script>\r\n        <script src=\"../lib/owlcarousel/owl.carousel.min.js\"></script>\r\n\r\n        <!-- Template Javascript -->\r\n        <script src=\"../js/main.js\"></script>\r\n\r\n        <!-- Core JS -->\r\n        <!-- build:js ../assets/vendor/js/core.js -->\r\n\r\n        <script src=\"../assets/vendor/libs/jquery/jquery.js\"></script>\r\n        <script src=\"../assets/vendor/libs/popper/popper.js\"></script>\r\n        <script src=\"../assets/vendor/js/bootstrap.js\"></script>\r\n        <script src=\"../assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.js\"></script>\r\n        <script src=\"../assets/vendor/js/menu.js\"></script>\r\n\r\n        <!-- endbuild -->\r\n\r\n        <!-- Vendors JS -->\r\n        <script src=\"../assets/vendor/libs/apex-charts/apexcharts.js\"></script>\r\n\r\n        <!-- Main JS -->\r\n        <script src=\"../assets/js/main.js\"></script>\r\n\r\n        <!-- Page JS -->\r\n        <script src=\"../assets/js/dashboards-analytics.js\"></script>\r\n\r\n        <!-- Place this tag in your head or just before your close body tag. -->\r\n        <script async defer src=\"https://buttons.github.io/buttons.js\"></script>\r\n    </body>\r\n</html>\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/web/WEB-INF/views/lesson/newlesson.jsp b/web/WEB-INF/views/lesson/newlesson.jsp
--- a/web/WEB-INF/views/lesson/newlesson.jsp	(revision d6ad1445e1c07c5da0ab8951156084fe4a182d1f)
+++ b/web/WEB-INF/views/lesson/newlesson.jsp	(date 1721252670161)
@@ -143,6 +143,8 @@
                             </form>
                             <hr class="my-5" />
 
+                            <a href="${pageContext.request.contextPath}/lesson" class="btn btn-primary">Back</a>
+
                         </div>
                         <!-- / Content -->
 
Index: web/WEB-INF/views/lesson/lessonlist.jsp
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><%@page isELIgnored=\"false\" %>\r\n<%@taglib prefix=\"c\" uri=\"http://java.sun.com/jsp/jstl/core\" %>\r\n<%@page contentType=\"text/html\" pageEncoding=\"UTF-8\"%>\r\n<html\r\n    lang=\"en\"\r\n    class=\"light-style layout-menu-fixed layout-compact\"\r\n    dir=\"ltr\"\r\n    data-theme=\"theme-default\"\r\n    data-assets-path=\"./assets/\"\r\n    data-template=\"vertical-menu-template-free\">\r\n    <head>\r\n        <meta charset=\"utf-8\" />\r\n        <meta\r\n            name=\"viewport\"\r\n            content=\"width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0\" />\r\n\r\n        <title>Lesson list</title>\r\n\r\n        <meta name=\"description\" content=\"\" />\r\n\r\n        <!-- Favicon -->\r\n        <link rel=\"icon\" type=\"image/x-icon\" href=\"./assets/img/favicon/favicon.ico\" />\r\n\r\n        <!-- Fonts -->\r\n        <link rel=\"preconnect\" href=\"https://fonts.googleapis.com\" />\r\n        <link rel=\"preconnect\" href=\"https://fonts.gstatic.com\" crossorigin />\r\n        <link\r\n            href=\"https://fonts.googleapis.com/css2?family=Public+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&display=swap\"\r\n            rel=\"stylesheet\" />\r\n\r\n        <link rel=\"stylesheet\" href=\"./assets/vendor/fonts/boxicons.css\" />\r\n\r\n        <!-- Core CSS -->\r\n        <link rel=\"stylesheet\" href=\"./assets/vendor/css/core.css\" class=\"template-customizer-core-css\" />\r\n        <link rel=\"stylesheet\" href=\"./assets/vendor/css/theme-default.css\" class=\"template-customizer-theme-css\" />\r\n        <link rel=\"stylesheet\" href=\"./assets/css/demo.css\" />\r\n\r\n        <!-- Vendors CSS -->\r\n        <link rel=\"stylesheet\" href=\"./assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.css\" />\r\n        <link rel=\"stylesheet\" href=\"./assets/vendor/libs/apex-charts/apex-charts.css\" />\r\n\r\n        <!-- Page CSS -->\r\n\r\n        <!-- Favicon -->\r\n        <link href=\"./img/favicon.ico\" rel=\"icon\">\r\n\r\n        <!-- Google Web Fonts -->\r\n        <link rel=\"preconnect\" href=\"https://fonts.gstatic.com\">\r\n        <link href=\"https://fonts.googleapis.com/css2?family=Jost:wght@500;600;700&family=Open+Sans:wght@400;600&display=swap\" rel=\"stylesheet\"> \r\n\r\n        <!-- Font Awesome -->\r\n        <link href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css\" rel=\"stylesheet\">\r\n\r\n        <!-- Libraries Stylesheet -->\r\n        <link href=\"./lib/owlcarousel/assets/owl.carousel.min.css\" rel=\"stylesheet\">\r\n\r\n        <!-- Customized Bootstrap Stylesheet -->\r\n        <link href=\"./css/style.css\" rel=\"stylesheet\">\r\n\r\n        <!-- Helpers -->\r\n        <script src=\"./assets/vendor/js/helpers.js\"></script>\r\n        <!--! Template customizer & Theme config files MUST be included after core stylesheets and helpers.js in the <head> section -->\r\n        <!--? Config:  Mandatory theme config file contain global vars & default theme options, Set your preferred theme option in this file.  -->\r\n        <script src=\"./assets/js/config.js\"></script>\r\n    </head>\r\n\r\n    <body>\r\n        <!-- Layout wrapper -->\r\n        <div class=\"layout-wrapper layout-content-navbar\">\r\n            <div class=\"layout-container\">\r\n                <!-- Menu -->\r\n\r\n                <jsp:include page=\"/WEB-INF/common/sider.jsp\"/>\r\n                <!-- / Menu -->\r\n\r\n                <!-- Layout container -->\r\n                <div class=\"layout-page\">\r\n\r\n                    <!-- Content wrapper -->\r\n                    <div class=\"content-wrapper\">\r\n                        <!-- Content -->\r\n                        <jsp:include page=\"/WEB-INF/common/header.jsp\"/>\r\n\r\n                        <div class=\"container-xxl flex-grow-1 container-p-y\">\r\n\r\n                            <div>\r\n                                <form action=\"${pageContext.request.contextPath}/lesson/new\">\r\n                                    <input type=\"hidden\" name=\"subjectid\" value=\"${requestScope.subject.id}\"/>\r\n                                    <input type=\"hidden\" name=\"action\" value=\"goToPage\"/>\r\n                                    <button class=\"btn btn-primary px-3\">\r\n                                        <i class=\"fa fa-plus-square mr-3\"></i>\r\n                                        Add lesson\r\n                                    </button>\r\n                                </form>\r\n                            </div>\r\n\r\n                            <h4 class=\"py-3 mb-4\"><span class=\"text-muted fw-light\">Lesson /</span> Lesson list</h4>\r\n\r\n                            <form id=\"searchBar\" class=\"d-flex\" action=\"${pageContext.request.contextPath}/lesson\">\r\n                                <div class=\"input-group mr-3\" style=\"width: 500px; overflow: auto;\">\r\n                                    <label for=\"subjectselect\">Subject: </label>\r\n                                    <select name=\"subjectId\" id=\"subjectselect\" class=\"mr-3 ml-3\" \r\n                                            onchange=\"document.getElementById('searchBar').submit();\"\r\n                                            onmousedown=\"if (this.options.length > 5) {\r\n                                                        this.size = 5;\r\n                                                    }\"  \r\n                                            onblur=\"this.size = 0;\">\r\n                                        <c:if test=\"${requestScope.subject == null}\">\r\n                                            <option value=\"all\" selected>All subjects</option>\r\n                                        </c:if>\r\n                                        <c:if test=\"${requestScope.subject != null}\">\r\n                                            <option value=\"all\">All subjects</option>\r\n                                        </c:if>\r\n                                        <c:forEach items=\"${requestScope.subjectList}\" var=\"subject\">\r\n                                            <c:if test=\"${subject.id == requestScope.subject.id}\">\r\n                                                <option value=\"${subject.id}\" selected>${subject.code}</option>\r\n                                            </c:if>\r\n                                            <c:if test=\"${subject.id != requestScope.subject.id}\">\r\n                                                <option value=\"${subject.id}\">${subject.code}</option>\r\n                                            </c:if>\r\n                                        </c:forEach>\r\n                                    </select>\r\n                                    <span style=\"height: 38px;\" class=\"input-group-text\"><i class=\"tf-icons bx bx-search\"></i></span>\r\n                                    <input type=\"text\" name=\"keyWord\" class=\"form-control\" placeholder=\"Search\" value=\"${requestScope.keyWord}\"/>\r\n                                </div>\r\n                                <button style=\"height: 38px;\" class=\"btn btn-outline-primary\" type=\"submit\">Search</button>\r\n                            </form>\r\n\r\n                            <!-- Basic Bootstrap Table -->\r\n                            <div class=\"card\">\r\n                                <h5 class=\"card-header\">Lesson list</h5>\r\n                                <div class=\"table-responsive text-nowrap\">\r\n                                    <table class=\"table\">\r\n                                        <thead>\r\n                                            <tr>\r\n                                                <th>#</th>\r\n                                                <th>Name</th>\r\n                                                <th>Subject</th>\r\n                                                <th>Status</th>\r\n                                                <th>Order</th>\r\n                                                <th>Actions</th>\r\n                                            </tr>\r\n                                        </thead>\r\n                                        <tbody class=\"table-border-bottom-0\">\r\n                                            <c:forEach items=\"${requestScope.list}\" var=\"lesson\">\r\n                                                <tr>\r\n                                                    <c:if test=\"${lesson.status}\">\r\n                                                        <td class=\"text-primary\">${lesson.id}</td>\r\n                                                        <td class=\"text-primary\">${lesson.name}</td>\r\n                                                        <td class=\"text-primary\">${lesson.subject.code}</td>\r\n                                                        <td>\r\n                                                            <span class=\"badge rounded-pill bg-success\">Active</span>\r\n                                                        </td>\r\n                                                    </c:if>\r\n                                                    <c:if test=\"${!lesson.status}\">\r\n                                                        <td>${lesson.id}</td>\r\n                                                        <td>${lesson.name}</td>\r\n                                                        <td>${lesson.subject.code}</td>\r\n                                                        <td>\r\n                                                            <span class=\"badge rounded-pill bg-danger\">Inactive</span>\r\n                                                        </td>\r\n                                                    </c:if>\r\n                                                    <td class=\"text-success\">${lesson.order}</td>\r\n                                                    <td>\r\n                                                        <c:if test=\"${lesson.status}\">\r\n                                                            <form action=\"${pageContext.request.contextPath}/lesson/details\" id=\"lessonDetails\">\r\n                                                                <input type=\"hidden\" name=\"lessonId\" value=\"${lesson.id}\"/>\r\n                                                                <button style=\"height: 25px; width: 25px; float: left;\" type=\"submit\" class=\"btn btn-icon btn-outline-primary mr-1\"\r\n                                                                        data-toggle=\"tooltip\" data-placement=\"bottom\" title=\"View details\">\r\n                                                                    <i class=\"bx bx-edit\"></i>\r\n                                                                </button>\r\n                                                            </form>\r\n                                                            <button style=\"height: 25px; width: 25px; float: left;\" type=\"button\" class=\"btn btn-icon btn-outline-danger mr-1\"\r\n                                                                    data-toggle=\"tooltip\" data-placement=\"bottom\" title=\"Deactivate\"\r\n                                                                    data-bs-toggle=\"modal\" data-bs-target=\"#modal\" onclick=\"assignValue(${lesson.id}, 'deactivate')\">\r\n                                                                <i class=\"bx bx-x\"></i>\r\n                                                            </button>\r\n                                                        </c:if>\r\n                                                        <c:if test=\"${!lesson.status}\">\r\n                                                            <button style=\"height: 25px; width: 25px; float: left;\" class=\"btn btn-icon btn-outline-secondary mr-1\"\r\n                                                                    data-toggle=\"tooltip\" data-placement=\"bottom\" title=\"View details\" disabled>\r\n                                                                <i class=\"bx bx-edit\"></i>\r\n                                                            </button>\r\n                                                            <button style=\"height: 25px; width: 25px; float: left\" type=\"button\" class=\"btn btn-icon btn-outline-success mr-1\"\r\n                                                                    data-toggle=\"tooltip\" data-placement=\"bottom\" title=\"Activate\"\r\n                                                                    data-bs-toggle=\"modal\" data-bs-target=\"#modal\" onclick=\"assignValue(${lesson.id}, 'activate')\">\r\n                                                                <i class=\"bx bx-check me-1\"></i>\r\n                                                            </button>\r\n                                                        </c:if>\r\n                                                        <c:if test=\"${lesson.order != requestScope.latestOrder}\">\r\n                                                            <button style=\"height: 25px; width: 25px; float: left;\" type=\"button\" class=\"btn btn-icon btn-outline-warning mr-1\"\r\n                                                                    data-toggle=\"tooltip\" data-placement=\"bottom\" title=\"Move down\"\r\n                                                                    data-bs-toggle=\"modal\" data-bs-target=\"#modalOrder\" onclick=\"assignOrderValue(${lesson.id}, 'down')\">\r\n                                                                <i class=\"bx bx-down-arrow\"></i>\r\n                                                            </button>\r\n                                                        </c:if>\r\n                                                        <c:if test=\"${lesson.order != 1}\">\r\n                                                            <button style=\"height: 25px; width: 25px; float: left;\" type=\"button\" class=\"btn btn-icon btn-outline-warning mr-1\"\r\n                                                                    data-toggle=\"tooltip\" data-placement=\"bottom\" title=\"Move up\"\r\n                                                                    data-bs-toggle=\"modal\" data-bs-target=\"#modalOrder\" onclick=\"assignOrderValue(${lesson.id}, 'up')\">\r\n                                                                <i class=\"bx bx-up-arrow\"></i>\r\n                                                            </button>\r\n                                                        </c:if>\r\n                                                    </td>\r\n                                                </tr>\r\n                                            </c:forEach>\r\n                                        </tbody>\r\n                                    </table>\r\n                                    <div class=\"modal fade\" id=\"modal\" tabindex=\"-1\" aria-hidden=\"true\">\r\n                                        <form action=\"${pageContext.request.contextPath}/lesson/update\">\r\n                                            <input type=\"hidden\" name=\"lessonId\" id=\"lessonId\"/>\r\n                                            <input type=\"hidden\" name=\"action\" value=\"changeStatus\"/>\r\n                                            <div class=\"modal-dialog modal-dialog-centered\" role=\"document\">\r\n                                                <div class=\"modal-content\">\r\n                                                    <div class=\"modal-header\">\r\n                                                        <h5 class=\"modal-title\" id=\"modalCenterTitle\">Activate / Deactivate</h5>\r\n                                                        <button\r\n                                                            type=\"button\"\r\n                                                            class=\"btn-close\"\r\n                                                            data-bs-dismiss=\"modal\"\r\n                                                            aria-label=\"Close\"></button>\r\n                                                    </div>\r\n                                                    <div class=\"modal-body\">\r\n                                                        <h5 id=\"modalBodyText\"></h5>\r\n                                                    </div>\r\n                                                    <div class=\"modal-footer\">\r\n                                                        <button type=\"button\" class=\"btn btn-outline-secondary\" data-bs-dismiss=\"modal\">\r\n                                                            No\r\n                                                        </button>\r\n                                                        <button type=\"submit\" class=\"btn btn-primary\">Yes</button>\r\n                                                    </div>\r\n                                                </div>\r\n                                            </div>\r\n                                        </form>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                            <!--/ Basic Bootstrap Table -->\r\n\r\n                            <form action=\"${pageContext.request.contextPath}/lesson\">\r\n                                <input type=\"hidden\" name=\"subjectId\" value=\"${requestScope.subject.id}\"/>\r\n                                <input type=\"hidden\" name=\"keyWord\" value=\"${requestScope.keyWord}\"/>\r\n                                <input type=\"hidden\" name=\"pageAction\" id=\"pageAction\"/>\r\n                                <input type=\"hidden\" name=\"newPage\" id=\"newPage\"/>\r\n                                <input type=\"hidden\" name=\"currentPage\" value=\"${requestScope.currentPage}\"/>\r\n                                <div class=\"card mb-4\">\r\n                                    <!-- Basic Pagination -->\r\n                                    <div class=\"card mb-4\">\r\n                                        <!-- Basic Pagination -->\r\n                                        <div class=\"card-body\">\r\n                                            <div class=\"row\">\r\n                                                <div class=\"col-lg-6\">\r\n                                                    <small class=\"text-light fw-medium\">Basic</small>\r\n                                                    <div class=\"demo-inline-spacing\">\r\n                                                        <!-- Basic Pagination -->\r\n                                                        <nav aria-label=\"Page navigation\">\r\n                                                            <ul class=\"pagination\">\r\n                                                                <li class=\"page-item first\">\r\n                                                                    <button class=\"page-link\"\r\n                                                                            type=\"submit\"\r\n                                                                            onclick=\"document.getElementById('pageAction').value = 'firstPage';\">\r\n                                                                        <i class=\"tf-icon bx bx-chevrons-left\"></i>\r\n                                                                    </button>\r\n                                                                </li>\r\n                                                                <li class=\"page-item prev\">\r\n                                                                    <button class=\"page-link\"\r\n                                                                            type=\"submit\"\r\n                                                                            onclick=\"document.getElementById('pageAction').value = 'prevPage';\">\r\n                                                                        <i class=\"tf-icon bx bx-chevron-left\"></i>\r\n                                                                    </button>\r\n                                                                </li>\r\n                                                                <c:forEach begin=\"1\" end=\"${requestScope.noOfPages}\" var=\"page\">\r\n                                                                    <c:if test=\"${(page == 1) || (page == 2) || (page == requestScope.noOfPages) ||\r\n                                                                                  (page == requestScope.noOfPages - 1) || (Math.abs(page - requestScope.currentPage) <= 1)}\">\r\n                                                                        <c:if test=\"${page == requestScope.currentPage}\">\r\n                                                                            <li class=\"page-item active\">\r\n                                                                                <button class=\"page-link\"\r\n                                                                                        type=\"submit\"\r\n                                                                                        onclick=\"document.getElementById('newPage').value = ${page}\">${page}</button>\r\n                                                                            </li>\r\n                                                                        </c:if>\r\n                                                                        <c:if test=\"${page != requestScope.currentPage}\">\r\n                                                                            <li class=\"page-item\">\r\n                                                                                <input type=\"hidden\" name=\"page\" value=\"${page}\"/>\r\n                                                                                <button class=\"page-link\"\r\n                                                                                        type=\"submit\"\r\n                                                                                        onclick=\"document.getElementById('newPage').value = ${page}\">${page}</button>\r\n                                                                            </li>\r\n                                                                        </c:if>\r\n                                                                        <c:if test=\"${(page == 2) && (page < requestScope.currentPage - 1)}\">\r\n                                                                            <li class=\"page-item\">\r\n                                                                                <button class=\"page-link\">...</button>\r\n                                                                            </li>\r\n                                                                        </c:if>\r\n                                                                        <c:if test=\"${(page == requestScope.currentPage + 1) && (requestScope.currentPage + 1 < requestScope.noOfPages - 1)}\">\r\n                                                                            <li class=\"page-item\">\r\n                                                                                <button class=\"page-link\">...</button>\r\n                                                                            </li>\r\n                                                                        </c:if>\r\n                                                                    </c:if>\r\n                                                                </c:forEach>\r\n                                                                <li class=\"page-item next\">\r\n                                                                    <button class=\"page-link\"\r\n                                                                            type=\"submit\"\r\n                                                                            onclick=\"document.getElementById('pageAction').value = 'nextPage';\">\r\n                                                                        <i class=\"tf-icon bx bx-chevrons-right\"></i>\r\n                                                                    </button>\r\n                                                                </li>\r\n\r\n                                                                <li class=\"page-item last\">\r\n                                                                    <button class=\"page-link\"\r\n                                                                            type=\"submit\"\r\n                                                                            onclick=\"document.getElementById('pageAction').value = 'lastPage';\">\r\n                                                                        <i class=\"tf-icon bx bx-chevrons-right\"></i>\r\n                                                                    </button>\r\n                                                                </li>\r\n                                                            </ul>\r\n                                                        </nav>\r\n                                                        <!--/ Basic Pagination -->\r\n                                                    </div>\r\n                                                </div>\r\n                                            </div>\r\n                                        </div>\r\n                                    </div>\r\n                            </form>\r\n\r\n                        </div>\r\n                        <!-- / Content -->\r\n\r\n                        <jsp:include page=\"/WEB-INF/common/footer.jsp\"/>\r\n                    </div>\r\n                    <!-- Content wrapper -->\r\n\r\n\r\n                </div>\r\n                <!-- / Layout page -->\r\n            </div>\r\n        </div>\r\n        <!-- / Layout wrapper -->\r\n\r\n        <div class=\"modal fade\" id=\"modalOrder\" tabindex=\"-1\" aria-hidden=\"true\">\r\n            <form action=\"${pageContext.request.contextPath}/lesson/update\">\r\n                <input type=\"hidden\" name=\"lessonId\" id=\"orderLessonId\"/>\r\n                <input type=\"hidden\" name=\"action\" value=\"changeOrder\"/>\r\n                <input type=\"hidden\" name=\"orderAction\" id=\"orderAction\"/>\r\n                <div class=\"modal-dialog modal-dialog-centered\" role=\"document\">\r\n                    <div class=\"modal-content\">\r\n                        <div class=\"modal-header\">\r\n                            <h5 class=\"modal-title\" id=\"modalCenterTitle\">Change order</h5>\r\n                            <button\r\n                                type=\"button\"\r\n                                class=\"btn-close\"\r\n                                data-bs-dismiss=\"modal\"\r\n                                aria-label=\"Close\"></button>\r\n                        </div>\r\n                        <div class=\"modal-body\">\r\n                            <h5 id=\"modalOrderBodyText\"></h5>\r\n                        </div>\r\n                        <div class=\"modal-footer\">\r\n                            <button type=\"button\" class=\"btn btn-outline-secondary\" data-bs-dismiss=\"modal\">\r\n                                No\r\n                            </button>\r\n                            <button type=\"submit\" class=\"btn btn-primary\">Yes</button>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </form>\r\n        </div>\r\n\r\n        <script>\r\n            function assignValue(lessonId, action) {\r\n                document.getElementById(\"lessonId\").value = lessonId;\r\n                let text1 = \"Are you sure you want to \";\r\n                let text2 = \" lesson \";\r\n                let text3 = \"?\"\r\n                let s = text1 + action + text2 + text3;\r\n                document.getElementById(\"modalBodyText\").innerHTML = s;\r\n            }\r\n\r\n            function assignOrderValue(lessonId, action) {\r\n                document.getElementById(\"orderLessonId\").value = lessonId;\r\n                let text1 = \"Are you sure you want to move \";\r\n                let text2 = \" lesson?\";\r\n                let s = text1 + action + text2;\r\n                document.getElementById(\"modalOrderBodyText\").innerHTML = s;\r\n                document.getElementById(\"orderAction\").value = action;\r\n            }\r\n        </script>\r\n\r\n        <script src=\"https://code.jquery.com/jquery-3.4.1.min.js\"></script>\r\n        <script src=\"https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.bundle.min.js\"></script>\r\n        <script src=\"./lib/easing/easing.min.js\"></script>\r\n        <script src=\"./lib/waypoints/waypoints.min.js\"></script>\r\n        <script src=\"./lib/counterup/counterup.min.js\"></script>\r\n        <script src=\"./lib/owlcarousel/owl.carousel.min.js\"></script>\r\n\r\n        <!-- Template Javascript -->\r\n        <script src=\"./js/main.js\"></script>\r\n\r\n        <!-- Core JS -->\r\n        <!-- build:js assets/vendor/js/core.js -->\r\n\r\n        <script src=\"./assets/vendor/libs/jquery/jquery.js\"></script>\r\n        <script src=\"./assets/vendor/libs/popper/popper.js\"></script>\r\n        <script src=\"./assets/vendor/js/bootstrap.js\"></script>\r\n        <script src=\"./assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.js\"></script>\r\n        <script src=\"./assets/vendor/js/menu.js\"></script>\r\n\r\n        <!-- endbuild -->\r\n\r\n        <!-- Vendors JS -->\r\n        <script src=\"./assets/vendor/libs/apex-charts/apexcharts.js\"></script>\r\n\r\n        <!-- Main JS -->\r\n        <script src=\"./assets/js/main.js\"></script>\r\n\r\n        <!-- Page JS -->\r\n        <script src=\"assets/js/dashboards-analytics.js\"></script>\r\n\r\n        <!-- Place this tag in your head or just before your close body tag. -->\r\n        <script async defer src=\"https://buttons.github.io/buttons.js\"></script>\r\n\r\n        <script src=\"js/sider.js\"></script>\r\n    </body>\r\n</html>\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/web/WEB-INF/views/lesson/lessonlist.jsp b/web/WEB-INF/views/lesson/lessonlist.jsp
--- a/web/WEB-INF/views/lesson/lessonlist.jsp	(revision d6ad1445e1c07c5da0ab8951156084fe4a182d1f)
+++ b/web/WEB-INF/views/lesson/lessonlist.jsp	(date 1721252670161)
@@ -97,7 +97,7 @@
                             <h4 class="py-3 mb-4"><span class="text-muted fw-light">Lesson /</span> Lesson list</h4>
 
                             <form id="searchBar" class="d-flex" action="${pageContext.request.contextPath}/lesson">
-                                <div class="input-group mr-3" style="width: 500px; overflow: auto;">
+                                <div class="input-group mr-3" style="overflow: auto;">
                                     <label for="subjectselect">Subject: </label>
                                     <select name="subjectId" id="subjectselect" class="mr-3 ml-3" 
                                             onchange="document.getElementById('searchBar').submit();"
@@ -118,12 +118,32 @@
                                             <c:if test="${subject.id != requestScope.subject.id}">
                                                 <option value="${subject.id}">${subject.code}</option>
                                             </c:if>
+                                        </c:forEach>
+                                    </select>
+                                    <label for="sortBy">Sort by: </label>
+                                    <select style="height: 38px;" name="sortBy" id="sortBy" class="mr-3 ml-3" 
+                                            onchange="document.getElementById('searchBar').submit();"
+                                            onmousedown="if (this.options.length > 5) {
+                                                        this.size = 5;
+                                                        document.getElementById('sortBy').style.height = '115px';
+                                                    }"  
+                                            onblur="this.size = 0;document.getElementById('sortBy').style.height = '38px';">
+                                        <c:forEach items="${requestScope.sortOptions}" var="option">
+                                            <c:if test="${requestScope.sortBy.equals(option)}">
+                                                <option value="${option}" selected>${option}</option>
+                                            </c:if>
+                                            <c:if test="${!requestScope.sortBy.equals(option)}">
+                                                <option value="${option}">${option}</option>
+                                            </c:if>
                                         </c:forEach>
                                     </select>
                                     <span style="height: 38px;" class="input-group-text"><i class="tf-icons bx bx-search"></i></span>
-                                    <input type="text" name="keyWord" class="form-control" placeholder="Search" value="${requestScope.keyWord}"/>
+                                    <input type="text" name="keyWord" class="form-control" placeholder="Search" value="${requestScope.keyWord}"
+                                           style="float: right;"/>
+                                    <button style="height: 38px; float: right;" 
+                                            class="btn btn-outline-primary" type="submit">Search</button>
                                 </div>
-                                <button style="height: 38px;" class="btn btn-outline-primary" type="submit">Search</button>
+
                             </form>
 
                             <!-- Basic Bootstrap Table -->
@@ -139,6 +159,7 @@
                                                 <th>Status</th>
                                                 <th>Order</th>
                                                 <th>Actions</th>
+                                                <th>Order</th>
                                             </tr>
                                         </thead>
                                         <tbody class="table-border-bottom-0">
@@ -187,6 +208,8 @@
                                                                 <i class="bx bx-check me-1"></i>
                                                             </button>
                                                         </c:if>
+                                                    </td>
+                                                    <td>
                                                         <c:if test="${lesson.order != requestScope.latestOrder}">
                                                             <button style="height: 25px; width: 25px; float: left;" type="button" class="btn btn-icon btn-outline-warning mr-1"
                                                                     data-toggle="tooltip" data-placement="bottom" title="Move down"
@@ -240,6 +263,7 @@
                             <form action="${pageContext.request.contextPath}/lesson">
                                 <input type="hidden" name="subjectId" value="${requestScope.subject.id}"/>
                                 <input type="hidden" name="keyWord" value="${requestScope.keyWord}"/>
+                                <input type="hidden" name="sortBy" value="${requestScope.sortBy}"/>
                                 <input type="hidden" name="pageAction" id="pageAction"/>
                                 <input type="hidden" name="newPage" id="newPage"/>
                                 <input type="hidden" name="currentPage" value="${requestScope.currentPage}"/>
Index: web/setnewpassword.jsp
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><%@page isELIgnored=\"false\" %>\r\n<%@taglib prefix=\"c\" uri=\"http://java.sun.com/jsp/jstl/core\" %>\r\n<%@page contentType=\"text/html\" pageEncoding=\"UTF-8\"%>\r\n<html\r\n    lang=\"en\"\r\n    class=\"light-style layout-menu-fixed layout-compact\"\r\n    dir=\"ltr\"\r\n    data-theme=\"theme-default\"\r\n    data-assets-path=\"../assets/\"\r\n    data-template=\"vertical-menu-template-free\">\r\n    <head>\r\n        <meta charset=\"utf-8\" />\r\n        <meta\r\n            name=\"viewport\"\r\n            content=\"width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0\" />\r\n\r\n        <title>Set new password</title>\r\n\r\n        <meta name=\"description\" content=\"\" />\r\n\r\n        <!-- Favicon -->\r\n        <link rel=\"icon\" type=\"image/x-icon\" href=\"../assets/img/favicon/favicon.ico\" />\r\n\r\n        <!-- Fonts -->\r\n        <link rel=\"preconnect\" href=\"https://fonts.googleapis.com\" />\r\n        <link rel=\"preconnect\" href=\"https://fonts.gstatic.com\" crossorigin />\r\n        <link\r\n            href=\"https://fonts.googleapis.com/css2?family=Public+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&display=swap\"\r\n            rel=\"stylesheet\" />\r\n\r\n        <link rel=\"stylesheet\" href=\"../assets/vendor/fonts/boxicons.css\" />\r\n\r\n        <!-- Page -->\r\n        <link rel=\"stylesheet\" href=\"../assets/vendor/css/pages/page-auth.css\" />\r\n\r\n        <!-- Core CSS -->\r\n        <link rel=\"stylesheet\" href=\"../assets/vendor/css/core.css\" class=\"template-customizer-core-css\" />\r\n        <link rel=\"stylesheet\" href=\"../assets/vendor/css/theme-default.css\" class=\"template-customizer-theme-css\" />\r\n        <link rel=\"stylesheet\" href=\"../assets/css/demo.css\" />\r\n\r\n        <!-- Vendors CSS -->\r\n        <link rel=\"stylesheet\" href=\"../assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.css\" />\r\n        <link rel=\"stylesheet\" href=\"../assets/vendor/libs/apex-charts/apex-charts.css\" />\r\n\r\n        <!-- Page CSS -->\r\n\r\n        <!-- Favicon -->\r\n        <link href=\"../img/favicon.ico\" rel=\"icon\">\r\n\r\n        <!-- Google Web Fonts -->\r\n        <link rel=\"preconnect\" href=\"https://fonts.gstatic.com\">\r\n        <link href=\"https://fonts.googleapis.com/css2?family=Jost:wght@500;600;700&family=Open+Sans:wght@400;600&display=swap\" rel=\"stylesheet\"> \r\n\r\n        <!-- Font Awesome -->\r\n        <link href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css\" rel=\"stylesheet\">\r\n\r\n        <!-- Libraries Stylesheet -->\r\n        <link href=\"../lib/owlcarousel/assets/owl.carousel.min.css\" rel=\"stylesheet\">\r\n\r\n        <!-- Customized Bootstrap Stylesheet -->\r\n        <link href=\"../css/style.css\" rel=\"stylesheet\">\r\n\r\n        <!-- Helpers -->\r\n        <script src=\"../assets/vendor/js/helpers.js\"></script>\r\n        <!--! Template customizer & Theme config files MUST be included after core stylesheets and helpers.js in the <head> section -->\r\n        <!--? Config:  Mandatory theme config file contain global vars & default theme options, Set your preferred theme option in this file.  -->\r\n        <script src=\"../assets/js/config.js\"></script>\r\n    </head>\r\n\r\n    <body>\r\n\r\n        <jsp:include page=\"/WEB-INF/common/header.jsp\"/>\r\n\r\n        <div class=\"container-sm\" style=\"width: 500px;\">\r\n            <div class=\"authentication-wrapper authentication-basic container-p-y\">\r\n                <div class=\"authentication-inner\">\r\n                    <!-- Register Card -->\r\n                    <div class=\"card\">\r\n                        <div class=\"card-body\">\r\n                            <!-- Logo -->\r\n                            <div class=\"app-brand justify-content-center\">\r\n                                <a href=\"${pageContext.request.contextPath}/home\" class=\"navbar-brand ml-lg-3\">\r\n                                    <h1 class=\"m-0 text-uppercase text-primary\"><i class=\"fa fa-book-reader mr-3\"></i>KRS</h1>\r\n                                </a>\r\n                            </div>\r\n                            <!-- /Logo -->\r\n                            <br/>\r\n\r\n                            <h5 style=\"color: black; margin: auto 0;\">Set new password for your account</h5>\r\n\r\n                            <br/>\r\n\r\n                            <form id=\"formAuthentication\" class=\"mb-3\" action=\"${pageContext.request.contextPath}/resetpassword\"\r\n                                  method=\"post\">\r\n                                <input type=\"hidden\" name=\"userId\" value=\"${requestScope.user.id}\"/>\r\n                                <input type=\"hidden\" name=\"action\" value=\"setNewPassword\"/>\r\n                                <div class=\"mb-3 form-password-toggle\">\r\n                                    <label class=\"form-label\" for=\"newPassword\">Password</label>\r\n                                    <div class=\"input-group input-group-merge\">\r\n                                        <input\r\n                                            type=\"password\"\r\n                                            id=\"newPassword\"\r\n                                            class=\"form-control\"\r\n                                            name=\"newPassword\"\r\n                                            value=\"${requestScope.newPassword}\"\r\n                                            placeholder=\"New password\"\r\n                                            aria-describedby=\"newPassword\" />\r\n                                        <span onclick=\"showPassword('newPassword');\" class=\"input-group-text cursor-pointer\">\r\n                                            <i id=\"newPasswordShow\" class=\"bx bx-show\"></i>\r\n                                        </span>\r\n                                    </div>\r\n                                    <c:if test=\"${requestScope.newPasswordErr != null && !requestScope.newPasswordErr.isEmpty()}\">\r\n                                        <h6 style=\"color: red;\">${requestScope.newPasswordErr}</h6>\r\n                                    </c:if>\r\n                                </div>\r\n                                <div class=\"mb-3 form-password-toggle\">\r\n                                    <label class=\"form-label\" for=\"confirmPassword\">Password</label>\r\n                                    <div class=\"input-group input-group-merge\">\r\n                                        <input\r\n                                            type=\"password\"\r\n                                            id=\"confirmPassword\"\r\n                                            class=\"form-control\"\r\n                                            name=\"confirmPassword\"\r\n                                            value=\"${requestScope.confirmPassword}\"\r\n                                            placeholder=\"Confirm password\"\r\n                                            aria-describedby=\"confirmPassword\" />\r\n                                        <span onclick=\"showPassword('confirmPassword')\" class=\"input-group-text cursor-pointer\">\r\n                                            <i id=\"confirmPasswordShow\" class=\"bx bx-show\"></i>\r\n                                        </span>\r\n                                    </div>\r\n                                    <c:if test=\"${requestScope.confirmPasswordErr != null && !requestScope.confirmPasswordErr.isEmpty()}\">\r\n                                        <h6 style=\"color: red;\">${requestScope.confirmPasswordErr}</h6>\r\n                                    </c:if>\r\n                                </div>\r\n                                <button class=\"btn btn-primary d-grid w-100\">Set password</button>\r\n                            </form>\r\n                        </div>\r\n                        <c:if test=\"${err != null && !err.isEmpty()}\">\r\n                            <h6 style=\"color: red;\">${requestScope.err}</h6>\r\n                        </c:if>\r\n                    </div>\r\n                    <!-- Register Card -->\r\n                </div>\r\n            </div>\r\n        </div>\r\n\r\n        <jsp:include page=\"/WEB-INF/common/footer.jsp\"/>\r\n\r\n        <script>\r\n            function showPassword(elementId) {\r\n                const passwordField = document.getElementById(elementId);\r\n                let show = elementId + 'Show';\r\n                const icon = document.getElementById(show);\r\n                if (passwordField.type === 'password') {\r\n                    passwordField.type = 'text';\r\n                    icon.className = 'bx bx-hide';\r\n                } else {\r\n                    passwordField.type = 'password';\r\n                    icon.className = 'bx bx-show';\r\n                }\r\n            }\r\n        </script>\r\n\r\n        <script src=\"https://code.jquery.com/jquery-3.4.1.min.js\"></script>\r\n        <script src=\"https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.bundle.min.js\"></script>\r\n        <script src=\"../lib/easing/easing.min.js\"></script>\r\n        <script src=\"../lib/waypoints/waypoints.min.js\"></script>\r\n        <script src=\"../lib/counterup/counterup.min.js\"></script>\r\n        <script src=\"../lib/owlcarousel/owl.carousel.min.js\"></script>\r\n\r\n        <!-- Template Javascript -->\r\n        <script src=\"../js/main.js\"></script>\r\n\r\n        <!-- Core JS -->\r\n        <!-- build:js assets/vendor/js/core.js -->\r\n\r\n        <script src=\"../assets/vendor/libs/jquery/jquery.js\"></script>\r\n        <script src=\"../assets/vendor/libs/popper/popper.js\"></script>\r\n        <script src=\"../assets/vendor/js/bootstrap.js\"></script>\r\n        <script src=\"../assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.js\"></script>\r\n        <script src=\"../assets/vendor/js/menu.js\"></script>\r\n\r\n        <!-- endbuild -->\r\n\r\n        <!-- Vendors JS -->\r\n\r\n        <!-- Main JS -->\r\n        <script src=\"../assets/js/main.js\"></script>\r\n\r\n        <!-- Page JS -->\r\n\r\n        <!-- Place this tag in your head or just before your close body tag. -->\r\n        <script async defer src=\"https://buttons.github.io/buttons.js\"></script>\r\n    </body>\r\n</html>\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/web/setnewpassword.jsp b/web/setnewpassword.jsp
--- a/web/setnewpassword.jsp	(revision d6ad1445e1c07c5da0ab8951156084fe4a182d1f)
+++ b/web/setnewpassword.jsp	(date 1721252670209)
@@ -14,7 +14,6 @@
             name="viewport"
             content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0" />
 
-        <title>Set new password</title>
 
         <meta name="description" content="" />
 
Index: web/WEB-INF/views/lesson/lessondetails.jsp
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><%@page isELIgnored=\"false\" %>\r\n<%@taglib prefix=\"c\" uri=\"http://java.sun.com/jsp/jstl/core\" %>\r\n<%@page contentType=\"text/html\" pageEncoding=\"UTF-8\"%>\r\n<html\r\n    lang=\"en\"\r\n    class=\"light-style layout-menu-fixed layout-compact\"\r\n    dir=\"ltr\"\r\n    data-theme=\"theme-default\"\r\n    data-assets-path=\"../assets/\"\r\n    data-template=\"vertical-menu-template-free\">\r\n    <head>\r\n        <meta charset=\"utf-8\" />\r\n        <meta\r\n            name=\"viewport\"\r\n            content=\"width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0\" />\r\n\r\n        <title>Lesson details</title>\r\n\r\n        <meta name=\"description\" content=\"\" />\r\n\r\n        <!-- Favicon -->\r\n        <link rel=\"icon\" type=\"image/x-icon\" href=\"../assets/img/favicon/favicon.ico\" />\r\n\r\n        <!-- Fonts -->\r\n        <link rel=\"preconnect\" href=\"https://fonts.googleapis.com\" />\r\n        <link rel=\"preconnect\" href=\"https://fonts.gstatic.com\" crossorigin />\r\n        <link\r\n            href=\"https://fonts.googleapis.com/css2?family=Public+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&display=swap\"\r\n            rel=\"stylesheet\" />\r\n\r\n        <link rel=\"stylesheet\" href=\"../assets/vendor/fonts/boxicons.css\" />\r\n\r\n        <!-- Core CSS -->\r\n        <link rel=\"stylesheet\" href=\"../assets/vendor/css/core.css\" class=\"template-customizer-core-css\" />\r\n        <link rel=\"stylesheet\" href=\"../assets/vendor/css/theme-default.css\" class=\"template-customizer-theme-css\" />\r\n        <link rel=\"stylesheet\" href=\"../assets/css/demo.css\" />\r\n\r\n        <!-- Vendors CSS -->\r\n        <link rel=\"stylesheet\" href=\"../assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.css\" />\r\n        <link rel=\"stylesheet\" href=\"../assets/vendor/libs/apex-charts/apex-charts.css\" />\r\n\r\n        <!-- Page CSS -->\r\n\r\n        <!-- Favicon -->\r\n        <link href=\"../img/favicon.ico\" rel=\"icon\">\r\n\r\n        <!-- Google Web Fonts -->\r\n        <link rel=\"preconnect\" href=\"https://fonts.gstatic.com\">\r\n        <link href=\"https://fonts.googleapis.com/css2?family=Jost:wght@500;600;700&family=Open+Sans:wght@400;600&display=swap\" rel=\"stylesheet\"> \r\n\r\n        <!-- Font Awesome -->\r\n        <link href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css\" rel=\"stylesheet\">\r\n\r\n        <!-- Libraries Stylesheet -->\r\n        <link href=\"../lib/owlcarousel/assets/owl.carousel.min.css\" rel=\"stylesheet\">\r\n\r\n        <!-- Customized Bootstrap Stylesheet -->\r\n        <link href=\"../css/style.css\" rel=\"stylesheet\">\r\n\r\n        <!-- Helpers -->\r\n        <script src=\"../assets/vendor/js/helpers.js\"></script>\r\n        <!--! Template customizer & Theme config files MUST be included after core stylesheets and helpers.js in the <head> section -->\r\n        <!--? Config:  Mandatory theme config file contain global vars & default theme options, Set your preferred theme option in this file.  -->\r\n        <script src=\"../assets/js/config.js\"></script>\r\n\r\n\r\n    </head>\r\n\r\n    <body>\r\n        <!-- Layout wrapper -->\r\n        <div class=\"layout-wrapper layout-content-navbar\">\r\n            <div class=\"layout-container\">\r\n                <!-- Menu -->\r\n\r\n                <jsp:include page=\"/WEB-INF/common/sider.jsp\"/>\r\n                <!-- / Menu -->\r\n\r\n                <!-- Layout container -->\r\n                <div class=\"layout-page\">\r\n\r\n                    <!-- Content wrapper -->\r\n                    <div class=\"content-wrapper\">\r\n                        <!-- Content -->\r\n                        <jsp:include page=\"/WEB-INF/common/header.jsp\"/>\r\n\r\n                        <div class=\"container-xxl flex-grow-1 container-p-y\">\r\n\r\n\r\n                            <h4 class=\"py-3 mb-4\"><span class=\"text-muted fw-light\">Lesson /</span> Lesson details</h4>\r\n\r\n                            <label for=\"subject\">Subject: </label>\r\n                            <input type=\"text\" value=\"${requestScope.lesson.subject.code}\" readonly id=\"subject\"/>\r\n\r\n                            <div class=\"col-xxl\">\r\n                                <div class=\"card mb-4\">\r\n                                    <div class=\"card-header d-flex align-items-center justify-content-between mb-3\">\r\n                                        <h5 class=\"mb-0\">Lesson details</h5>\r\n                                        <small class=\"text-muted float-end\">Input subject name and materials</small>\r\n                                    </div>\r\n                                    <div class=\"card-body\">\r\n                                        <form action=\"${pageContext.request.contextPath}/lesson/update\">\r\n                                            <input type=\"hidden\" name=\"lessonId\" value=\"${requestScope.lesson.id}\"/>\r\n                                            <input type=\"hidden\" name=\"action\" value=\"updateLesson\"/>\r\n                                            <div class=\"row mb-3\">\r\n                                                <label class=\"col-sm-2 col-form-label\" for=\"basic-icon-default-fullname\">Name</label>\r\n                                                <div class=\"col-sm-10\">\r\n                                                    <div class=\"input-group input-group-merge\">\r\n                                                        <span id=\"basic-icon-default-fullname2\" class=\"input-group-text\">\r\n                                                            <i class=\"bx bx-rename\"></i></span>\r\n                                                        <input\r\n                                                            type=\"text\"\r\n                                                            class=\"form-control\"\r\n                                                            id=\"basic-icon-default-fullname\"\r\n                                                            name=\"name\"\r\n                                                            value=\"${requestScope.lesson.name}\"\r\n                                                            placeholder=\"Lesson name\"\r\n                                                            aria-label=\"Lesson name\"\r\n                                                            aria-describedby=\"basic-icon-default-fullname2\" />\r\n                                                    </div>\r\n                                                </div>\r\n                                            </div>\r\n                                            <div class=\"row justify-content-end\">\r\n                                                <div class=\"col-sm-10\">\r\n                                                    <button type=\"submit\" class=\"btn btn-primary\">Update lesson</button>\r\n\r\n                                                </div>\r\n                                            </div>\r\n                                            <c:if test=\"${requestScope.err != null && !requestScope.err.isEmpty()}\">\r\n                                                <div class=\"row mb-3\">\r\n                                                    <div class=\"col-sm-2\"></div>\r\n                                                    <div class=\"col-sm-10\">\r\n                                                        <h6 style=\"color: red;\">${requestScope.err}</h6>\r\n                                                    </div>\r\n                                                </div>\r\n                                            </c:if>\r\n                                        </form>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                            <hr class=\"my-5\" />\r\n\r\n                        </div>\r\n                        <!-- / Content -->\r\n\r\n                        <div class=\"content-backdrop fade\"></div>\r\n                        <jsp:include page=\"/WEB-INF/common/footer.jsp\"/>\r\n                    </div>\r\n                    <!-- Content wrapper -->\r\n\r\n\r\n                </div>\r\n                <!-- / Layout page -->\r\n            </div>\r\n        </div>\r\n        <!-- / Layout wrapper -->\r\n\r\n        <script src=\"https://code.jquery.com/jquery-3.4.1.min.js\"></script>\r\n        <script src=\"https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.bundle.min.js\"></script>\r\n        <script src=\"../lib/easing/easing.min.js\"></script>\r\n        <script src=\"../lib/waypoints/waypoints.min.js\"></script>\r\n        <script src=\"../lib/counterup/counterup.min.js\"></script>\r\n        <script src=\"../lib/owlcarousel/owl.carousel.min.js\"></script>\r\n\r\n        <!-- Template Javascript -->\r\n        <script src=\"../js/main.js\"></script>\r\n\r\n        <!-- Core JS -->\r\n        <!-- build:js ../assets/vendor/js/core.js -->\r\n\r\n        <script src=\"../assets/vendor/libs/jquery/jquery.js\"></script>\r\n        <script src=\"../assets/vendor/libs/popper/popper.js\"></script>\r\n        <script src=\"../assets/vendor/js/bootstrap.js\"></script>\r\n        <script src=\"../assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.js\"></script>\r\n        <script src=\"../assets/vendor/js/menu.js\"></script>\r\n\r\n        <!-- endbuild -->\r\n\r\n        <!-- Vendors JS -->\r\n        <script src=\"../assets/vendor/libs/apex-charts/apexcharts.js\"></script>\r\n\r\n        <!-- Main JS -->\r\n        <script src=\"../assets/js/main.js\"></script>\r\n\r\n        <!-- Page JS -->\r\n        <script src=\"../assets/js/dashboards-analytics.js\"></script>\r\n\r\n        <!-- Place this tag in your head or just before your close body tag. -->\r\n        <script async defer src=\"https://buttons.github.io/buttons.js\"></script>\r\n    </body>\r\n</html>\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/web/WEB-INF/views/lesson/lessondetails.jsp b/web/WEB-INF/views/lesson/lessondetails.jsp
--- a/web/WEB-INF/views/lesson/lessondetails.jsp	(revision d6ad1445e1c07c5da0ab8951156084fe4a182d1f)
+++ b/web/WEB-INF/views/lesson/lessondetails.jsp	(date 1721252670161)
@@ -63,10 +63,37 @@
         <!--? Config:  Mandatory theme config file contain global vars & default theme options, Set your preferred theme option in this file.  -->
         <script src="../assets/js/config.js"></script>
 
+        <script>
+            function setActiveTab(currentPage) {
+                if (currentPage === 'enterData' || currentPage === null || currentPage === '') {
+                    document.getElementById("navs-pills-enter-data").className = "tab-pane fade show active";
+                    document.getElementById("buttonEnterData").ariaSelected = true;
+                    document.getElementById("buttonEnterData").className = "nav-link active";
+                    document.getElementById("buttonMaterial").className = "nav-link";
+                    document.getElementById("buttonMaterial").ariaSelected = false;
+                } else {
+                    document.getElementById("navs-pills-material").className = "tab-pane fade show active";
+                    document.getElementById("buttonMaterial").ariaSelected = true;
+                    document.getElementById("buttonMaterial").className = "nav-link active";
+                    document.getElementById("buttonEnterData").className = "nav-link";
+                    document.getElementById("buttonEnterData").ariaSelected = false;
+                }
+            }
+            function getActiveTab() {
+                if (document.getElementById("buttonMaterial").className === 'nav-link active') {
+                    return "material";
+                } else {
+                    return "enterData";
+                }
+            }
+            function setActiveTabForRefresh() {
+                document.getElementById('currentPage').value = getActiveTab();
+            }
+        </script>
 
     </head>
 
-    <body>
+    <body onload="setActiveTab('${requestScope.currentPage}');">
         <!-- Layout wrapper -->
         <div class="layout-wrapper layout-content-navbar">
             <div class="layout-container">
@@ -87,58 +114,155 @@
 
 
                             <h4 class="py-3 mb-4"><span class="text-muted fw-light">Lesson /</span> Lesson details</h4>
-
-                            <label for="subject">Subject: </label>
-                            <input type="text" value="${requestScope.lesson.subject.code}" readonly id="subject"/>
-
-                            <div class="col-xxl">
-                                <div class="card mb-4">
-                                    <div class="card-header d-flex align-items-center justify-content-between mb-3">
-                                        <h5 class="mb-0">Lesson details</h5>
-                                        <small class="text-muted float-end">Input subject name and materials</small>
-                                    </div>
-                                    <div class="card-body">
-                                        <form action="${pageContext.request.contextPath}/lesson/update">
-                                            <input type="hidden" name="lessonId" value="${requestScope.lesson.id}"/>
-                                            <input type="hidden" name="action" value="updateLesson"/>
-                                            <div class="row mb-3">
-                                                <label class="col-sm-2 col-form-label" for="basic-icon-default-fullname">Name</label>
-                                                <div class="col-sm-10">
-                                                    <div class="input-group input-group-merge">
-                                                        <span id="basic-icon-default-fullname2" class="input-group-text">
-                                                            <i class="bx bx-rename"></i></span>
-                                                        <input
-                                                            type="text"
-                                                            class="form-control"
-                                                            id="basic-icon-default-fullname"
-                                                            name="name"
-                                                            value="${requestScope.lesson.name}"
-                                                            placeholder="Lesson name"
-                                                            aria-label="Lesson name"
-                                                            aria-describedby="basic-icon-default-fullname2" />
-                                                    </div>
-                                                </div>
-                                            </div>
-                                            <div class="row justify-content-end">
-                                                <div class="col-sm-10">
-                                                    <button type="submit" class="btn btn-primary">Update lesson</button>
-
-                                                </div>
-                                            </div>
-                                            <c:if test="${requestScope.err != null && !requestScope.err.isEmpty()}">
-                                                <div class="row mb-3">
-                                                    <div class="col-sm-2"></div>
-                                                    <div class="col-sm-10">
-                                                        <h6 style="color: red;">${requestScope.err}</h6>
-                                                    </div>
-                                                </div>
-                                            </c:if>
-                                        </form>
-                                    </div>
-                                </div>
-                            </div>
+                            <div class="mb-3">
+                                <label for="subject">Subject: </label>
+                                <input type="text" value="${requestScope.lesson.subject.code}" readonly id="subject"/>
+                            </div>
+                            <form action="${pageContext.request.contextPath}/lesson/update"
+                                  enctype="multipart/form-data"
+                                  method="post">
+                                <input type="hidden" name="lessonId" value="${requestScope.lesson.id}"/>
+                                <input type="hidden" name="action" id="action"/>
+                                <div class="row">
+                                    <div class="nav-align-top mb-4">
+                                        <ul class="nav nav-pills mb-3" role="tablist">
+                                            <li class="nav-item">
+                                                <button
+                                                    type="button"
+                                                    id="buttonEnterData"
+                                                    role="tab"
+                                                    data-bs-toggle="tab"
+                                                    data-bs-target="#navs-pills-enter-data"
+                                                    aria-controls="navs-pills-enter-data">
+                                                    Update lesson name
+                                                </button>
+                                            </li>
+                                            <li class="nav-item">
+                                                <button
+                                                    type="button"
+                                                    id="buttonMaterial"
+                                                    role="tab"
+                                                    data-bs-toggle="tab"
+                                                    data-bs-target="#navs-pills-material"
+                                                    aria-controls="navs-pills-material">
+                                                    View lesson's materials
+                                                </button>
+                                            </li>
+                                        </ul>
+                                        <div class="tab-content" style="width: 100%;">
+                                            <div class="tab-pane fade" id="navs-pills-enter-data" role="tabpanel">
+                                                <div class="col-xxl">
+                                                    <div class="card mb-4">
+                                                        <div class="card-header d-flex align-items-center justify-content-between mb-3">
+                                                            <h5 class="mb-0">Lesson details</h5>
+                                                            <small class="text-muted float-end">Input subject name</small>
+                                                        </div>
+                                                        <div class="card-body">
+
+                                                            <div class="row mb-3">
+                                                                <label class="col-sm-2 col-form-label" for="basic-icon-default-fullname">Name</label>
+                                                                <div class="col-sm-10">
+                                                                    <div class="input-group input-group-merge">
+                                                                        <span id="basic-icon-default-fullname2" class="input-group-text">
+                                                                            <i class="bx bx-rename"></i></span>
+                                                                        <input
+                                                                            type="text"
+                                                                            class="form-control"
+                                                                            id="basic-icon-default-fullname"
+                                                                            name="name"
+                                                                            value="${requestScope.lesson.name}"
+                                                                            placeholder="Lesson name"
+                                                                            aria-label="Lesson name"
+                                                                            aria-describedby="basic-icon-default-fullname2" />
+                                                                    </div>
+                                                                </div>
+                                                            </div>
+                                                            <c:if test="${requestScope.err != null && !requestScope.err.isEmpty()}">
+                                                                <div class="row mb-3">
+                                                                    <div class="col-sm-2"></div>
+                                                                    <div class="col-sm-10">
+                                                                        <h6 style="color: red;">${requestScope.err}</h6>
+                                                                    </div>
+                                                                </div>
+                                                            </c:if>
+                                                            <div class="row justify-content-end">
+                                                                <div class="col-sm-10">
+                                                                    <button type="submit" class="btn btn-primary"
+                                                                            onclick="document.getElementById('action').value = 'updateLesson';"> 
+                                                                        Update lesson 
+                                                                    </button>
+                                                                </div>
+                                                            </div>
+                                                        </div>
+                                                    </div>
+                                                </div>
+                                            </div>
+                                            <div class="tab-pane fade" id="navs-pills-material" role="tabpanel">
+                                                <div class="row mb-4">
+                                                    <label for="formFile" class="form-label">Choose a file</label>
+                                                    <div class="col-sm-9">
+                                                        <input class="form-control" type="file" id="formFile"
+                                                               name="file"
+                                                               style="width: 100%;"/>
+                                                    </div>
+                                                    <div class="col-sm-3">
+                                                        <button
+                                                            style="height: 38px;" class="btn btn-primary ml-3"
+                                                            type="submit"
+                                                            onclick="document.getElementById('action').value = 'insertMaterial'">
+                                                            Add material
+                                                        </button>
+                                                    </div>
+                                                </div>
+                                                <c:if test="${(requestScope.fileErr != null) && (!requestScope.fileErr.isEmpty())}">
+                                                    <div class="row mb-3">
+                                                        <h5 style="color: red;">${requestScope.fileErr}</h5>
+                                                    </div>
+                                                </c:if>
+                                                <div class="table-responsive text-nowrap">
+                                                    <table class="table">
+                                                        <thead>
+                                                            <tr>
+                                                                <th>#</th>
+                                                                <th>Name</th>
+                                                                <th></th>
+                                                            </tr>
+                                                        </thead>
+                                                        <tbody class="table-border-bottom-0">
+                                                            <c:forEach items="${requestScope.materialList}" var="material">
+                                                                <tr>
+                                                                    <td>${material.id}</td>
+                                                                    <td>
+                                                                        <a href="../${material.uri}" download="${material.name}">
+                                                                            ${material.name}
+                                                                        </a>
+                                                                    </td>
+                                                                    <td>
+                                                                        <button class="btn btn-icon btn-outline-danger"
+                                                                                type="button"
+                                                                                style="height: 25px; width: 25px; float: left;"
+                                                                                data-toggle="tooltip" data-placement="bottom" title="Remove"
+                                                                                onclick="
+                                                                                        document.getElementById('materialId').value = ${material.id};"
+                                                                                data-bs-toggle="modal" data-bs-target="#modalMaterial">
+                                                                            <i class="bx bx-trash"></i>
+                                                                        </button>
+                                                                    </td>
+                                                                </tr>
+                                                            </c:forEach>
+                                                        </tbody>
+                                                    </table>
+                                                </div>
+                                            </div>
+                                        </div>
+                                    </div>
+                                </div>
+
+                            </form>
                             <hr class="my-5" />
 
+                            <a href="${pageContext.request.contextPath}/lesson" class="btn btn-primary">Back</a>
+
                         </div>
                         <!-- / Content -->
 
@@ -154,6 +278,35 @@
         </div>
         <!-- / Layout wrapper -->
 
+        <div class="modal fade" id="modalMaterial" tabindex="-1" aria-hidden="true">
+            <form action="${pageContext.request.contextPath}/lesson/update">
+                <input type="hidden" name="lessonId" value="${requestScope.lesson.id}"/>
+                <input type="hidden" name="action" value="removeMaterial"/>
+                <input type="hidden" name="materialId" id="materialId"/>
+                <div class="modal-dialog modal-dialog-centered" role="document">
+                    <div class="modal-content">
+                        <div class="modal-header">
+                            <h5 class="modal-title" id="modalCenterTitle">Remove material</h5>
+                            <button
+                                type="button"
+                                class="btn-close"
+                                data-bs-dismiss="modal"
+                                aria-label="Close"></button>
+                        </div>
+                        <div class="modal-body">
+                            <h5 id="modalOrderBodyText">Are you sure you want to remove material?</h5>
+                        </div>
+                        <div class="modal-footer">
+                            <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
+                                No
+                            </button>
+                            <button type="submit" class="btn btn-primary">Yes</button>
+                        </div>
+                    </div>
+                </div>
+            </form>
+        </div>
+
         <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
         <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.bundle.min.js"></script>
         <script src="../lib/easing/easing.min.js"></script>
Index: web/enteractivationcode.jsp
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><%@page isELIgnored=\"false\" %>\r\n<%@taglib prefix=\"c\" uri=\"http://java.sun.com/jsp/jstl/core\" %>\r\n<%@page contentType=\"text/html\" pageEncoding=\"UTF-8\"%>\r\n<html\r\n    lang=\"en\"\r\n    class=\"light-style layout-menu-fixed layout-compact\"\r\n    dir=\"ltr\"\r\n    data-theme=\"theme-default\"\r\n    data-assets-path=\"../assets/\"\r\n    data-template=\"vertical-menu-template-free\">\r\n    <head>\r\n        <meta charset=\"utf-8\" />\r\n        <meta\r\n            name=\"viewport\"\r\n            content=\"width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0\" />\r\n\r\n        <title>Enter activation code</title>\r\n\r\n        <meta name=\"description\" content=\"\" />\r\n\r\n        <!-- Favicon -->\r\n        <link rel=\"icon\" type=\"image/x-icon\" href=\"../assets/img/favicon/favicon.ico\" />\r\n\r\n        <!-- Fonts -->\r\n        <link rel=\"preconnect\" href=\"https://fonts.googleapis.com\" />\r\n        <link rel=\"preconnect\" href=\"https://fonts.gstatic.com\" crossorigin />\r\n        <link\r\n            href=\"https://fonts.googleapis.com/css2?family=Public+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&display=swap\"\r\n            rel=\"stylesheet\" />\r\n\r\n        <link rel=\"stylesheet\" href=\"../assets/vendor/fonts/boxicons.css\" />\r\n\r\n        <!-- Page -->\r\n        <link rel=\"stylesheet\" href=\"../assets/vendor/css/pages/page-auth.css\" />\r\n\r\n        <!-- Core CSS -->\r\n        <link rel=\"stylesheet\" href=\"../assets/vendor/css/core.css\" class=\"template-customizer-core-css\" />\r\n        <link rel=\"stylesheet\" href=\"../assets/vendor/css/theme-default.css\" class=\"template-customizer-theme-css\" />\r\n        <link rel=\"stylesheet\" href=\"../assets/css/demo.css\" />\r\n\r\n        <!-- Vendors CSS -->\r\n        <link rel=\"stylesheet\" href=\"../assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.css\" />\r\n        <link rel=\"stylesheet\" href=\"../assets/vendor/libs/apex-charts/apex-charts.css\" />\r\n\r\n        <!-- Page CSS -->\r\n\r\n        <!-- Favicon -->\r\n        <link href=\"../img/favicon.ico\" rel=\"icon\">\r\n\r\n        <!-- Google Web Fonts -->\r\n        <link rel=\"preconnect\" href=\"https://fonts.gstatic.com\">\r\n        <link href=\"https://fonts.googleapis.com/css2?family=Jost:wght@500;600;700&family=Open+Sans:wght@400;600&display=swap\" rel=\"stylesheet\"> \r\n\r\n        <!-- Font Awesome -->\r\n        <link href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css\" rel=\"stylesheet\">\r\n\r\n        <!-- Libraries Stylesheet -->\r\n        <link href=\"../lib/owlcarousel/assets/owl.carousel.min.css\" rel=\"stylesheet\">\r\n\r\n        <!-- Customized Bootstrap Stylesheet -->\r\n        <link href=\"../css/style.css\" rel=\"stylesheet\">\r\n\r\n        <!-- Helpers -->\r\n        <script src=\"../assets/vendor/js/helpers.js\"></script>\r\n        <!--! Template customizer & Theme config files MUST be included after core stylesheets and helpers.js in the <head> section -->\r\n        <!--? Config:  Mandatory theme config file contain global vars & default theme options, Set your preferred theme option in this file.  -->\r\n        <script src=\"../assets/js/config.js\"></script>\r\n    </head>\r\n\r\n    <body>\r\n\r\n        <jsp:include page=\"/WEB-INF/common/header.jsp\"/>\r\n\r\n        <div class=\"container-sm\" style=\"width: 500px;\">\r\n            <div class=\"authentication-wrapper authentication-basic container-p-y\">\r\n                <div class=\"authentication-inner\">\r\n                    <!-- Register Card -->\r\n                    <div class=\"card\">\r\n                        <div class=\"card-body\">\r\n                            <!-- Logo -->\r\n                            <div class=\"app-brand justify-content-center\">\r\n                                <a href=\"${pageContext.request.contextPath}/activate\" class=\"navbar-brand ml-lg-3\">\r\n                                    <h1 class=\"m-0 text-uppercase text-primary\"><i class=\"fa fa-book-reader mr-3\"></i>KRS</h1>\r\n                                </a>\r\n                            </div>\r\n                            <!-- /Logo -->\r\n                            <br/>\r\n\r\n                            <h5 style=\"color: black; margin: auto 0;\">Your account is inactive. Please check your email to get your activation code.</h5>\r\n\r\n                            <br/>\r\n\r\n                            <form id=\"formAuthentication\" class=\"mb-3\" action=\"${pageContext.request.contextPath}/activate\"\r\n                                  method=\"post\">\r\n                                <input type=\"hidden\" name=\"userId\" value=\"${requestScope.user.id}\"/>\r\n                                <input type=\"hidden\" name=\"activationCode\" value=\"${requestScope.activationCode}\"/>\r\n                                <div class=\"mb-3 form-password-toggle\">\r\n                                    <label class=\"form-label\" for=\"code\">Your activation code</label>\r\n                                    <div class=\"input-group input-group-merge\">\r\n                                        <input\r\n                                            type=\"text\"\r\n                                            id=\"code\"\r\n                                            class=\"form-control\"\r\n                                            name=\"code\"\r\n                                            value=\"${requestScope.code}\"\r\n                                            placeholder=\"Your activation code\"\r\n                                            aria-describedby=\"code\" />\r\n                                    </div>\r\n                                </div>\r\n                                <c:if test=\"${err != null && !err.isEmpty()}\">\r\n                                    <h6 style=\"color: red;\">${requestScope.err}</h6>\r\n                                </c:if>\r\n                                <button class=\"btn btn-primary d-grid w-100\">Enter code</button>\r\n                            </form>\r\n                        </div>\r\n                    </div>\r\n                    <!-- Register Card -->\r\n                </div>\r\n            </div>\r\n        </div>\r\n\r\n        <jsp:include page=\"/WEB-INF/common/footer.jsp\"/>\r\n\r\n        <script>\r\n            function showPassword(elementId) {\r\n                const passwordField = document.getElementById(elementId);\r\n                let show = elementId + 'Show';\r\n                const icon = document.getElementById(show);\r\n                if (passwordField.type === 'password') {\r\n                    passwordField.type = 'text';\r\n                    icon.className = 'bx bx-hide';\r\n                } else {\r\n                    passwordField.type = 'password';\r\n                    icon.className = 'bx bx-show';\r\n                }\r\n            }\r\n        </script>\r\n\r\n        <script src=\"https://code.jquery.com/jquery-3.4.1.min.js\"></script>\r\n        <script src=\"https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.bundle.min.js\"></script>\r\n        <script src=\"../lib/easing/easing.min.js\"></script>\r\n        <script src=\"../lib/waypoints/waypoints.min.js\"></script>\r\n        <script src=\"../lib/counterup/counterup.min.js\"></script>\r\n        <script src=\"../lib/owlcarousel/owl.carousel.min.js\"></script>\r\n\r\n        <!-- Template Javascript -->\r\n        <script src=\"../js/main.js\"></script>\r\n\r\n        <!-- Core JS -->\r\n        <!-- build:js assets/vendor/js/core.js -->\r\n\r\n        <script src=\"../assets/vendor/libs/jquery/jquery.js\"></script>\r\n        <script src=\"../assets/vendor/libs/popper/popper.js\"></script>\r\n        <script src=\"../assets/vendor/js/bootstrap.js\"></script>\r\n        <script src=\"../assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.js\"></script>\r\n        <script src=\"../assets/vendor/js/menu.js\"></script>\r\n\r\n        <!-- endbuild -->\r\n\r\n        <!-- Vendors JS -->\r\n\r\n        <!-- Main JS -->\r\n        <script src=\"../assets/js/main.js\"></script>\r\n\r\n        <!-- Page JS -->\r\n\r\n        <!-- Place this tag in your head or just before your close body tag. -->\r\n        <script async defer src=\"https://buttons.github.io/buttons.js\"></script>\r\n    </body>\r\n</html>\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/web/enteractivationcode.jsp b/web/enteractivationcode.jsp
--- a/web/enteractivationcode.jsp	(revision d6ad1445e1c07c5da0ab8951156084fe4a182d1f)
+++ b/web/enteractivationcode.jsp	(date 1721252670199)
@@ -1,4 +1,3 @@
-<%@page isELIgnored="false" %>
 <%@taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
 <%@page contentType="text/html" pageEncoding="UTF-8"%>
 <html
Index: web/WEB-INF/common/header.jsp
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><%@page isELIgnored=\"false\" %>\r\n<%@taglib prefix=\"c\" uri=\"http://java.sun.com/jsp/jstl/core\" %>\r\n<%@page contentType=\"text/html\" pageEncoding=\"UTF-8\"%>\r\n<!DOCTYPE html>\r\n<html\r\n    lang=\"en\"\r\n    class=\"light-style layout-menu-fixed layout-compact\"\r\n    dir=\"ltr\"\r\n    data-theme=\"theme-default\"\r\n    data-assets-path=\"assets/\"\r\n    data-template=\"vertical-menu-template-free\">\r\n    <head>\r\n        <title>Tables - Basic Tables | Sneat - Bootstrap 5 HTML Admin Template - Pro</title>\r\n        <meta charset=\"utf-8\">\r\n        <meta content=\"width=device-width, initial-scale=1.0\" name=\"viewport\">\r\n        <meta content=\"Free HTML Templates\" name=\"keywords\">\r\n        <meta content=\"Free HTML Templates\" name=\"description\">\r\n\r\n        <!-- Favicon -->\r\n        <link href=\"img/favicon.ico\" rel=\"icon\">\r\n        <link rel=\"icon\" type=\"image/x-icon\" href=\"assets/img/favicon/favicon.ico\" />\r\n\r\n        <!-- Google Web Fonts -->\r\n        <link rel=\"preconnect\" href=\"https://fonts.gstatic.com\">\r\n        <link href=\"https://fonts.googleapis.com/css2?family=Jost:wght@500;600;700&family=Open+Sans:wght@400;600&display=swap\" rel=\"stylesheet\"> \r\n\r\n        <!-- Font Awesome -->\r\n        <link href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css\" rel=\"stylesheet\">\r\n\r\n        <link rel=\"preconnect\" href=\"https://fonts.googleapis.com\" />\r\n        <link rel=\"preconnect\" href=\"https://fonts.gstatic.com\" crossorigin />\r\n        <link\r\n            href=\"https://fonts.googleapis.com/css2?family=Public+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&display=swap\"\r\n            rel=\"stylesheet\" />\r\n\r\n        <link rel=\"stylesheet\" href=\"assets/vendor/fonts/boxicons.css\" />\r\n\r\n        <!-- Libraries Stylesheet -->\r\n        <link href=\"lib/owlcarousel/assets/owl.carousel.min.css\" rel=\"stylesheet\">\r\n\r\n        <!-- Customized Bootstrap Stylesheet -->\r\n        <link href=\"css/style.css\" rel=\"stylesheet\">\r\n\r\n        <!-- Core CSS -->\r\n        <link rel=\"stylesheet\" href=\"assets/vendor/css/core.css\" class=\"template-customizer-core-css\" />\r\n        <link rel=\"stylesheet\" href=\"assets/vendor/css/theme-default.css\" class=\"template-customizer-theme-css\" />\r\n        <link rel=\"stylesheet\" href=\"assets/css/demo.css\" />\r\n\r\n        <!-- Vendors CSS -->\r\n        <link rel=\"stylesheet\" href=\"assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.css\" />\r\n\r\n        <!-- Page CSS -->\r\n\r\n        <!-- Helpers -->\r\n        <script src=\"assets/vendor/js/helpers.js\"></script>\r\n        <!--! Template customizer & Theme config files MUST be included after core stylesheets and helpers.js in the <head> section -->\r\n        <!--? Config:  Mandatory theme config file contain global vars & default theme options, Set your preferred theme option in this file.  -->\r\n        <script src=\"assets/js/config.js\"></script>\r\n    </head>\r\n\r\n    <body>\r\n        <!-- Topbar Start -->\r\n        <div class=\"container-fluid bg-dark\">\r\n            <div class=\"row py-2 px-lg-5\">\r\n                <div class=\"col-lg-6 text-center text-lg-left mb-2 mb-lg-0\">\r\n                    <div class=\"d-inline-flex align-items-center text-white\">\r\n                        <small><i class=\"fa fa-phone-alt mr-2\"></i>+012 345 6789</small>\r\n                        <small class=\"px-3\">|</small>\r\n                        <small><i class=\"fa fa-envelope mr-2\"></i>info@example.com</small>\r\n                    </div>\r\n                </div>\r\n                <div class=\"col-lg-6 text-center text-lg-right\">\r\n                    <div class=\"d-inline-flex align-items-center\">\r\n                        <a class=\"text-white px-2\" target=\"_blank\" href=\"https://www.facebook.com/boyfingerr/\">\r\n                            <i class=\"fab fa-facebook-f\"></i>\r\n                        </a>\r\n                        <a class=\"text-white px-2\" target=\"_blank\" href=\"https://twitter.com/boyfinger42\">\r\n                            <i class=\"fab fa-twitter\"></i>\r\n                        </a>\r\n                        <a class=\"text-white px-2\" target=\"_blank\" href=\"https://www.linkedin.com/\">\r\n                            <i class=\"fab fa-linkedin-in\"></i>\r\n                        </a>\r\n                        <a class=\"text-white px-2\" target=\"_blank\" href=\"https://www.instagram.com/\">\r\n                            <i class=\"fab fa-instagram\"></i>\r\n                        </a>\r\n                        <a class=\"text-white pl-2\" target=\"_blank\" href=\"https://www.youtube.com/@JOISPOI\">\r\n                            <i class=\"fab fa-youtube\"></i>\r\n                        </a>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        <!-- Topbar End -->\r\n\r\n\r\n        <!-- Navbar Start -->\r\n        <div class=\"container-fluid p-0\">\r\n            <nav class=\"navbar navbar-expand-lg bg-white navbar-light py-3 py-lg-0 px-lg-5\">\r\n                <a href=\"${pageContext.request.contextPath}/home\" class=\"navbar-brand ml-lg-3\">\r\n                    <h1 class=\"m-0 text-uppercase text-primary\"><i class=\"fa fa-book-reader mr-3\"></i>KRS</h1>\r\n                </a>\r\n                <button type=\"button\" class=\"navbar-toggler\" data-toggle=\"collapse\" data-target=\"#navbarCollapse\">\r\n                    <span class=\"navbar-toggler-icon\"></span>\r\n                </button>\r\n\r\n                <div class=\"collapse navbar-collapse justify-content-between px-lg-3\" id=\"navbarCollapse\">\r\n                    <div class=\"navbar-nav mx-auto py-0\">\r\n                        <a href=\"${pageContext.request.contextPath}/home\" id=\"nav-item-home\" class=\"nav-item nav-link\">Home</a>\r\n                        <a href=\"course.jsp\" class=\"nav-item nav-link\" id=\"nav-item-course\">Subjects</a>\r\n                        <a href=\"course.html\" class=\"nav-item nav-link\" id=\"nav-item-classes\">Classes</a>\r\n                        <a href=\"contact.html\" class=\"nav-item nav-link\" id=\"nav-item-contact\">Contact</a>\r\n                        <a href=\"${pageContext.request.contextPath}/flashcard\" id=\"nav-item-flashcard\" class=\"nav-item nav-link\">Flashcard</a>\r\n                    </div>\r\n                </div>\r\n\r\n                <c:if test=\"${sessionScope.user != null}\">\r\n                    <c:set var=\"currentPage\" value=\"${pageContext.request.requestURI}\"></c:set>\r\n                    <c:set var=\"avt\" value=\"${sessionScope.user.avatar}\"></c:set>\r\n                    <c:if test=\"${currentPage.contains('userdetails.jsp') || currentPage.contains('questiondetails.jsp')\r\n                                  || currentPage.contains('newquestion.jsp') || currentPage.contains('newuser.jsp')}\">\r\n                        <c:set var=\"avatar\" value=\"../${avt}\"></c:set>\r\n                    </c:if>\r\n                    <c:if test=\"${!currentPage.contains('userdetails.jsp') && !currentPage.contains('questiondetails.jsp')\r\n                                  && !currentPage.contains('newquestion.jsp') && !currentPage.contains('newuser.jsp')}\">\r\n                        <c:set var=\"avatar\" value=\"${avt}\"></c:set>\r\n                    </c:if>\r\n                    <div class=\"navbar-nav-right d-flex align-items-center\" id=\"navbar-collapse\">\r\n                        <ul class=\"navbar-nav flex-row align-items-center ms-auto\">\r\n                            <!-- Place this tag where you want the button to render. -->\r\n\r\n\r\n                            <!-- User -->\r\n                            <li class=\"nav-item navbar-dropdown dropdown-user dropdown\">\r\n                                <a class=\"nav-link dropdown-toggle hide-arrow\" href=\"javascript:void(0);\" data-bs-toggle=\"dropdown\">\r\n                                    <div class=\"avatar avatar-online\">\r\n                                        <img src=\"${avatar}\" alt class=\"w-px-40 h-auto rounded-circle\" />\r\n                                    </div>\r\n                                </a>\r\n                                <ul class=\"dropdown-menu dropdown-menu-end\">\r\n                                    <li>\r\n                                        <a class=\"dropdown-item\" href=\"#\">\r\n                                            <div class=\"d-flex\">\r\n                                                <div class=\"flex-shrink-0 me-3\">\r\n                                                    <div class=\"avatar avatar-online\">\r\n                                                        <img src=\"${avatar}\" alt class=\"w-px-40 h-auto rounded-circle\" />\r\n                                                    </div>\r\n                                                </div>\r\n                                                <div class=\"flex-grow-1\">\r\n                                                    <span class=\"fw-medium d-block\">${sessionScope.user.name}</span>\r\n                                                    <small class=\"text-muted\">${sessionScope.user.r.name}</small>\r\n                                                </div>\r\n                                            </div>\r\n                                        </a>\r\n                                    </li>\r\n                                    <li>\r\n                                        <div class=\"dropdown-divider\"></div>\r\n                                    </li>\r\n                                    <li>\r\n                                        <a class=\"dropdown-item\" href=\"profile.jsp\">\r\n                                            <i class=\"bx bx-user me-2\"></i>\r\n                                            <span class=\"align-middle\">My Profile</span>\r\n                                        </a>\r\n                                    </li>\r\n                                    <li>\r\n                                        <a class=\"dropdown-item\" href=\"${pageContext.request.contextPath}/dashboard\">\r\n                                            <i class=\"bx bx-bar-chart me-2\"></i>\r\n                                            <span class=\"align-middle\">Dashboard</span>\r\n                                        </a>\r\n                                    </li>\r\n                                    <li>\r\n                                        <div class=\"dropdown-divider\"></div>\r\n                                    </li>\r\n                                    <li>\r\n                                        <a class=\"dropdown-item\" href=\"${pageContext.request.contextPath}/logout\">\r\n                                            <i class=\"bx bx-power-off me-2\"></i>\r\n                                            <span class=\"align-middle\">Log Out</span>\r\n                                        </a>\r\n                                    </li>\r\n                                </ul>\r\n                            </li>\r\n                            <!--/ User -->\r\n                        </ul>\r\n                    </div>\r\n                </c:if>\r\n                <c:if test=\"${sessionScope.user == null}\">\r\n                    <div class=\"navbar-nav-right d-flex align-items-center\" id=\"navbar-collapse\">\r\n                        <a href=\"${pageContext.request.contextPath}/login.jsp\" class=\"btn btn-primary py-2 px-4 d-none d-lg-block mr-3\">Login</a>\r\n                        <a href=\"${pageContext.request.contextPath}/signup.jsp\" class=\"btn btn-primary py-2 px-4 d-none d-lg-block\">Sign up</a>\r\n                    </div>\r\n                </c:if>\r\n\r\n\r\n\r\n            </nav>\r\n        </div>\r\n        <!-- Navbar End -->\r\n\r\n        <script src=\"https://code.jquery.com/jquery-3.4.1.min.js\"></script>\r\n        <script src=\"https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.bundle.min.js\"></script>\r\n        <script src=\"lib/easing/easing.min.js\"></script>\r\n        <script src=\"lib/waypoints/waypoints.min.js\"></script>\r\n        <script src=\"lib/counterup/counterup.min.js\"></script>\r\n        <script src=\"lib/owlcarousel/owl.carousel.min.js\"></script>\r\n\r\n        <!-- Template Javascript -->\r\n        <script src=\"js/main.js\"></script>\r\n\r\n        <!-- Core JS -->\r\n        <!-- build:js assets/vendor/js/core.js -->\r\n\r\n        <script src=\"assets/vendor/libs/jquery/jquery.js\"></script>\r\n        <script src=\"assets/vendor/libs/popper/popper.js\"></script>\r\n        <script src=\"assets/vendor/js/bootstrap.js\"></script>\r\n        <script src=\"assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.js\"></script>\r\n        <script src=\"assets/vendor/js/menu.js\"></script>\r\n\r\n        <!-- endbuild -->\r\n\r\n        <!-- Vendors JS -->\r\n\r\n        <!-- Main JS -->\r\n        <script src=\"assets/js/main.js\"></script>\r\n\r\n        <!-- Page JS -->\r\n\r\n        <!-- Place this tag in your head or just before your close body tag. -->\r\n        <script async defer src=\"https://buttons.github.io/buttons.js\"></script>\r\n    </body>\r\n</html>\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/web/WEB-INF/common/header.jsp b/web/WEB-INF/common/header.jsp
--- a/web/WEB-INF/common/header.jsp	(revision d6ad1445e1c07c5da0ab8951156084fe4a182d1f)
+++ b/web/WEB-INF/common/header.jsp	(date 1721252670159)
@@ -105,25 +105,23 @@
 
                 <div class="collapse navbar-collapse justify-content-between px-lg-3" id="navbarCollapse">
                     <div class="navbar-nav mx-auto py-0">
-                        <a href="${pageContext.request.contextPath}/home" id="nav-item-home" class="nav-item nav-link">Home</a>
-                        <a href="course.jsp" class="nav-item nav-link" id="nav-item-course">Subjects</a>
-                        <a href="course.html" class="nav-item nav-link" id="nav-item-classes">Classes</a>
-                        <a href="contact.html" class="nav-item nav-link" id="nav-item-contact">Contact</a>
-                        <a href="${pageContext.request.contextPath}/flashcard" id="nav-item-flashcard" class="nav-item nav-link">Flashcard</a>
+                        <a href="${pageContext.request.contextPath}/home" 
+                           id="nav-item-home" class="nav-item nav-link text-dark">Home</a>
+                        <a href="${pageContext.request.contextPath}/course" 
+                           class="nav-item nav-link text-dark" id="nav-item-course">Subjects</a>
+                        <a href="course.jsp" class="nav-item nav-link text-dark" id="nav-item-classes">Classes</a>
+                        <a href="${pageContext.request.contextPath}/contact" 
+                           class="nav-item nav-link text-dark" id="nav-item-contact">Contact</a>
+                        <a href="${pageContext.request.contextPath}/flashcard" 
+                           id="nav-item-flashcard" class="nav-item nav-link text-dark">Flashcard</a>
                     </div>
                 </div>
 
                 <c:if test="${sessionScope.user != null}">
-                    <c:set var="currentPage" value="${pageContext.request.requestURI}"></c:set>
-                    <c:set var="avt" value="${sessionScope.user.avatar}"></c:set>
-                    <c:if test="${currentPage.contains('userdetails.jsp') || currentPage.contains('questiondetails.jsp')
-                                  || currentPage.contains('newquestion.jsp') || currentPage.contains('newuser.jsp')}">
-                        <c:set var="avatar" value="../${avt}"></c:set>
-                    </c:if>
-                    <c:if test="${!currentPage.contains('userdetails.jsp') && !currentPage.contains('questiondetails.jsp')
-                                  && !currentPage.contains('newquestion.jsp') && !currentPage.contains('newuser.jsp')}">
-                        <c:set var="avatar" value="${avt}"></c:set>
-                    </c:if>
+                    <c:set var="avatar" value="${pageContext.request.scheme}://${pageContext.request.serverName}:${pageContext.request.serverPort}${pageContext.request.contextPath}/${sessionScope.user.avatar}">
+
+                    </c:set>
+
                     <div class="navbar-nav-right d-flex align-items-center" id="navbar-collapse">
                         <ul class="navbar-nav flex-row align-items-center ms-auto">
                             <!-- Place this tag where you want the button to render. -->
@@ -161,12 +159,14 @@
                                             <span class="align-middle">My Profile</span>
                                         </a>
                                     </li>
-                                    <li>
-                                        <a class="dropdown-item" href="${pageContext.request.contextPath}/dashboard">
-                                            <i class="bx bx-bar-chart me-2"></i>
-                                            <span class="align-middle">Dashboard</span>
-                                        </a>
-                                    </li>
+                                    <c:if test="${sessionScope.user.role < 2}">
+                                        <li>
+                                            <a class="dropdown-item" href="${pageContext.request.contextPath}/dashboard">
+                                                <i class="bx bx-bar-chart me-2"></i>
+                                                <span class="align-middle">Dashboard</span>
+                                            </a>
+                                        </li>
+                                    </c:if>
                                     <li>
                                         <div class="dropdown-divider"></div>
                                     </li>
Index: src/java/common/AvatarHandler.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package common;\r\n\r\nimport dal.UserDAO;\r\nimport jakarta.servlet.http.Part;\r\nimport java.io.File;\r\nimport java.io.IOException;\r\nimport java.sql.SQLException;\r\nimport model.user.User;\r\n\r\npublic class AvatarHandler {\r\n\r\n    UserDAO userDAO = new UserDAO();\r\n\r\n    private void removeOldAvatar(String oldUri, String workingDir) {\r\n        String uri = workingDir + \"\\\\\" + oldUri.replace(\"/\", \"\\\\\");\r\n        File file = new File(uri);\r\n        System.out.println(uri);\r\n        if (file.exists()) {\r\n            file.delete();\r\n        }\r\n    }\r\n\r\n    private void deleteOldAvatar(String oldUri, String workingDir) {\r\n        if (!userDAO.isAvtExist(oldUri) && !oldUri.equals(\"assets/img/default_avt.jpg\")\r\n                && oldUri != null && !oldUri.isEmpty()) {\r\n            removeOldAvatar(oldUri, workingDir);\r\n        }\r\n    }\r\n\r\n    public void changeAvatar(int userId, String workingFolder, String workingDir,\r\n            Part filePart) throws IOException, SQLException {\r\n\r\n        FileHandler fileHandler = new FileHandler(workingFolder);\r\n        String uri = fileHandler.fileUpload(workingDir, filePart);\r\n        uri = (\"\" + uri).replace(\"\\\\\", \"/\");\r\n\r\n        User u = userDAO.getUserById(userId);\r\n        String oldUri = u.getAvatar();\r\n        System.out.println(oldUri);\r\n        deleteOldAvatar(oldUri, workingDir);\r\n\r\n        u.setAvatar(uri);\r\n        userDAO.updateAvatar(u);\r\n    }\r\n\r\n    public String uploadAvatar(String workingFolder, String workingDir, Part filePart, String oldUri)\r\n            throws IOException {\r\n        FileHandler fileHandler = new FileHandler(workingFolder);\r\n        String uri = fileHandler.fileUpload(workingDir, filePart);\r\n        uri = (\"\" + uri).replace(\"\\\\\", \"/\");\r\n        deleteOldAvatar(oldUri, workingDir);\r\n        return uri;\r\n    }\r\n\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/java/common/AvatarHandler.java b/src/java/common/AvatarHandler.java
--- a/src/java/common/AvatarHandler.java	(revision d6ad1445e1c07c5da0ab8951156084fe4a182d1f)
+++ b/src/java/common/AvatarHandler.java	(date 1721252670148)
@@ -36,7 +36,6 @@
 
         User u = userDAO.getUserById(userId);
         String oldUri = u.getAvatar();
-        System.out.println(oldUri);
         deleteOldAvatar(oldUri, workingDir);
 
         u.setAvatar(uri);
Index: web/js/header.js
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>(function () {\r\n    let href = window.location.href;\r\n    var elementId;\r\n    if (href.includes('/home') || href === 'http://localhost:8080/se1808-g6/') {\r\n        elementId = 'nav-item-home';\r\n    } else {\r\n        if (href.includes('/flashcard')) {\r\n            elementId = 'nav-item-flashcard';\r\n        }\r\n        else{\r\n            if (href.includes('/course')) {\r\n            elementId = 'nav-item-course';\r\n        }\r\n        }\r\n    }\r\n    document.getElementById(elementId).className = \"nav-item nav-link text-primary\";\r\n}\r\n)();
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/web/js/header.js b/web/js/header.js
--- a/web/js/header.js	(revision d6ad1445e1c07c5da0ab8951156084fe4a182d1f)
+++ b/web/js/header.js	(date 1721252670199)
@@ -3,16 +3,15 @@
     var elementId;
     if (href.includes('/home') || href === 'http://localhost:8080/se1808-g6/') {
         elementId = 'nav-item-home';
-    } else {
-        if (href.includes('/flashcard')) {
-            elementId = 'nav-item-flashcard';
-        }
-        else{
-            if (href.includes('/course')) {
-            elementId = 'nav-item-course';
-        }
-        }
+    } else if (href.includes('/flashcard')) {
+        elementId = 'nav-item-flashcard';
+    } else if (href.includes('/course')) {
+        elementId = 'nav-item-course';
+    } else if (href.includes('/contact')) {
+        elementId = 'nav-item-contact';
     }
+
+
     document.getElementById(elementId).className = "nav-item nav-link text-primary";
 }
 )();
\ No newline at end of file
Index: web/js/sider.js
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>(function () {\r\n    let href = window.location.href;\r\n    var elementId;\r\n    if (href.includes('/dashboard')) {\r\n        elementId = 'dashboard-menu-item';\r\n    } else {\r\n        if (href.includes('/question')) {\r\n            elementId = 'question-menu-item';\r\n        } else {\r\n            if (href.includes('/user')) {\r\n                elementId = 'user-menu-item';\r\n            } else{\r\n                if (href.includes(\"/lesson\")){\r\n                    elementId = 'lesson-menu-item';\r\n                }\r\n            }\r\n        }\r\n    }\r\n    document.getElementById(elementId).className = \"menu-item active\";\r\n}\r\n)();
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/web/js/sider.js b/web/js/sider.js
--- a/web/js/sider.js	(revision d6ad1445e1c07c5da0ab8951156084fe4a182d1f)
+++ b/web/js/sider.js	(date 1721252670209)
@@ -3,19 +3,14 @@
     var elementId;
     if (href.includes('/dashboard')) {
         elementId = 'dashboard-menu-item';
-    } else {
-        if (href.includes('/question')) {
-            elementId = 'question-menu-item';
-        } else {
-            if (href.includes('/user')) {
-                elementId = 'user-menu-item';
-            } else{
-                if (href.includes("/lesson")){
-                    elementId = 'lesson-menu-item';
-                }
-            }
-        }
+    } else if (href.includes('/question')) {
+        elementId = 'question-menu-item';
+    } else if (href.includes('/user')) {
+        elementId = 'user-menu-item';
+    } else if (href.includes("/lesson")) {
+        elementId = 'lesson-menu-item';
     }
+
     document.getElementById(elementId).className = "menu-item active";
 }
 )();
\ No newline at end of file
Index: src/java/controller/flashcard/FlashcardUtils.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/java/controller/flashcard/FlashcardUtils.java b/src/java/controller/flashcard/FlashcardUtils.java
new file mode 100644
--- /dev/null	(date 1721252670148)
+++ b/src/java/controller/flashcard/FlashcardUtils.java	(date 1721252670148)
@@ -0,0 +1,4 @@
+package controller.flashcard;
+
+public class FlashcardUtils {
+}
Index: src/java/controller/UserServlet.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package controller;\r\n\r\nimport common.AvatarHandler;\r\nimport common.EmailValidator;\r\nimport common.PasswordGenerator;\r\nimport dal.UserDAO;\r\nimport java.io.IOException;\r\nimport java.io.PrintWriter;\r\nimport jakarta.servlet.ServletException;\r\nimport jakarta.servlet.annotation.MultipartConfig;\r\nimport jakarta.servlet.annotation.WebServlet;\r\nimport jakarta.servlet.http.HttpServlet;\r\nimport jakarta.servlet.http.HttpServletRequest;\r\nimport jakarta.servlet.http.HttpServletResponse;\r\nimport jakarta.servlet.http.HttpSession;\r\nimport jakarta.servlet.http.Part;\r\nimport java.sql.SQLException;\r\nimport java.util.ArrayList;\r\nimport java.util.Collections;\r\nimport mail.SendMail;\r\nimport model.user.*;\r\n\r\n@MultipartConfig\r\n@WebServlet(name = \"UserServlet\", urlPatterns = {\"/user\", \"/user/update\", \"/user/details\", \"/user/new\"})\r\npublic class UserServlet extends HttpServlet {\r\n\r\n    protected void processRequest(HttpServletRequest request, HttpServletResponse response)\r\n            throws ServletException, IOException {\r\n        response.setContentType(\"text/html;charset=UTF-8\");\r\n        try (PrintWriter out = response.getWriter()) {\r\n            /* TODO output your page here. You may use following sample code. */\r\n            out.println(\"<!DOCTYPE html>\");\r\n            out.println(\"<html>\");\r\n            out.println(\"<head>\");\r\n            out.println(\"<title>Servlet UserServlet</title>\");\r\n            out.println(\"</head>\");\r\n            out.println(\"<body>\");\r\n            out.println(\"<h1>Servlet UserServlet at \" + request.getContextPath() + \"</h1>\");\r\n            out.println(\"</body>\");\r\n            out.println(\"</html>\");\r\n        }\r\n    }\r\n\r\n    UserDAO userDAO = new UserDAO();\r\n    AvatarHandler avatarHandler = new AvatarHandler();\r\n    private final int rowPerPage = 6;\r\n\r\n    private String getWorkingDir() {\r\n        String directory = getServletContext().getRealPath(\"\") + \"\";\r\n        return directory.replace(\"\\\\build\\\\web\\\\\", \"\\\\web\\\\\");\r\n    }\r\n\r\n    void refreshSession(HttpSession session, User user) {\r\n        session.setAttribute(\"user\", user);\r\n    }\r\n\r\n    @Override\r\n    protected void doGet(HttpServletRequest request, HttpServletResponse response)\r\n            throws ServletException, IOException {\r\n        doPost(request, response);\r\n\r\n    }\r\n\r\n    @Override\r\n    protected void doPost(HttpServletRequest request, HttpServletResponse response)\r\n            throws ServletException, IOException {\r\n        HttpSession session = request.getSession();\r\n        User user = (User) session.getAttribute(\"user\");\r\n        if (user != null) {\r\n            refreshSession(session, userDAO.getUserById(user.getId()));\r\n        }\r\n        /*HttpSession session = request.getSession();\r\n        User user = (User) session.getAttribute(\"user\");\r\n        if (user == null) {\r\n            response.sendRedirect(\"login.jsp\");\r\n        } else if (user.getRole() != 0) {\r\n            response.sendRedirect(\"home\");\r\n        } else {\r\n            refreshSession(request);*/\r\n        String action = request.getServletPath();\r\n        switch (action) {\r\n            case \"/user\":\r\n                viewUserList(request, response);\r\n                break;\r\n            case \"/user/update\":\r\n                updateUser(request, response);\r\n                break;\r\n            case \"/user/details\":\r\n                viewUserDetails(request, response);\r\n                break;\r\n            case \"/user/new\":\r\n                newUser(request, response);\r\n                break;\r\n        }\r\n\r\n    }\r\n\r\n    private ArrayList<String> allSortOptions() {\r\n        ArrayList<String> list = new ArrayList<>();\r\n        list.add(\"Name\");\r\n        list.add(\"Email\");\r\n        list.add(\"Role\");\r\n        list.add(\"Status\");\r\n        return list;\r\n    }\r\n\r\n    private ArrayList<User> getUsersMatchRole(int roleId, ArrayList<User> list) {\r\n        ArrayList<User> ret = new ArrayList<>();\r\n        for (User user : list) {\r\n            if (user.getRole() == roleId) {\r\n                ret.add(user);\r\n            }\r\n        }\r\n        return ret;\r\n    }\r\n\r\n    private ArrayList<User> getUsersContainKeyWord(String keyWord, ArrayList<User> list) {\r\n        ArrayList<User> ret = new ArrayList<>();\r\n        for (User user : list) {\r\n            if (user.getName().contains(keyWord) || user.getEmail().contains(keyWord)) {\r\n                ret.add(user);\r\n            }\r\n        }\r\n        return ret;\r\n    }\r\n\r\n    private int getNoOfPages(ArrayList<User> list) {\r\n        int length = list.size();\r\n        if (length == 0) {\r\n            return 1;\r\n        }\r\n        int noOfPages = length / rowPerPage;\r\n        if (length % rowPerPage == 0) {\r\n            return noOfPages;\r\n        }\r\n        return noOfPages + 1;\r\n    }\r\n\r\n    private int getPage(HttpServletRequest request, int noOfPages) {\r\n        String cur = request.getParameter(\"currentPage\");\r\n        if ((cur == null) || (cur.isEmpty())) {\r\n            return 1;\r\n        }\r\n\r\n        int currentPage = Integer.parseInt(cur);\r\n        switch (request.getParameter(\"pageAction\")) {\r\n            case \"firstPage\":\r\n                return 1;\r\n            case \"prevPage\": {\r\n                currentPage--;\r\n                if (currentPage < 1) {\r\n                    return 1;\r\n                } else {\r\n                    return currentPage;\r\n                }\r\n            }\r\n            case \"nextPage\": {\r\n                currentPage++;\r\n                if (currentPage > noOfPages) {\r\n                    return noOfPages;\r\n                } else {\r\n                    return currentPage;\r\n                }\r\n            }\r\n            case \"lastPage\":\r\n                return noOfPages;\r\n        }\r\n\r\n        String newpage = request.getParameter(\"newPage\");\r\n        if ((newpage != null) && (!newpage.isEmpty())) {\r\n            int newPage = Integer.parseInt(newpage);\r\n            return newPage;\r\n        }\r\n        return currentPage;\r\n\r\n    }\r\n\r\n    private int getAdminIndex(ArrayList<Role> roleList) {\r\n        int index = 0;\r\n        for (Role role : roleList) {\r\n            if (role.getName().equals(\"Admin\")) {\r\n                return index;\r\n            }\r\n            index++;\r\n        }\r\n        return -1;\r\n    }\r\n\r\n    private ArrayList<Role> getRoleList() {\r\n        ArrayList<Role> roleList = userDAO.getAllRoles();\r\n        int index = getAdminIndex(roleList);\r\n        if (index != -1) {\r\n            roleList.remove(getAdminIndex(roleList));\r\n        }\r\n        return roleList;\r\n    }\r\n\r\n    private ArrayList<User> getAllUsersOfPage(int page, ArrayList<User> list) {\r\n        ArrayList<User> ret = new ArrayList<>();\r\n        int start = rowPerPage * (page - 1) + 1;\r\n        int end = rowPerPage * page;\r\n        if (start < 1) {\r\n            start = 1;\r\n        }\r\n        if (end > list.size()) {\r\n            end = list.size();\r\n        }\r\n\r\n        for (int i = start - 1; i < end; i++) {\r\n            ret.add(list.get(i));\r\n        }\r\n        return ret;\r\n    }\r\n\r\n    private void viewUserList(HttpServletRequest request, HttpServletResponse response)\r\n            throws ServletException, IOException {\r\n        ArrayList<User> list = userDAO.getAllUsers();\r\n\r\n        String rid = request.getParameter(\"roleId\");\r\n        if (rid != null && !rid.isEmpty()) {\r\n            int roleId = Integer.parseInt(rid);\r\n            request.setAttribute(\"roleId\", roleId);\r\n            if (roleId != 0) {\r\n                list = getUsersMatchRole(roleId, list);\r\n            }\r\n        }\r\n\r\n        String keyWord = request.getParameter(\"keyWord\");\r\n        if (keyWord != null && !keyWord.isEmpty()) {\r\n            list = getUsersContainKeyWord(keyWord, list);\r\n        }\r\n\r\n        String sortBy = request.getParameter(\"sortBy\");\r\n        if (sortBy != null && !sortBy.isEmpty()) {\r\n            switch (sortBy) {\r\n                case \"Name\":\r\n                    Collections.sort(list, new User.SortByName());\r\n                    break;\r\n                case \"Email\":\r\n                    Collections.sort(list, new User.SortByEmail());\r\n                    break;\r\n                case \"Role\":\r\n                    Collections.sort(list, new User.SortByRole());\r\n                    break;\r\n                case \"Status\":\r\n                    Collections.sort(list, new User.SortByStatus());\r\n                    break;\r\n            }\r\n        }\r\n\r\n        int noOfPages = getNoOfPages(list);\r\n        int currentPage = getPage(request, noOfPages);\r\n        list = getAllUsersOfPage(currentPage, list);\r\n\r\n        request.setAttribute(\"list\", list);\r\n        request.setAttribute(\"roleList\", getRoleList());\r\n        request.setAttribute(\"keyWord\", keyWord);\r\n        request.setAttribute(\"sortOptions\", allSortOptions());\r\n        request.setAttribute(\"sortBy\", sortBy);\r\n        request.setAttribute(\"currentPage\", currentPage);\r\n        request.setAttribute(\"noOfPages\", noOfPages);\r\n        request.getRequestDispatcher(\"/WEB-INF/views/user/userlist.jsp\").forward(request, response);\r\n    }\r\n\r\n    private void changeUserStatus(HttpServletRequest request, HttpServletResponse response)\r\n            throws IOException {\r\n        int userId = Integer.parseInt(request.getParameter(\"userId\"));\r\n        System.out.println(userId);\r\n        userDAO.changeUserStatus(userId);\r\n        response.sendRedirect(\"../user\");\r\n    }\r\n\r\n    private void saveChanges(HttpServletRequest request, HttpServletResponse response)\r\n            throws ServletException, IOException {\r\n        boolean successful = true;\r\n        int userId = Integer.parseInt(request.getParameter(\"userId\"));\r\n        User user = userDAO.getUserById(userId);\r\n        String name = request.getParameter(\"name\");\r\n        if (name == null || name.isEmpty()) {\r\n            request.setAttribute(\"nameErr\", \"Name is blank!\");\r\n            successful = false;\r\n        } else {\r\n            if (name.length() > 50) {\r\n                successful = false;\r\n                request.setAttribute(\"nameErr\", \"Name can not exceed 50 characters!\");\r\n            }\r\n        }\r\n        Part filePart = request.getPart(\"newAvatar\");\r\n        if (filePart != null && filePart.getSize() != 0) {\r\n            String workingDir = getWorkingDir();\r\n            String workingFolder = \"assets\\\\img\";\r\n            try {\r\n                avatarHandler.changeAvatar(userId, workingFolder, workingDir, filePart);\r\n            } catch (SQLException | IOException e) {\r\n                successful = false;\r\n                request.setAttribute(\"avtErr\", \"Upload image failed!\");\r\n            }\r\n        }\r\n\r\n        user.setName(name);\r\n        user.setRole(Integer.parseInt(request.getParameter(\"roleId\")));\r\n        if (successful) {\r\n            try {\r\n                userDAO.updateUser(user);\r\n            } catch (SQLException e) {\r\n                request.setAttribute(\"updateErr\", \"Update failed! Please try again later!\");\r\n                successful = false;\r\n            }\r\n        }\r\n\r\n        if (successful) {\r\n            response.sendRedirect(\"../user\");\r\n        } else {\r\n            request.setAttribute(\"user\", user);\r\n            request.setAttribute(\"roleList\", getRoleList());\r\n            request.getRequestDispatcher(\"/WEB-INF/views/user/userdetails.jsp\").forward(request, response);\r\n        }\r\n    }\r\n\r\n    private void updateUser(HttpServletRequest request, HttpServletResponse response)\r\n            throws IOException, ServletException {\r\n        switch (request.getParameter(\"action\")) {\r\n            case \"changeStatus\":\r\n                changeUserStatus(request, response);\r\n                break;\r\n            case \"saveChanges\":\r\n                saveChanges(request, response);\r\n                break;\r\n        }\r\n    }\r\n\r\n    private void viewUserDetails(HttpServletRequest request, HttpServletResponse response)\r\n            throws IOException, ServletException {\r\n        int userId = Integer.parseInt(request.getParameter(\"userId\"));\r\n        User user = userDAO.getUserById(userId);\r\n\r\n        request.setAttribute(\"user\", user);\r\n        request.setAttribute(\"roleList\", getRoleList());\r\n        request.getRequestDispatcher(\"/WEB-INF/views/user/userdetails.jsp\").forward(request, response);\r\n    }\r\n\r\n    private void goToPage(HttpServletRequest request, HttpServletResponse response)\r\n            throws IOException, ServletException {\r\n        request.setAttribute(\"roleList\", getRoleList());\r\n        request.getRequestDispatcher(\"/WEB-INF/views/user/newuser.jsp\").forward(request, response);\r\n    }\r\n\r\n    private void addUser(HttpServletRequest request, HttpServletResponse response)\r\n            throws IOException, ServletException {\r\n        boolean successful = true;\r\n        User user = new User();\r\n        String name = request.getParameter(\"name\");\r\n        if (name == null || name.isEmpty()) {\r\n            request.setAttribute(\"nameErr\", \"Name is blank!\");\r\n            successful = false;\r\n        } else {\r\n            if (name.length() > 50) {\r\n                successful = false;\r\n                request.setAttribute(\"nameErr\", \"Name can not exceed 50 characters!\");\r\n            }\r\n        }\r\n        user.setName(name);\r\n        user.setRole(Integer.parseInt(request.getParameter(\"roleId\")));\r\n        String avt = request.getParameter(\"avt\");\r\n        Part filePart = request.getPart(\"avatar\");\r\n        if (filePart == null || filePart.getSize() == 0) {\r\n            user.setAvatar(avt);\r\n        } else {\r\n            String workingDir = getWorkingDir();\r\n            String workingFolder = \"assets\\\\img\";\r\n            user.setAvatar(avatarHandler.uploadAvatar(workingFolder, workingDir, filePart, avt));\r\n        }\r\n        String email = request.getParameter(\"email\");\r\n        user.setEmail(email);\r\n        if (email == null || email.isEmpty()) {\r\n            successful = false;\r\n            request.setAttribute(\"emailErr\", \"Email is blank!\");\r\n        } else {\r\n            if (email.length() > 35) {\r\n                successful = false;\r\n                request.setAttribute(\"emailErr\", \"Email can not exceed 35 characters!\");\r\n            } else {\r\n                if (!EmailValidator.validate(email)) {\r\n                    successful = false;\r\n                    request.setAttribute(\"emailErr\", \"Please enter a valid email!\");\r\n                } else {\r\n                    if (userDAO.checkEmailExist(email)) {\r\n                        successful = false;\r\n                        request.setAttribute(\"emailErr\", \"Email has already been registered, please head to login!\");\r\n                    } else {\r\n                        try {\r\n                            user.setStatus(2);\r\n                            String password = PasswordGenerator.generateRandomPassword();\r\n                            userDAO.addUser(user, password);\r\n                            String receiver = user.getEmail();\r\n                            String subject = \"Password for Knowledge Revising System\";\r\n                            String content = \"Hi, you have been invited to join our Knowledge Revising System website \\n\\n\";\r\n                            content += \"Please login by your email with password \" + password + \" to access our system.\";\r\n                            SendMail.sendMail(receiver, subject, content);\r\n                        } catch (SQLException e) {\r\n                            successful = false;\r\n                            request.setAttribute(\"err\", \"Failed to add user, please try again later!\");\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        if (successful) {\r\n            response.sendRedirect(\"../user\");\r\n        } else {\r\n            request.setAttribute(\"user\", user);\r\n            request.setAttribute(\"roleList\", getRoleList());\r\n            request.getRequestDispatcher(\"/WEB-INF/views/user/newuser.jsp\").forward(request, response);\r\n        }\r\n    }\r\n\r\n    private void newUser(HttpServletRequest request, HttpServletResponse response)\r\n            throws IOException, ServletException {\r\n        switch (request.getParameter(\"action\")) {\r\n            case \"goToPage\":\r\n                goToPage(request, response);\r\n                break;\r\n            case \"addUser\":\r\n                addUser(request, response);\r\n                break;\r\n        }\r\n    }\r\n\r\n    @Override\r\n    public String getServletInfo() {\r\n        return \"Short description\";\r\n    }// </editor-fold>\r\n\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/java/controller/UserServlet.java b/src/java/controller/UserServlet.java
--- a/src/java/controller/UserServlet.java	(revision d6ad1445e1c07c5da0ab8951156084fe4a182d1f)
+++ b/src/java/controller/UserServlet.java	(date 1721252670148)
@@ -3,6 +3,7 @@
 import common.AvatarHandler;
 import common.EmailValidator;
 import common.PasswordGenerator;
+import dal.SubjectDAO;
 import dal.UserDAO;
 import java.io.IOException;
 import java.io.PrintWriter;
@@ -18,6 +19,7 @@
 import java.util.ArrayList;
 import java.util.Collections;
 import mail.SendMail;
+import model.subject.Subject;
 import model.user.*;
 
 @MultipartConfig
@@ -50,10 +52,6 @@
         return directory.replace("\\build\\web\\", "\\web\\");
     }
 
-    void refreshSession(HttpSession session, User user) {
-        session.setAttribute("user", user);
-    }
-
     @Override
     protected void doGet(HttpServletRequest request, HttpServletResponse response)
             throws ServletException, IOException {
@@ -64,33 +62,40 @@
     @Override
     protected void doPost(HttpServletRequest request, HttpServletResponse response)
             throws ServletException, IOException {
+
+        String contextPath = request.getServletContext().getContextPath();
+        String loginPage = contextPath + "/login.jsp";
+        String homePage = contextPath + "/home";
         HttpSession session = request.getSession();
-        User user = (User) session.getAttribute("user");
-        if (user != null) {
-            refreshSession(session, userDAO.getUserById(user.getId()));
-        }
-        /*HttpSession session = request.getSession();
         User user = (User) session.getAttribute("user");
         if (user == null) {
-            response.sendRedirect("login.jsp");
-        } else if (user.getRole() != 0) {
-            response.sendRedirect("home");
+            response.sendRedirect(loginPage);
         } else {
-            refreshSession(request);*/
-        String action = request.getServletPath();
-        switch (action) {
-            case "/user":
-                viewUserList(request, response);
-                break;
-            case "/user/update":
-                updateUser(request, response);
-                break;
-            case "/user/details":
-                viewUserDetails(request, response);
-                break;
-            case "/user/new":
-                newUser(request, response);
-                break;
+            User u = userDAO.getUserById(user.getId());
+            if (u != null && u.getEmail() != null) {
+                session.setAttribute("user", u);
+                if (user.getRole() != 0) {
+                    response.sendRedirect(homePage);
+                } else {
+                    String action = request.getServletPath();
+                    switch (action) {
+                        case "/user":
+                            viewUserList(request, response);
+                            break;
+                        case "/user/update":
+                            updateUser(request, response);
+                            break;
+                        case "/user/details":
+                            viewUserDetails(request, response);
+                            break;
+                        case "/user/new":
+                            newUser(request, response);
+                            break;
+                    }
+                }
+            } else {
+                response.sendRedirect(loginPage);
+            }
         }
 
     }
@@ -317,6 +322,68 @@
         }
     }
 
+    private void assignSubject(HttpServletRequest request, HttpServletResponse response)
+            throws ServletException, IOException {
+        boolean successful = true;
+        int userId = Integer.parseInt(request.getParameter("userId"));
+        int subjectId = Integer.parseInt(request.getParameter("subjectId"));
+
+        try {
+            userDAO.assignSubject(userId, subjectId);
+        } catch (SQLException e) {
+            successful = false;
+            request.setAttribute("err", "Assign subject failed!");
+        }
+
+        if (successful) {
+            String contextPath = request.getServletContext().getContextPath();
+            String redirectPage = contextPath + "/user/details";
+            HttpSession session = request.getSession();
+            session.setAttribute("userId", userId);
+            session.setAttribute("currentPage", "assignSubject");
+            response.sendRedirect(redirectPage);
+        } else {
+            request.setAttribute("user", userDAO.getUserById(userId));
+            request.setAttribute("roleList", getRoleList());
+            ArrayList<Subject> subjectList = userDAO.getAllSubjectsInCharged(userId);
+            request.setAttribute("subjectList", subjectList);
+            request.setAttribute("unassignedSubjectList", getAllSubjectsNotInCharged(subjectList));
+            request.setAttribute("currentPage", "assignSubject");
+            request.getRequestDispatcher("/WEB-INF/views/user/userdetails.jsp").forward(request, response);
+        }
+    }
+
+    private void removeSubject(HttpServletRequest request, HttpServletResponse response)
+            throws ServletException, IOException {
+        boolean successful = true;
+        int userId = Integer.parseInt(request.getParameter("userId"));
+        int subjectId = Integer.parseInt(request.getParameter("subjectId"));
+
+        try {
+            userDAO.removeAssignedSubject(userId, subjectId);
+        } catch (SQLException e) {
+            successful = false;
+            request.setAttribute("err", "Remove subject failed!");
+        }
+
+        if (successful) {
+            String contextPath = request.getServletContext().getContextPath();
+            String redirectPage = contextPath + "/user/details";
+            HttpSession session = request.getSession();
+            session.setAttribute("userId", userId);
+            session.setAttribute("currentPage", "assignSubject");
+            response.sendRedirect(redirectPage);
+        } else {
+            request.setAttribute("user", userDAO.getUserById(userId));
+            request.setAttribute("roleList", getRoleList());
+            ArrayList<Subject> subjectList = userDAO.getAllSubjectsInCharged(userId);
+            request.setAttribute("subjectList", subjectList);
+            request.setAttribute("unassignedSubjectList", getAllSubjectsNotInCharged(subjectList));
+            request.setAttribute("currentPage", "assignSubject");
+            request.getRequestDispatcher("/WEB-INF/views/user/userdetails.jsp").forward(request, response);
+        }
+    }
+
     private void updateUser(HttpServletRequest request, HttpServletResponse response)
             throws IOException, ServletException {
         switch (request.getParameter("action")) {
@@ -326,16 +393,56 @@
             case "saveChanges":
                 saveChanges(request, response);
                 break;
+            case "assignSubject":
+                assignSubject(request, response);
+                break;
+            case "removeSubject":
+                removeSubject(request, response);
+                break;
         }
     }
 
+    private boolean isSubjectAssigned(ArrayList<Subject> subjectList, Subject s) {
+        for (Subject subject : subjectList) {
+            if (subject.getId() == s.getId()) {
+                return true;
+            }
+        }
+        return false;
+    }
+
+    private ArrayList<Subject> getAllSubjectsNotInCharged(ArrayList<Subject> subjectList) {
+        SubjectDAO subjectDAO = new SubjectDAO();
+        ArrayList<Subject> allSubject = subjectDAO.getAllSubject();
+        ArrayList<Subject> ret = new ArrayList<>();
+        for (Subject s : allSubject) {
+            if (!isSubjectAssigned(subjectList, s)) {
+                ret.add(s);
+            }
+        }
+        return ret;
+    }
+
     private void viewUserDetails(HttpServletRequest request, HttpServletResponse response)
             throws IOException, ServletException {
-        int userId = Integer.parseInt(request.getParameter("userId"));
+        int userId;
+        HttpSession session = request.getSession();
+        if (session.getAttribute("userId") != null) {
+            userId = (int) session.getAttribute("userId");
+            session.removeAttribute("userId");
+        } else {
+            userId = Integer.parseInt(request.getParameter("userId"));
+        }
         User user = userDAO.getUserById(userId);
 
+        request.setAttribute("currentPage", session.getAttribute("currentPage"));
+        session.removeAttribute("currentPage");
+
         request.setAttribute("user", user);
         request.setAttribute("roleList", getRoleList());
+        ArrayList<Subject> subjectList = userDAO.getAllSubjectsInCharged(userId);
+        request.setAttribute("subjectList", subjectList);
+        request.setAttribute("unassignedSubjectList", getAllSubjectsNotInCharged(subjectList));
         request.getRequestDispatcher("/WEB-INF/views/user/userdetails.jsp").forward(request, response);
     }
 
Index: src/java/controller/login/ActivationServlet.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package controller.login;\r\n\r\nimport dal.UserDAO;\r\nimport java.io.IOException;\r\nimport java.io.PrintWriter;\r\nimport jakarta.servlet.ServletException;\r\nimport jakarta.servlet.http.HttpServlet;\r\nimport jakarta.servlet.http.HttpServletRequest;\r\nimport jakarta.servlet.http.HttpServletResponse;\r\nimport jakarta.servlet.http.HttpSession;\r\nimport model.user.User;\r\n\r\npublic class ActivationServlet extends HttpServlet {\r\n\r\n    protected void processRequest(HttpServletRequest request, HttpServletResponse response)\r\n            throws ServletException, IOException {\r\n        response.setContentType(\"text/html;charset=UTF-8\");\r\n        try (PrintWriter out = response.getWriter()) {\r\n            /* TODO output your page here. You may use following sample code. */\r\n            out.println(\"<!DOCTYPE html>\");\r\n            out.println(\"<html>\");\r\n            out.println(\"<head>\");\r\n            out.println(\"<title>Servlet ActivationServlet</title>\");\r\n            out.println(\"</head>\");\r\n            out.println(\"<body>\");\r\n            out.println(\"<h1>Servlet ActivationServlet at \" + request.getContextPath() + \"</h1>\");\r\n            out.println(\"</body>\");\r\n            out.println(\"</html>\");\r\n        }\r\n    }\r\n\r\n    @Override\r\n    protected void doGet(HttpServletRequest request, HttpServletResponse response)\r\n            throws ServletException, IOException {\r\n        processRequest(request, response);\r\n    }\r\n\r\n    @Override\r\n    protected void doPost(HttpServletRequest request, HttpServletResponse response)\r\n            throws ServletException, IOException {\r\n        UserDAO userDAO = new UserDAO();\r\n        boolean successful = true;\r\n\r\n        String enteredCode = request.getParameter(\"code\");\r\n        String activationCode = request.getParameter(\"activationCode\");\r\n\r\n        if (enteredCode == null || enteredCode.isEmpty()) {\r\n            successful = false;\r\n            request.setAttribute(\"err\", \"Please enter your code!\");\r\n        } else {\r\n            if (!enteredCode.equals(activationCode)) {\r\n                successful = false;\r\n                request.setAttribute(\"err\", \"Incorrect code!\");\r\n            }\r\n        }\r\n\r\n        int userId = Integer.parseInt(request.getParameter(\"userId\"));\r\n        User user = userDAO.getUserById(userId);\r\n\r\n        if (successful) {\r\n            userDAO.changeUserStatus(userId);\r\n            HttpSession session = request.getSession();\r\n            session.setAttribute(\"user\", user);\r\n            response.sendRedirect(\"dashboard\");\r\n        } else {\r\n            request.setAttribute(\"code\", enteredCode);\r\n            request.setAttribute(\"activationCode\", activationCode);\r\n            request.setAttribute(\"user\", user);\r\n            request.getRequestDispatcher(\"enteractivationcode.jsp\").forward(request, response);\r\n        }\r\n    }\r\n\r\n    @Override\r\n    public String getServletInfo() {\r\n        return \"Short description\";\r\n    }// </editor-fold>\r\n\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/java/controller/login/ActivationServlet.java b/src/java/controller/login/ActivationServlet.java
--- a/src/java/controller/login/ActivationServlet.java	(revision d6ad1445e1c07c5da0ab8951156084fe4a182d1f)
+++ b/src/java/controller/login/ActivationServlet.java	(date 1721252670148)
@@ -66,7 +66,7 @@
             request.setAttribute("code", enteredCode);
             request.setAttribute("activationCode", activationCode);
             request.setAttribute("user", user);
-            request.getRequestDispatcher("enteractivationcode.jsp").forward(request, response);
+            request.getRequestDispatcher("/WEB-INF/account/enteractivationcode.jsp").forward(request, response);
         }
     }
 
Index: src/java/controller/LessonServlet.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package controller;\r\n\r\nimport dal.LessonDAO;\r\nimport dal.SubjectDAO;\r\nimport dal.UserDAO;\r\nimport java.io.IOException;\r\nimport java.io.PrintWriter;\r\nimport jakarta.servlet.ServletException;\r\nimport jakarta.servlet.annotation.WebServlet;\r\nimport jakarta.servlet.http.HttpServlet;\r\nimport jakarta.servlet.http.HttpServletRequest;\r\nimport jakarta.servlet.http.HttpServletResponse;\r\nimport jakarta.servlet.http.HttpSession;\r\nimport java.sql.SQLException;\r\nimport java.util.ArrayList;\r\nimport model.Lesson;\r\nimport model.subject.Subject;\r\nimport model.user.User;\r\n\r\n@WebServlet(urlPatterns = {\"/lesson\", \"/lesson/new\", \"/lesson/insert\", \"/lesson/details\", \"/lesson/update\"})\r\npublic class LessonServlet extends HttpServlet {\r\n\r\n    private final int rowPerPage = 6;\r\n\r\n    protected void processRequest(HttpServletRequest request, HttpServletResponse response)\r\n            throws ServletException, IOException {\r\n        response.setContentType(\"text/html;charset=UTF-8\");\r\n        try (PrintWriter out = response.getWriter()) {\r\n            /* TODO output your page here. You may use following sample code. */\r\n            out.println(\"<!DOCTYPE html>\");\r\n            out.println(\"<html>\");\r\n            out.println(\"<head>\");\r\n            out.println(\"<title>Servlet LessonListServlet</title>\");\r\n            out.println(\"</head>\");\r\n            out.println(\"<body>\");\r\n            out.println(\"<h1>Servlet LessonListServlet at \" + request.getContextPath() + \"</h1>\");\r\n            out.println(\"</body>\");\r\n            out.println(\"</html>\");\r\n        }\r\n    }\r\n\r\n    void refreshSession(HttpServletRequest request, int userId) {\r\n        HttpSession session = request.getSession();\r\n        UserDAO userDAO = new UserDAO();\r\n        session.setAttribute(\"user\", userDAO.getUserById(userId));\r\n    }\r\n\r\n    @Override\r\n    protected void doGet(HttpServletRequest request, HttpServletResponse response)\r\n            throws ServletException, IOException {\r\n        doPost(request, response);\r\n    }\r\n\r\n    LessonDAO lessonDAO = new LessonDAO();\r\n    SubjectDAO subjectDAO = new SubjectDAO();\r\n\r\n    @Override\r\n    protected void doPost(HttpServletRequest request, HttpServletResponse response)\r\n            throws ServletException, IOException {\r\n        HttpSession session = request.getSession();\r\n        User user = (User) session.getAttribute(\"user\");\r\n        /*if (user == null) {\r\n            response.sendRedirect(request.getContextPath() + \"/login.jsp\");\r\n        } else if (user.getRole() == -1) {\r\n            response.sendRedirect(\"../home\");\r\n        } else {\r\n            refreshSession(request, user.getId());\r\n         */\r\n        String action = request.getServletPath();\r\n        switch (action) {\r\n            case \"/lesson\":\r\n                viewLessonList(request, response);\r\n                break;\r\n            case \"/lesson/new\":\r\n                newLesson(request, response);\r\n                break;\r\n            case \"/lesson/insert\":\r\n                insertNewLesson(request, response);\r\n                break;\r\n            case \"/lesson/details\":\r\n                viewLessonDetails(request, response);\r\n                break;\r\n            case \"/lesson/update\":\r\n                updateLesson(request, response);\r\n                break;\r\n        }\r\n\r\n    }\r\n\r\n    private ArrayList<Lesson> getAllLessonsOfSubject(ArrayList<Lesson> lessonList, int subjectId) {\r\n        ArrayList<Lesson> ret = new ArrayList<>();\r\n        for (Lesson lesson : lessonList) {\r\n            if (lesson.getSubjectId() == subjectId) {\r\n                ret.add(lesson);\r\n            }\r\n        }\r\n        return ret;\r\n    }\r\n\r\n    private ArrayList<Lesson> getAllLessonsMatchKeyWord(ArrayList<Lesson> lessonList, String keyWord) {\r\n        keyWord = keyWord.toLowerCase();\r\n        ArrayList<Lesson> ret = new ArrayList<>();\r\n        for (Lesson lesson : lessonList) {\r\n            if (lesson.getName().toLowerCase().contains(keyWord)) {\r\n                ret.add(lesson);\r\n            }\r\n        }\r\n        return ret;\r\n    }\r\n\r\n    private int getNoOfPages(ArrayList<Lesson> list) {\r\n        int length = list.size();\r\n        if (length == 0) {\r\n            return 1;\r\n        }\r\n        int noOfPages = length / rowPerPage;\r\n        if (length % rowPerPage == 0) {\r\n            return noOfPages;\r\n        }\r\n        return noOfPages + 1;\r\n    }\r\n\r\n    private int getPage(HttpServletRequest request, int noOfPages) {\r\n        String cur = request.getParameter(\"currentPage\");\r\n        if ((cur == null) || (cur.isEmpty())) {\r\n            return 1;\r\n        }\r\n\r\n        int currentPage = Integer.parseInt(cur);\r\n        switch (request.getParameter(\"pageAction\")) {\r\n            case \"firstPage\":\r\n                return 1;\r\n            case \"prevPage\": {\r\n                currentPage--;\r\n                if (currentPage < 1) {\r\n                    return 1;\r\n                } else {\r\n                    return currentPage;\r\n                }\r\n            }\r\n            case \"nextPage\": {\r\n                currentPage++;\r\n                if (currentPage > noOfPages) {\r\n                    return noOfPages;\r\n                } else {\r\n                    return currentPage;\r\n                }\r\n            }\r\n            case \"lastPage\":\r\n                return noOfPages;\r\n        }\r\n\r\n        String newpage = request.getParameter(\"newPage\");\r\n        if ((newpage != null) && (!newpage.isEmpty())) {\r\n            int newPage = Integer.parseInt(newpage);\r\n            return newPage;\r\n        }\r\n        return currentPage;\r\n\r\n    }\r\n\r\n    private ArrayList<Lesson> getAllLessonsOfPage(int page, ArrayList<Lesson> list) {\r\n        ArrayList<Lesson> ret = new ArrayList<>();\r\n        int start = rowPerPage * (page - 1) + 1;\r\n        int end = rowPerPage * page;\r\n        if (start < 1) {\r\n            start = 1;\r\n        }\r\n        if (end > list.size()) {\r\n            end = list.size();\r\n        }\r\n\r\n        for (int i = start - 1; i < end; i++) {\r\n            ret.add(list.get(i));\r\n        }\r\n        return ret;\r\n    }\r\n\r\n    private void viewLessonList(HttpServletRequest request, HttpServletResponse response)\r\n            throws ServletException, IOException {\r\n        ArrayList<Lesson> lessonList = lessonDAO.getAllLessons();\r\n\r\n        String sid = request.getParameter(\"subjectId\");\r\n        if (sid != null && !sid.isEmpty() && !sid.equals(\"all\")) {\r\n            int subjectId = Integer.parseInt(sid);\r\n            request.setAttribute(\"subject\", subjectDAO.getSubjectMatchId(subjectId));\r\n            lessonList = getAllLessonsOfSubject(lessonList, subjectId);\r\n        }\r\n\r\n        String keyWord = request.getParameter(\"keyWord\");\r\n        if (keyWord != null && !keyWord.isEmpty()) {\r\n            lessonList = getAllLessonsMatchKeyWord(lessonList, keyWord);\r\n        }\r\n        request.setAttribute(\"keyWord\", keyWord);\r\n\r\n        int noOfPages = getNoOfPages(lessonList);\r\n        int currentPage = getPage(request, noOfPages);\r\n        lessonList = getAllLessonsOfPage(currentPage, lessonList);\r\n        request.setAttribute(\"currentPage\", currentPage);\r\n        request.setAttribute(\"noOfPages\", noOfPages);\r\n\r\n        request.setAttribute(\"latestOrder\", lessonDAO.getLatestOrder());\r\n        request.setAttribute(\"subjectList\", subjectDAO.getAllSubject());\r\n        request.setAttribute(\"list\", lessonList);\r\n        request.getRequestDispatcher(\"/WEB-INF/views/lesson/lessonlist.jsp\").forward(request, response);\r\n    }\r\n\r\n    private void goToPage(HttpServletRequest request, HttpServletResponse response)\r\n            throws ServletException, IOException {\r\n        request.setAttribute(\"subjectList\", subjectDAO.getAllSubject());\r\n        request.getRequestDispatcher(\"/WEB-INF/views/lesson/newlesson.jsp\").forward(request, response);\r\n    }\r\n\r\n    private void newLesson(HttpServletRequest request, HttpServletResponse response)\r\n            throws ServletException, IOException {\r\n        switch (request.getParameter(\"action\")) {\r\n            case \"goToPage\":\r\n                goToPage(request, response);\r\n                break;\r\n            case \"addNew\":\r\n                insertNewLesson(request, response);\r\n                break;\r\n        }\r\n    }\r\n\r\n    private void insertNewLesson(HttpServletRequest request, HttpServletResponse response)\r\n            throws ServletException, IOException {\r\n        String name = request.getParameter(\"name\");\r\n        int subjectId = Integer.parseInt(request.getParameter(\"subjectId\"));\r\n        boolean successful = true;\r\n\r\n        if (name.isEmpty()) {\r\n            successful = false;\r\n            request.setAttribute(\"err\", \"Input is empty!\");\r\n        } else if (name.length() > 100) {\r\n            successful = false;\r\n            request.setAttribute(\"err\", \"Lesson name can not exceed 100 characters!\");\r\n        }\r\n\r\n        if (successful) {\r\n            try {\r\n                lessonDAO.addLesson(name, subjectId);\r\n            } catch (SQLException e) {\r\n                successful = false;\r\n                request.setAttribute(\"err\", \"Lesson name already exist!\");\r\n            }\r\n        }\r\n\r\n        if (successful) {\r\n            response.sendRedirect(\"../lesson\");\r\n        } else {\r\n            request.setAttribute(\"name\", name);\r\n            request.setAttribute(\"subjectList\", subjectDAO.getAllSubject());\r\n            request.setAttribute(\"subject\", subjectDAO.getSubjectMatchId(subjectId));\r\n            request.getRequestDispatcher(\"/WEB-INF/views/lesson/newlesson.jsp\").forward(request, response);\r\n        }\r\n\r\n    }\r\n\r\n    private void viewLessonDetails(HttpServletRequest request, HttpServletResponse response)\r\n            throws ServletException, IOException {\r\n        int lessonId = Integer.parseInt(request.getParameter(\"lessonId\"));\r\n        request.setAttribute(\"lesson\", lessonDAO.getLessonMatchId(lessonId));\r\n\r\n        request.getRequestDispatcher(\"/WEB-INF/views/lesson/lessondetails.jsp\").forward(request, response);\r\n    }\r\n\r\n    private void changeLessonStatus(HttpServletRequest request, HttpServletResponse response)\r\n            throws IOException {\r\n        int lessonId = Integer.parseInt(request.getParameter(\"lessonId\"));\r\n        try {\r\n            lessonDAO.changeStatus(lessonId);\r\n        } catch (SQLException e) {\r\n            System.out.println(e.getMessage());\r\n        }\r\n        response.sendRedirect(\"../lesson\");\r\n    }\r\n\r\n    private void update(HttpServletRequest request, HttpServletResponse response)\r\n            throws ServletException, IOException {\r\n        boolean successful = true;\r\n        int lessonId = Integer.parseInt(request.getParameter(\"lessonId\"));\r\n        Lesson lesson = lessonDAO.getLessonMatchId(lessonId);\r\n        String name = request.getParameter(\"name\");\r\n        lesson.setName(name);\r\n        if (name.isEmpty()) {\r\n            successful = false;\r\n            request.setAttribute(\"err\", \"Input is empty!\");\r\n        } else if (name.length() > 100) {\r\n            successful = false;\r\n            request.setAttribute(\"err\", \"Lesson name can not exceed 100 characters!\");\r\n        }\r\n\r\n        if (successful) {\r\n            try {\r\n                lessonDAO.updateLesson(lesson);\r\n            } catch (SQLException e) {\r\n                successful = false;\r\n                request.setAttribute(\"err\", \"Lesson name already exist!\");\r\n            }\r\n        }\r\n\r\n        if (successful) {\r\n            response.sendRedirect(\"../lesson\");\r\n        } else {\r\n            request.setAttribute(\"lesson\", lesson);\r\n            request.getRequestDispatcher(\"/WEB-INF/views/lesson/lessondetails.jsp\").forward(request, response);\r\n        }\r\n    }\r\n\r\n    private void changeOrder(HttpServletRequest request, HttpServletResponse response)\r\n            throws ServletException, IOException {\r\n        int lessonId = Integer.parseInt(request.getParameter(\"lessonId\"));\r\n        String action = request.getParameter(\"orderAction\");\r\n        try {\r\n            lessonDAO.changeOrder(lessonId, action);\r\n        } catch (SQLException e) {\r\n            System.out.println(e.getMessage());\r\n        }\r\n        response.sendRedirect(\"../lesson\");\r\n    }\r\n\r\n    private void updateLesson(HttpServletRequest request, HttpServletResponse response)\r\n            throws ServletException, IOException {\r\n        switch (request.getParameter(\"action\")) {\r\n            case \"changeStatus\":\r\n                changeLessonStatus(request, response);\r\n                break;\r\n            case \"changeOrder\":\r\n                changeOrder(request, response);\r\n                break;\r\n            case \"updateLesson\":\r\n                update(request, response);\r\n                break;\r\n\r\n        }\r\n\r\n    }\r\n\r\n    @Override\r\n    public String getServletInfo() {\r\n        return \"Short description\";\r\n    }// </editor-fold>\r\n\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/java/controller/LessonServlet.java b/src/java/controller/LessonServlet.java
--- a/src/java/controller/LessonServlet.java	(revision d6ad1445e1c07c5da0ab8951156084fe4a182d1f)
+++ b/src/java/controller/LessonServlet.java	(date 1721252670148)
@@ -1,22 +1,27 @@
 package controller;
 
+import common.MaterialHandler;
 import dal.LessonDAO;
+import dal.MaterialDAO;
 import dal.SubjectDAO;
 import dal.UserDAO;
 import java.io.IOException;
 import java.io.PrintWriter;
 import jakarta.servlet.ServletException;
+import jakarta.servlet.annotation.MultipartConfig;
 import jakarta.servlet.annotation.WebServlet;
 import jakarta.servlet.http.HttpServlet;
 import jakarta.servlet.http.HttpServletRequest;
 import jakarta.servlet.http.HttpServletResponse;
 import jakarta.servlet.http.HttpSession;
+import jakarta.servlet.http.Part;
 import java.sql.SQLException;
 import java.util.ArrayList;
+import java.util.Collections;
 import model.Lesson;
-import model.subject.Subject;
 import model.user.User;
 
+@MultipartConfig
 @WebServlet(urlPatterns = {"/lesson", "/lesson/new", "/lesson/insert", "/lesson/details", "/lesson/update"})
 public class LessonServlet extends HttpServlet {
 
@@ -39,50 +44,62 @@
         }
     }
 
-    void refreshSession(HttpServletRequest request, int userId) {
-        HttpSession session = request.getSession();
-        UserDAO userDAO = new UserDAO();
-        session.setAttribute("user", userDAO.getUserById(userId));
-    }
-
     @Override
     protected void doGet(HttpServletRequest request, HttpServletResponse response)
             throws ServletException, IOException {
         doPost(request, response);
     }
 
+    private String getWorkingDir() {
+        String directory = getServletContext().getRealPath("") + "";
+        return directory.replace("\\build\\web\\", "\\web\\");
+    }
+
     LessonDAO lessonDAO = new LessonDAO();
     SubjectDAO subjectDAO = new SubjectDAO();
+    MaterialDAO materialDAO = new MaterialDAO();
 
     @Override
     protected void doPost(HttpServletRequest request, HttpServletResponse response)
             throws ServletException, IOException {
+
+        String contextPath = request.getServletContext().getContextPath();
+        String loginPage = contextPath + "/login.jsp";
+        String homePage = contextPath + "/home";
+        UserDAO userDAO = new UserDAO();
         HttpSession session = request.getSession();
         User user = (User) session.getAttribute("user");
-        /*if (user == null) {
-            response.sendRedirect(request.getContextPath() + "/login.jsp");
-        } else if (user.getRole() == -1) {
-            response.sendRedirect("../home");
+        if (user == null) {
+            response.sendRedirect(loginPage);
         } else {
-            refreshSession(request, user.getId());
-         */
-        String action = request.getServletPath();
-        switch (action) {
-            case "/lesson":
-                viewLessonList(request, response);
-                break;
-            case "/lesson/new":
-                newLesson(request, response);
-                break;
-            case "/lesson/insert":
-                insertNewLesson(request, response);
-                break;
-            case "/lesson/details":
-                viewLessonDetails(request, response);
-                break;
-            case "/lesson/update":
-                updateLesson(request, response);
-                break;
+            User u = userDAO.getUserById(user.getId());
+            if (u != null && u.getEmail() != null) {
+                session.setAttribute("user", u);
+                if (user.getRole() > 1) {
+                    response.sendRedirect(homePage);
+                } else {
+                    String action = request.getServletPath();
+                    switch (action) {
+                        case "/lesson":
+                            viewLessonList(request, response);
+                            break;
+                        case "/lesson/new":
+                            newLesson(request, response);
+                            break;
+                        case "/lesson/insert":
+                            insertNewLesson(request, response);
+                            break;
+                        case "/lesson/details":
+                            viewLessonDetails(request, response);
+                            break;
+                        case "/lesson/update":
+                            updateLesson(request, response);
+                            break;
+                    }
+                }
+            } else {
+                response.sendRedirect(loginPage);
+            }
         }
 
     }
@@ -175,6 +192,15 @@
         }
         return ret;
     }
+
+    private ArrayList<String> getSortOptions() {
+        ArrayList<String> ret = new ArrayList<>();
+        ret.add("Order");
+        ret.add("Name");
+        ret.add("Status");
+        ret.add("Subject");
+        return ret;
+    }
 
     private void viewLessonList(HttpServletRequest request, HttpServletResponse response)
             throws ServletException, IOException {
@@ -187,6 +213,27 @@
             lessonList = getAllLessonsOfSubject(lessonList, subjectId);
         }
 
+        String sortBy = request.getParameter("sortBy");
+        if (sortBy != null) {
+            switch (sortBy) {
+                case "Name":
+                    Collections.sort(lessonList, new Lesson.SortByName());
+                    break;
+                case "Status":
+                    Collections.sort(lessonList, new Lesson.SortByStatus());
+                    break;
+                case "Subject":
+                    Collections.sort(lessonList, new Lesson.SortBySubject());
+                    break;
+                default:
+                    Collections.sort(lessonList, new Lesson.SortByOrder());
+                    break;
+            }
+        } else {
+            Collections.sort(lessonList, new Lesson.SortByOrder());
+        }
+        request.setAttribute("sortBy", sortBy);
+
         String keyWord = request.getParameter("keyWord");
         if (keyWord != null && !keyWord.isEmpty()) {
             lessonList = getAllLessonsMatchKeyWord(lessonList, keyWord);
@@ -201,6 +248,7 @@
 
         request.setAttribute("latestOrder", lessonDAO.getLatestOrder());
         request.setAttribute("subjectList", subjectDAO.getAllSubject());
+        request.setAttribute("sortOptions", getSortOptions());
         request.setAttribute("list", lessonList);
         request.getRequestDispatcher("/WEB-INF/views/lesson/lessonlist.jsp").forward(request, response);
     }
@@ -259,9 +307,20 @@
 
     private void viewLessonDetails(HttpServletRequest request, HttpServletResponse response)
             throws ServletException, IOException {
-        int lessonId = Integer.parseInt(request.getParameter("lessonId"));
+        int lessonId;
+        HttpSession session = request.getSession();
+
+        if (session.getAttribute("lessonId") != null) {
+            lessonId = (int) session.getAttribute("lessonId");
+            session.removeAttribute("lessonId");
+        } else {
+            lessonId = Integer.parseInt(request.getParameter("lessonId"));
+        }
         request.setAttribute("lesson", lessonDAO.getLessonMatchId(lessonId));
 
+        request.setAttribute("currentPage", session.getAttribute("currentPage"));
+        session.removeAttribute("currentPage");
+        request.setAttribute("materialList", materialDAO.getAllMaterialOfALesson(lessonId));
         request.getRequestDispatcher("/WEB-INF/views/lesson/lessondetails.jsp").forward(request, response);
     }
 
@@ -320,6 +379,68 @@
         response.sendRedirect("../lesson");
     }
 
+    private void insertMaterial(HttpServletRequest request, HttpServletResponse response)
+            throws IOException, ServletException {
+        boolean successful = true;
+        Part filePart = request.getPart("file");
+        int lessonId = Integer.parseInt(request.getParameter("lessonId"));
+
+        if (filePart == null || filePart.getSize() == 0) {
+            successful = false;
+            request.setAttribute("fileErr", "Please choose a file");
+        } else {
+            String workingDir = getWorkingDir();
+            String workingFolder = "assets\\material";
+            try {
+                MaterialHandler.addMaterial(lessonId, workingFolder, workingDir, filePart);
+            } catch (SQLException | IOException e) {
+                successful = false;
+                request.setAttribute("fileErr", "Import material failed");
+            }
+        }
+
+        if (successful) {
+            HttpSession session = request.getSession();
+            session.setAttribute("lessonId", lessonId);
+            session.setAttribute("currentPage", "material");
+            String contextPath = request.getServletContext().getContextPath();
+            String detailsPage = contextPath + "/lesson/details";
+            response.sendRedirect(detailsPage);
+        } else {
+            request.setAttribute("currentPage", "material");
+            request.setAttribute("lesson", lessonDAO.getLessonMatchId(lessonId));
+            request.getRequestDispatcher("/WEB-INF/views/lesson/lessondetails.jsp").forward(request, response);
+        }
+    }
+
+    private void removeMaterial(HttpServletRequest request, HttpServletResponse response)
+            throws IOException, ServletException {
+        boolean successful = true;
+        int lessonId = Integer.parseInt(request.getParameter("lessonId"));
+        int materialId = Integer.parseInt(request.getParameter("materialId"));
+        String workingDir = getWorkingDir();
+
+        try {
+            MaterialHandler.removeMaterial(lessonId, materialId, workingDir);
+        } catch (SQLException e) {
+            successful = false;
+            request.setAttribute("fileErr", "Delete file failed!");
+        }
+
+        if (successful) {
+            HttpSession session = request.getSession();
+            session.setAttribute("lessonId", lessonId);
+            session.setAttribute("currentPage", "material");
+            String contextPath = request.getServletContext().getContextPath();
+            String detailsPage = contextPath + "/lesson/details";
+            response.sendRedirect(detailsPage);
+        } else {
+            request.setAttribute("currentPage", "material");
+            request.setAttribute("lesson", lessonDAO.getLessonMatchId(lessonId));
+            request.getRequestDispatcher("/WEB-INF/views/lesson/lessondetails.jsp").forward(request, response);
+        }
+    }
+
     private void updateLesson(HttpServletRequest request, HttpServletResponse response)
             throws ServletException, IOException {
         switch (request.getParameter("action")) {
@@ -332,7 +453,12 @@
             case "updateLesson":
                 update(request, response);
                 break;
-
+            case "insertMaterial":
+                insertMaterial(request, response);
+                break;
+            case "removeMaterial":
+                removeMaterial(request, response);
+                break;
         }
 
     }
Index: src/java/controller/HomeServlet.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package controller;\r\n\r\nimport common.EmailValidator;\r\nimport dal.ClassDAO;\r\nimport dal.ContactDAO;\r\nimport dal.SubjectDAO;\r\nimport dal.UserDAO;\r\nimport java.io.IOException;\r\nimport java.io.PrintWriter;\r\nimport jakarta.servlet.ServletException;\r\nimport jakarta.servlet.annotation.WebServlet;\r\nimport jakarta.servlet.http.HttpServlet;\r\nimport jakarta.servlet.http.HttpServletRequest;\r\nimport jakarta.servlet.http.HttpServletResponse;\r\nimport java.sql.SQLException;\r\nimport model.contact.Contact;\r\nimport model.contact.ContactError;\r\n\r\n@WebServlet(name = \"HomeServlet\", urlPatterns = {\"/home\"})\r\npublic class HomeServlet extends HttpServlet {\r\n\r\n    protected void processRequest(HttpServletRequest request, HttpServletResponse response)\r\n            throws ServletException, IOException {\r\n        response.setContentType(\"text/html;charset=UTF-8\");\r\n        try (PrintWriter out = response.getWriter()) {\r\n            out.println(\"<!DOCTYPE html>\");\r\n            out.println(\"<html>\");\r\n            out.println(\"<head>\");\r\n            out.println(\"<title>Servlet HomeServlet</title>\");\r\n            out.println(\"</head>\");\r\n            out.println(\"<body>\");\r\n            out.println(\"<h1>Servlet HomeServlet at \" + request.getContextPath() + \"</h1>\");\r\n            out.println(\"</body>\");\r\n            out.println(\"</html>\");\r\n        }\r\n    }\r\n\r\n    UserDAO userDAO = new UserDAO();\r\n    SubjectDAO subjectDAO = new SubjectDAO();\r\n    ClassDAO classDAO = new ClassDAO();\r\n    ContactDAO contactDAO = new ContactDAO();\r\n\r\n    @Override\r\n    protected void doGet(HttpServletRequest request, HttpServletResponse response)\r\n            throws ServletException, IOException {\r\n        request.setAttribute(\"numberOfSubjects\", subjectDAO.getNumberOfSubjects());\r\n        request.setAttribute(\"numberOfStudents\", userDAO.getNumberOfStudents());\r\n        request.setAttribute(\"numberOfTeachers\", userDAO.getNumberOfTeachers());\r\n        request.setAttribute(\"numberOfClasses\", classDAO.getNumberOfClasses());\r\n        request.getRequestDispatcher(\"home.jsp\").forward(request, response);\r\n    }\r\n\r\n    @Override\r\n    protected void doPost(HttpServletRequest request, HttpServletResponse response)\r\n            throws ServletException, IOException {\r\n        switch (request.getParameter(\"action\")) {\r\n            case \"contactadmin\":\r\n                contactAdmin(request, response);\r\n        }\r\n    }\r\n\r\n    private Contact getContactInfo(HttpServletRequest request) {\r\n        Contact c = new Contact();\r\n        c.setName(request.getParameter(\"name\"));\r\n        c.setEmail(request.getParameter(\"email\"));\r\n        c.setSubject(request.getParameter(\"subject\"));\r\n        c.setPhone(request.getParameter(\"phone\"));\r\n        c.setMessage(request.getParameter(\"message\"));\r\n        return c;\r\n    }\r\n\r\n    private ContactError getContactErrorInfo(Contact c) {\r\n        boolean error = false;\r\n        ContactError ce = new ContactError();\r\n        if ((c.getName().length() < 2) || (c.getName().length() > 60)) {\r\n            error = true;\r\n            ce.setNameErr(\"Please input the Name with length in range of 2 to 60!\");\r\n        } else {\r\n            if (!c.getName().matches(\"^[A-Za-z\\s]+$\")) {\r\n                error = true;\r\n                ce.setNameErr(\"Name contain invalid characters!\");\r\n            }\r\n        }\r\n        if ((c.getEmail().length() < 5) || (c.getEmail().length() > 35)) {\r\n            error = true;\r\n            ce.setEmailErr(\"Please enter email from 5-35 characters!\");\r\n        } else {\r\n            if (!EmailValidator.validate(c.getEmail())) {\r\n                error = true;\r\n                ce.setEmailErr(\"Please enter a valid email!\");\r\n            }\r\n        }\r\n        if ((!c.getPhone().matches(\"0[0-9]{9}\")) || (c.getPhone().equals(\"0000000000\"))) {\r\n            error = true;\r\n            ce.setPhoneErr(\"Please enter a valid phone number\");\r\n        }\r\n        if ((c.getSubject().length() < 5) || (c.getSubject().length() > 50)) {\r\n            error = true;\r\n            ce.setSubjectErr(\"Please input the subject with length in range of 5 to 50!\");\r\n        }\r\n        if ((c.getMessage().length() < 1) || (c.getMessage().length() > 255)) {\r\n            error = true;\r\n            ce.setMessageErr(\"Please input the message with length in range of 1 to 255!\");\r\n        }\r\n        if (error) {\r\n            return ce;\r\n        } else {\r\n            return null;\r\n        }\r\n    }\r\n\r\n    public void contactAdmin(HttpServletRequest request, HttpServletResponse response)\r\n            throws ServletException, IOException {\r\n        boolean error = false;\r\n        String err = \"\";\r\n        Contact c = getContactInfo(request);\r\n        ContactError ce = getContactErrorInfo(c);\r\n\r\n        if (ce == null) {\r\n            try {\r\n                contactDAO.newContact(c);\r\n            } catch (SQLException e) {\r\n                error = true;\r\n                err = \"Failed to send message\";\r\n            }\r\n        }\r\n\r\n        if ((error) || (ce != null)) {\r\n            request.setAttribute(\"err\", err);\r\n            request.setAttribute(\"contactErr\", ce);\r\n        } else {\r\n            request.setAttribute(\"success\", \"Message sent successfully!\");\r\n        }\r\n\r\n        request.setAttribute(\"contact\", c);\r\n        request.getRequestDispatcher(\"home.jsp#contact-form\").forward(request, response);\r\n    }\r\n\r\n    @Override\r\n    public String getServletInfo() {\r\n        return \"Short description\";\r\n    }// </editor-fold>\r\n\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/java/controller/HomeServlet.java b/src/java/controller/HomeServlet.java
--- a/src/java/controller/HomeServlet.java	(revision d6ad1445e1c07c5da0ab8951156084fe4a182d1f)
+++ b/src/java/controller/HomeServlet.java	(date 1721252670148)
@@ -1,8 +1,6 @@
 package controller;
 
-import common.EmailValidator;
 import dal.ClassDAO;
-import dal.ContactDAO;
 import dal.SubjectDAO;
 import dal.UserDAO;
 import java.io.IOException;
@@ -12,9 +10,6 @@
 import jakarta.servlet.http.HttpServlet;
 import jakarta.servlet.http.HttpServletRequest;
 import jakarta.servlet.http.HttpServletResponse;
-import java.sql.SQLException;
-import model.contact.Contact;
-import model.contact.ContactError;
 
 @WebServlet(name = "HomeServlet", urlPatterns = {"/home"})
 public class HomeServlet extends HttpServlet {
@@ -38,7 +33,6 @@
     UserDAO userDAO = new UserDAO();
     SubjectDAO subjectDAO = new SubjectDAO();
     ClassDAO classDAO = new ClassDAO();
-    ContactDAO contactDAO = new ContactDAO();
 
     @Override
     protected void doGet(HttpServletRequest request, HttpServletResponse response)
@@ -47,93 +41,14 @@
         request.setAttribute("numberOfStudents", userDAO.getNumberOfStudents());
         request.setAttribute("numberOfTeachers", userDAO.getNumberOfTeachers());
         request.setAttribute("numberOfClasses", classDAO.getNumberOfClasses());
-        request.getRequestDispatcher("home.jsp").forward(request, response);
+        request.getRequestDispatcher("/WEB-INF/home/home.jsp").forward(request, response);
     }
 
     @Override
     protected void doPost(HttpServletRequest request, HttpServletResponse response)
             throws ServletException, IOException {
-        switch (request.getParameter("action")) {
-            case "contactadmin":
-                contactAdmin(request, response);
-        }
-    }
-
-    private Contact getContactInfo(HttpServletRequest request) {
-        Contact c = new Contact();
-        c.setName(request.getParameter("name"));
-        c.setEmail(request.getParameter("email"));
-        c.setSubject(request.getParameter("subject"));
-        c.setPhone(request.getParameter("phone"));
-        c.setMessage(request.getParameter("message"));
-        return c;
-    }
+        processRequest(request, response);
 
-    private ContactError getContactErrorInfo(Contact c) {
-        boolean error = false;
-        ContactError ce = new ContactError();
-        if ((c.getName().length() < 2) || (c.getName().length() > 60)) {
-            error = true;
-            ce.setNameErr("Please input the Name with length in range of 2 to 60!");
-        } else {
-            if (!c.getName().matches("^[A-Za-z\s]+$")) {
-                error = true;
-                ce.setNameErr("Name contain invalid characters!");
-            }
-        }
-        if ((c.getEmail().length() < 5) || (c.getEmail().length() > 35)) {
-            error = true;
-            ce.setEmailErr("Please enter email from 5-35 characters!");
-        } else {
-            if (!EmailValidator.validate(c.getEmail())) {
-                error = true;
-                ce.setEmailErr("Please enter a valid email!");
-            }
-        }
-        if ((!c.getPhone().matches("0[0-9]{9}")) || (c.getPhone().equals("0000000000"))) {
-            error = true;
-            ce.setPhoneErr("Please enter a valid phone number");
-        }
-        if ((c.getSubject().length() < 5) || (c.getSubject().length() > 50)) {
-            error = true;
-            ce.setSubjectErr("Please input the subject with length in range of 5 to 50!");
-        }
-        if ((c.getMessage().length() < 1) || (c.getMessage().length() > 255)) {
-            error = true;
-            ce.setMessageErr("Please input the message with length in range of 1 to 255!");
-        }
-        if (error) {
-            return ce;
-        } else {
-            return null;
-        }
-    }
-
-    public void contactAdmin(HttpServletRequest request, HttpServletResponse response)
-            throws ServletException, IOException {
-        boolean error = false;
-        String err = "";
-        Contact c = getContactInfo(request);
-        ContactError ce = getContactErrorInfo(c);
-
-        if (ce == null) {
-            try {
-                contactDAO.newContact(c);
-            } catch (SQLException e) {
-                error = true;
-                err = "Failed to send message";
-            }
-        }
-
-        if ((error) || (ce != null)) {
-            request.setAttribute("err", err);
-            request.setAttribute("contactErr", ce);
-        } else {
-            request.setAttribute("success", "Message sent successfully!");
-        }
-
-        request.setAttribute("contact", c);
-        request.getRequestDispatcher("home.jsp#contact-form").forward(request, response);
     }
 
     @Override
Index: src/java/controller/login/LoginServlet.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package controller.login;\r\n\r\nimport dal.UserDAO;\r\nimport model.user.User;\r\n\r\nimport java.io.IOException;\r\nimport java.sql.SQLException;\r\n\r\nimport jakarta.servlet.ServletException;\r\nimport jakarta.servlet.annotation.WebServlet;\r\nimport jakarta.servlet.http.HttpServlet;\r\nimport jakarta.servlet.http.HttpServletRequest;\r\nimport jakarta.servlet.http.HttpServletResponse;\r\nimport jakarta.servlet.http.HttpSession;\r\nimport mail.GenerateVerifyCode;\r\nimport mail.SendMail;\r\n\r\n@WebServlet(name = \"LoginServlet\", urlPatterns = {\"/login\"})\r\npublic class LoginServlet extends HttpServlet {\r\n\r\n    protected void processRequest(HttpServletRequest request, HttpServletResponse response)\r\n            throws ServletException, IOException {\r\n        HttpSession session = request.getSession();\r\n        User u = (User) session.getAttribute(\"user\");\r\n        if (u != null) {\r\n            response.sendRedirect(\"home\");\r\n        } else {\r\n            String email = request.getParameter(\"email\");\r\n            String password = request.getParameter(\"password\");\r\n            UserDAO userDAO = new UserDAO();\r\n            try {\r\n                User user = userDAO.login(email, password);\r\n                if (user != null || user.getEmail() == null) {\r\n                    switch (user.getStatus()) {\r\n                        case 2:\r\n                            request.setAttribute(\"user\", user);\r\n                            request.getRequestDispatcher(\"setnewpassword.jsp\").forward(request, response);\r\n                            break;\r\n                        case 0:\r\n                            String receiver = user.getEmail();\r\n                            String subject = \"Your activation code\";\r\n                            String activationCode = GenerateVerifyCode.GenerateCode();\r\n                            String content = \"Your activation code is: \" + activationCode;\r\n                            SendMail.sendMail(receiver, subject, content);\r\n\r\n                            request.setAttribute(\"activationCode\", activationCode);\r\n                            request.setAttribute(\"user\", user);\r\n                            request.getRequestDispatcher(\"enteractivationcode.jsp\").forward(request, response);\r\n                            break;\r\n                        default:\r\n                            session.setAttribute(\"user\", user);\r\n                            response.sendRedirect(\"dashboard.jsp\");\r\n                            break;\r\n                    }\r\n                } else {\r\n                    session.setAttribute(\"message\", \"Invalid email or password\");\r\n                    response.sendRedirect(\"login.jsp\");\r\n                }\r\n            } catch (SQLException e) {\r\n                throw new ServletException(\"Login failed\", e);\r\n            }\r\n        }\r\n    }\r\n\r\n    @Override\r\n    protected void doGet(HttpServletRequest request, HttpServletResponse response)\r\n            throws ServletException, IOException {\r\n        processRequest(request, response);\r\n    }\r\n\r\n    @Override\r\n    protected void doPost(HttpServletRequest request, HttpServletResponse response)\r\n            throws ServletException, IOException {\r\n        processRequest(request, response);\r\n    }\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/java/controller/login/LoginServlet.java b/src/java/controller/login/LoginServlet.java
--- a/src/java/controller/login/LoginServlet.java	(revision d6ad1445e1c07c5da0ab8951156084fe4a182d1f)
+++ b/src/java/controller/login/LoginServlet.java	(date 1721252670148)
@@ -34,7 +34,7 @@
                     switch (user.getStatus()) {
                         case 2:
                             request.setAttribute("user", user);
-                            request.getRequestDispatcher("setnewpassword.jsp").forward(request, response);
+                            request.getRequestDispatcher("/WEB-INF/account/setnewpassword.jsp").forward(request, response);
                             break;
                         case 0:
                             String receiver = user.getEmail();
@@ -45,12 +45,20 @@
 
                             request.setAttribute("activationCode", activationCode);
                             request.setAttribute("user", user);
-                            request.getRequestDispatcher("enteractivationcode.jsp").forward(request, response);
+                            request.getRequestDispatcher("/WEB-INF/account/enteractivationcode.jsp").forward(request, response);
                             break;
                         default:
                             session.setAttribute("user", user);
-                            response.sendRedirect("dashboard.jsp");
-                            break;
+                            switch (user.getRole()) {
+                                case 0:
+                                case 1:
+                                    response.sendRedirect("dashboard");
+                                    break;
+                                default:
+                                    response.sendRedirect("home");
+                                    break;
+                            }
+
                     }
                 } else {
                     session.setAttribute("message", "Invalid email or password");
Index: web/WEB-INF/views/user/userdetails.jsp
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><%@page isELIgnored=\"false\" %>\r\n<%@taglib prefix=\"c\" uri=\"http://java.sun.com/jsp/jstl/core\" %>\r\n<%@page contentType=\"text/html\" pageEncoding=\"UTF-8\"%>\r\n<html\r\n    lang=\"en\"\r\n    class=\"light-style layout-menu-fixed layout-compact\"\r\n    dir=\"ltr\"\r\n    data-theme=\"theme-default\"\r\n    data-assets-path=\"../assets/\"\r\n    data-template=\"vertical-menu-template-free\">\r\n    <head>\r\n        <meta charset=\"utf-8\" />\r\n        <meta\r\n            name=\"viewport\"\r\n            content=\"width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0\" />\r\n\r\n        <title>User details</title>\r\n\r\n        <meta name=\"description\" content=\"\" />\r\n\r\n        <!-- Favicon -->\r\n        <link rel=\"icon\" type=\"image/x-icon\" href=\"../assets/img/favicon/favicon.ico\" />\r\n\r\n        <!-- Fonts -->\r\n        <link rel=\"preconnect\" href=\"https://fonts.googleapis.com\" />\r\n        <link rel=\"preconnect\" href=\"https://fonts.gstatic.com\" crossorigin />\r\n        <link\r\n            href=\"https://fonts.googleapis.com/css2?family=Public+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&display=swap\"\r\n            rel=\"stylesheet\" />\r\n\r\n        <link rel=\"stylesheet\" href=\"../assets/vendor/fonts/boxicons.css\" />\r\n\r\n        <!-- Core CSS -->\r\n        <link rel=\"stylesheet\" href=\"../assets/vendor/css/core.css\" class=\"template-customizer-core-css\" />\r\n        <link rel=\"stylesheet\" href=\"../assets/vendor/css/theme-default.css\" class=\"template-customizer-theme-css\" />\r\n        <link rel=\"stylesheet\" href=\"../assets/css/demo.css\" />\r\n\r\n        <!-- Vendors CSS -->\r\n        <link rel=\"stylesheet\" href=\"../assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.css\" />\r\n        <link rel=\"stylesheet\" href=\"../assets/vendor/libs/apex-charts/apex-charts.css\" />\r\n\r\n        <!-- Page CSS -->\r\n\r\n        <!-- Favicon -->\r\n        <link href=\"../img/favicon.ico\" rel=\"icon\">\r\n\r\n        <!-- Google Web Fonts -->\r\n        <link rel=\"preconnect\" href=\"https://fonts.gstatic.com\">\r\n        <link href=\"https://fonts.googleapis.com/css2?family=Jost:wght@500;600;700&family=Open+Sans:wght@400;600&display=swap\" rel=\"stylesheet\"> \r\n\r\n        <!-- Font Awesome -->\r\n        <link href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css\" rel=\"stylesheet\">\r\n\r\n        <!-- Libraries Stylesheet -->\r\n        <link href=\"../lib/owlcarousel/assets/owl.carousel.min.css\" rel=\"stylesheet\">\r\n\r\n        <!-- Customized Bootstrap Stylesheet -->\r\n        <link href=\"../css/style.css\" rel=\"stylesheet\">\r\n\r\n        <!-- Helpers -->\r\n        <script src=\"../assets/vendor/js/helpers.js\"></script>\r\n        <!--! Template customizer & Theme config files MUST be included after core stylesheets and helpers.js in the <head> section -->\r\n        <!--? Config:  Mandatory theme config file contain global vars & default theme options, Set your preferred theme option in this file.  -->\r\n        <script src=\"../assets/js/config.js\"></script>\r\n\r\n    </head>\r\n\r\n    <body>\r\n        <!-- Layout wrapper -->\r\n        <div class=\"layout-wrapper layout-content-navbar\">\r\n            <div class=\"layout-container\">\r\n                <!-- Menu -->\r\n\r\n                <jsp:include page=\"/WEB-INF/common/sider.jsp\"/>\r\n                <!-- / Menu -->\r\n\r\n                <!-- Layout container -->\r\n                <div class=\"layout-page\">\r\n\r\n                    <!-- Content wrapper -->\r\n                    <div class=\"content-wrapper\">\r\n                        <!-- Content -->\r\n                        <jsp:include page=\"/WEB-INF/common/header.jsp\"/>\r\n\r\n                        <div class=\"container-xxl flex-grow-1 container-p-y\">\r\n\r\n                            <h4 class=\"py-3 mb-4\"><span class=\"text-muted fw-light\">User /</span> User details</h4>\r\n                            <form action=\"${pageContext.request.contextPath}/user/update\" method=\"post\"\r\n                                  enctype=\"multipart/form-data\">\r\n                                <input type=\"hidden\" name=\"userId\" value=\"${requestScope.user.id}\"/>\r\n                                <input type=\"hidden\" name=\"action\" id=\"action\"/>\r\n\r\n                                <div class=\"card mb-4\">\r\n                                    <h5 class=\"card-header mb-3\">User Details for ${requestScope.user.name}</h5>\r\n                                    <!-- Account -->\r\n                                    <div class=\"card-body\">\r\n                                        <div class=\"d-flex align-items-start align-items-sm-center gap-4\">\r\n                                            <img\r\n                                                src=\"../${requestScope.user.avatar}\"\r\n                                                alt=\"user-avatar\"\r\n                                                class=\"d-block rounded\"\r\n                                                height=\"100\"\r\n                                                width=\"100\"\r\n                                                id=\"uploadedAvatar\"/>\r\n                                            <div class=\"button-wrapper\">\r\n                                                <label for=\"upload\" class=\"btn btn-primary me-2 mb-4\" tabindex=\"0\">\r\n                                                    <span class=\"d-none d-sm-block\">Upload new photo</span>\r\n                                                    <i class=\"bx bx-upload d-block d-sm-none\"></i>\r\n                                                    <input\r\n                                                        type=\"file\"\r\n                                                        id=\"upload\"\r\n                                                        class=\"account-file-input\"\r\n                                                        accept=\"image/png, image/jpeg\"\r\n                                                        hidden\r\n                                                        name=\"newAvatar\"/>\r\n                                                </label>\r\n                                                <button type=\"button\" class=\"btn btn-outline-secondary account-image-reset mb-4 me-2\">\r\n                                                    <i class=\"bx bx-reset d-block d-sm-none\"></i>\r\n                                                    <span class=\"d-none d-sm-block\">Reset</span>\r\n                                                </button>\r\n\r\n                                                <p class=\"text-muted mb-0\">Allowed JPG, GIF or PNG. Max size of 800K</p>\r\n                                                <c:if test=\"${requestScope.avtErr != null && !requestScope.avtErr.isEmpty()}\">\r\n                                                    <div>\r\n                                                        <h6 style=\"color: red;\">${requestScope.avtErr}</h6>\r\n                                                    </div>\r\n                                                </c:if>\r\n                                            </div>\r\n                                        </div>\r\n                                    </div>\r\n                                    <hr class=\"my-0\" />\r\n                                    <div class=\"card-body\">\r\n                                        <div class=\"row\">\r\n                                            <div class=\"mb-3 col-md-6\">\r\n                                                <label for=\"name\" class=\"form-label\">Name</label>\r\n                                                <input\r\n                                                    class=\"form-control\"\r\n                                                    type=\"text\"\r\n                                                    id=\"name\"\r\n                                                    name=\"name\"\r\n                                                    value=\"${requestScope.user.name}\"\r\n                                                    autofocus />\r\n                                                <c:if test=\"${requestScope.nameErr != null && !requestScope.nameErr.isEmpty()}\">\r\n                                                    <h6 style=\"color: red;\">${requestScope.nameErr}</h6>\r\n                                                </c:if>\r\n                                            </div>\r\n                                            <div class=\"mb-3 col-md-6\">\r\n                                                <label for=\"email\" class=\"form-label\">E-mail</label>\r\n                                                <input\r\n                                                    class=\"form-control\"\r\n                                                    type=\"text\"\r\n                                                    id=\"email\"\r\n                                                    name=\"email\"\r\n                                                    value=\"${requestScope.user.email}\"\r\n                                                    placeholder=\"john.doe@example.com\" \r\n                                                    readonly/>\r\n                                            </div>\r\n                                            <div class=\"mb-3 col-md-6\">\r\n                                                <label for=\"roleSelect\" class=\"form-label\">Role</label>\r\n                                                <select id=\"roleSelect\" class=\"select2 form-select\" name=\"roleId\">\r\n                                                    <c:forEach items=\"${requestScope.roleList}\" var=\"role\">\r\n                                                        <c:if test=\"${requestScope.user.role == role.id}\">\r\n                                                            <option value=\"${role.id}\" selected>${role.name}</option>\r\n                                                        </c:if>\r\n                                                        <c:if test=\"${requestScope.user.role != role.id}\">\r\n                                                            <option value=\"${role.id}\">${role.name}</option>\r\n                                                        </c:if>\r\n                                                    </c:forEach>\r\n                                                </select>\r\n                                            </div>\r\n                                            <div class=\"mb-3 col-md-6\">\r\n                                                <label class=\"form-label\" for=\"status\">Status</label>\r\n                                                <div class=\"form-control\" id=\"status\">\r\n                                                    <c:if test=\"${requestScope.user.status == 1}\">\r\n                                                        <span class=\"badge rounded-pill bg-success\" >Active</span>\r\n                                                    </c:if>\r\n                                                    <c:if test=\"${requestScope.user.status == 0}\">\r\n                                                        <span class=\"badge rounded-pill bg-danger\" >Inactive</span>\r\n                                                    </c:if>\r\n                                                    <c:if test=\"${requestScope.user.status == 2}\">\r\n                                                        <span class=\"badge rounded-pill bg-info\" >Unverified</span>\r\n                                                    </c:if>\r\n                                                </div>\r\n                                            </div>\r\n                                        </div>\r\n                                        <div class=\"mt-2\">\r\n                                            <button type=\"submit\" class=\"btn btn-primary me-2\"\r\n                                                    onclick=\"document.getElementById('action').value = 'saveChanges'\">Save changes</button>\r\n                                        </div>\r\n                                    </div>\r\n                                    <!-- /Account -->\r\n                                </div>\r\n                            </form>\r\n                            <hr class=\"my-5\" />\r\n\r\n                        </div>\r\n                        <!-- / Content -->\r\n\r\n                        <div class=\"content-backdrop fade\"></div>\r\n                        <jsp:include page=\"/WEB-INF/common/footer.jsp\"/>\r\n                    </div>\r\n                    <!-- Content wrapper -->\r\n\r\n\r\n                </div>\r\n                <!-- / Layout page -->\r\n            </div>\r\n        </div>\r\n        <!-- / Layout wrapper -->\r\n\r\n        <script src=\"https://code.jquery.com/jquery-3.4.1.min.js\"></script>\r\n        <script src=\"https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.bundle.min.js\"></script>\r\n        <script src=\"../lib/easing/easing.min.js\"></script>\r\n        <script src=\"../lib/waypoints/waypoints.min.js\"></script>\r\n        <script src=\"../lib/counterup/counterup.min.js\"></script>\r\n        <script src=\"../lib/owlcarousel/owl.carousel.min.js\"></script>\r\n\r\n        <!-- Template Javascript -->\r\n        <script src=\"../js/main.js\"></script>\r\n\r\n        <!-- Core JS -->\r\n        <!-- build:js ../assets/vendor/js/core.js -->\r\n\r\n        <script src=\"../assets/vendor/libs/jquery/jquery.js\"></script>\r\n        <script src=\"../assets/vendor/libs/popper/popper.js\"></script>\r\n        <script src=\"../assets/vendor/js/bootstrap.js\"></script>\r\n        <script src=\"../assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.js\"></script>\r\n        <script src=\"../assets/vendor/js/menu.js\"></script>\r\n\r\n        <!-- endbuild -->\r\n\r\n        <!-- Vendors JS -->\r\n        <script src=\"../assets/vendor/libs/apex-charts/apexcharts.js\"></script>\r\n\r\n        <!-- Main JS -->\r\n        <script src=\"../assets/js/main.js\"></script>\r\n\r\n        <!-- Page JS -->\r\n        <script src=\"../assets/js/dashboards-analytics.js\"></script>\r\n        <script src=\"../assets/js/pages-account-settings-account.js\"></script>\r\n\r\n        <!-- Place this tag in your head or just before your close body tag. -->\r\n        <script async defer src=\"https://buttons.github.io/buttons.js\"></script>\r\n    </body>\r\n</html>\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/web/WEB-INF/views/user/userdetails.jsp b/web/WEB-INF/views/user/userdetails.jsp
--- a/web/WEB-INF/views/user/userdetails.jsp	(revision d6ad1445e1c07c5da0ab8951156084fe4a182d1f)
+++ b/web/WEB-INF/views/user/userdetails.jsp	(date 1721252670161)
@@ -63,9 +63,37 @@
         <!--? Config:  Mandatory theme config file contain global vars & default theme options, Set your preferred theme option in this file.  -->
         <script src="../assets/js/config.js"></script>
 
+        <script>
+            function setActiveTab(currentPage) {
+                if (currentPage === 'enterData' || currentPage === null || currentPage === '') {
+                    document.getElementById("navs-pills-enter-data").className = "tab-pane fade show active";
+                    document.getElementById("buttonEnterData").ariaSelected = true;
+                    document.getElementById("buttonEnterData").className = "nav-link active";
+                    document.getElementById("buttonAssignSubject").className = "nav-link";
+                    document.getElementById("buttonAssignSubject").ariaSelected = false;
+                } else {
+                    document.getElementById("navs-pills-assign-subject").className = "tab-pane fade show active";
+                    document.getElementById("buttonAssignSubject").ariaSelected = true;
+                    document.getElementById("buttonAssignSubject").className = "nav-link active";
+                    document.getElementById("buttonEnterData").className = "nav-link";
+                    document.getElementById("buttonEnterData").ariaSelected = false;
+                }
+            }
+            function getActiveTab() {
+                if (document.getElementById("buttonAssignSubject").className === 'nav-link active') {
+                    return "assignSubject";
+                } else {
+                    return "enterData";
+                }
+            }
+            function setActiveTabForRefresh() {
+                document.getElementById('currentPage').value = getActiveTab();
+            }
+        </script>
+
     </head>
 
-    <body>
+    <body onload="setActiveTab('${requestScope.currentPage}');">
         <!-- Layout wrapper -->
         <div class="layout-wrapper layout-content-navbar">
             <div class="layout-container">
@@ -90,109 +118,216 @@
                                 <input type="hidden" name="userId" value="${requestScope.user.id}"/>
                                 <input type="hidden" name="action" id="action"/>
 
-                                <div class="card mb-4">
-                                    <h5 class="card-header mb-3">User Details for ${requestScope.user.name}</h5>
-                                    <!-- Account -->
-                                    <div class="card-body">
-                                        <div class="d-flex align-items-start align-items-sm-center gap-4">
-                                            <img
-                                                src="../${requestScope.user.avatar}"
-                                                alt="user-avatar"
-                                                class="d-block rounded"
-                                                height="100"
-                                                width="100"
-                                                id="uploadedAvatar"/>
-                                            <div class="button-wrapper">
-                                                <label for="upload" class="btn btn-primary me-2 mb-4" tabindex="0">
-                                                    <span class="d-none d-sm-block">Upload new photo</span>
-                                                    <i class="bx bx-upload d-block d-sm-none"></i>
-                                                    <input
-                                                        type="file"
-                                                        id="upload"
-                                                        class="account-file-input"
-                                                        accept="image/png, image/jpeg"
-                                                        hidden
-                                                        name="newAvatar"/>
-                                                </label>
-                                                <button type="button" class="btn btn-outline-secondary account-image-reset mb-4 me-2">
-                                                    <i class="bx bx-reset d-block d-sm-none"></i>
-                                                    <span class="d-none d-sm-block">Reset</span>
-                                                </button>
+                                <div class="row">
+                                    <div class="nav-align-top mb-4">
+                                        <ul class="nav nav-pills mb-3" role="tablist">
+                                            <li class="nav-item">
+                                                <button
+                                                    type="button"
+                                                    id="buttonEnterData"
+                                                    role="tab"
+                                                    data-bs-toggle="tab"
+                                                    data-bs-target="#navs-pills-enter-data"
+                                                    aria-controls="navs-pills-enter-data">
+                                                    Update user details
+                                                </button>
+                                            </li>
+                                            <c:if test="${requestScope.user.role < 3}">
+                                                <li class="nav-item">
+                                                    <button
+                                                        type="button"
+                                                        id="buttonAssignSubject"
+                                                        role="tab"
+                                                        data-bs-toggle="tab"
+                                                        data-bs-target="#navs-pills-assign-subject"
+                                                        aria-controls="navs-pills-assign-subject">
+                                                        Assign subjects
+                                                    </button>
+                                                </li>
+                                            </c:if>
+                                        </ul>
+                                        <div class="tab-content" style="width: 100%;">
+                                            <div class="tab-pane fade" id="navs-pills-enter-data" role="tabpanel">
+                                                <div class="card mb-4">
+                                                    <h5 class="card-header mb-3">User Details for ${requestScope.user.name}</h5>
+                                                    <!-- Account -->
+                                                    <div class="card-body">
+                                                        <div class="d-flex align-items-start align-items-sm-center gap-4">
+                                                            <img
+                                                                src="../${requestScope.user.avatar}"
+                                                                alt="user-avatar"
+                                                                class="d-block rounded"
+                                                                height="100"
+                                                                width="100"
+                                                                id="uploadedAvatar"/>
+                                                            <div class="button-wrapper">
+                                                                <label for="upload" class="btn btn-primary me-2 mb-4" tabindex="0">
+                                                                    <span class="d-none d-sm-block">Upload new photo</span>
+                                                                    <i class="bx bx-upload d-block d-sm-none"></i>
+                                                                    <input
+                                                                        type="file"
+                                                                        id="upload"
+                                                                        class="account-file-input"
+                                                                        accept="image/png, image/jpeg"
+                                                                        hidden
+                                                                        name="newAvatar"/>
+                                                                </label>
+                                                                <button type="button" class="btn btn-outline-secondary account-image-reset mb-4 me-2">
+                                                                    <i class="bx bx-reset d-block d-sm-none"></i>
+                                                                    <span class="d-none d-sm-block">Reset</span>
+                                                                </button>
 
-                                                <p class="text-muted mb-0">Allowed JPG, GIF or PNG. Max size of 800K</p>
-                                                <c:if test="${requestScope.avtErr != null && !requestScope.avtErr.isEmpty()}">
-                                                    <div>
-                                                        <h6 style="color: red;">${requestScope.avtErr}</h6>
-                                                    </div>
-                                                </c:if>
-                                            </div>
-                                        </div>
-                                    </div>
-                                    <hr class="my-0" />
-                                    <div class="card-body">
-                                        <div class="row">
-                                            <div class="mb-3 col-md-6">
-                                                <label for="name" class="form-label">Name</label>
-                                                <input
-                                                    class="form-control"
-                                                    type="text"
-                                                    id="name"
-                                                    name="name"
-                                                    value="${requestScope.user.name}"
-                                                    autofocus />
-                                                <c:if test="${requestScope.nameErr != null && !requestScope.nameErr.isEmpty()}">
-                                                    <h6 style="color: red;">${requestScope.nameErr}</h6>
-                                                </c:if>
-                                            </div>
-                                            <div class="mb-3 col-md-6">
-                                                <label for="email" class="form-label">E-mail</label>
-                                                <input
-                                                    class="form-control"
-                                                    type="text"
-                                                    id="email"
-                                                    name="email"
-                                                    value="${requestScope.user.email}"
-                                                    placeholder="john.doe@example.com" 
-                                                    readonly/>
-                                            </div>
-                                            <div class="mb-3 col-md-6">
-                                                <label for="roleSelect" class="form-label">Role</label>
-                                                <select id="roleSelect" class="select2 form-select" name="roleId">
-                                                    <c:forEach items="${requestScope.roleList}" var="role">
-                                                        <c:if test="${requestScope.user.role == role.id}">
-                                                            <option value="${role.id}" selected>${role.name}</option>
-                                                        </c:if>
-                                                        <c:if test="${requestScope.user.role != role.id}">
-                                                            <option value="${role.id}">${role.name}</option>
-                                                        </c:if>
-                                                    </c:forEach>
-                                                </select>
-                                            </div>
-                                            <div class="mb-3 col-md-6">
-                                                <label class="form-label" for="status">Status</label>
-                                                <div class="form-control" id="status">
-                                                    <c:if test="${requestScope.user.status == 1}">
-                                                        <span class="badge rounded-pill bg-success" >Active</span>
-                                                    </c:if>
-                                                    <c:if test="${requestScope.user.status == 0}">
-                                                        <span class="badge rounded-pill bg-danger" >Inactive</span>
-                                                    </c:if>
-                                                    <c:if test="${requestScope.user.status == 2}">
-                                                        <span class="badge rounded-pill bg-info" >Unverified</span>
-                                                    </c:if>
-                                                </div>
-                                            </div>
-                                        </div>
-                                        <div class="mt-2">
-                                            <button type="submit" class="btn btn-primary me-2"
-                                                    onclick="document.getElementById('action').value = 'saveChanges'">Save changes</button>
-                                        </div>
-                                    </div>
-                                    <!-- /Account -->
+                                                                <p class="text-muted mb-0">Allowed JPG, GIF or PNG. Max size of 800K</p>
+                                                                <c:if test="${requestScope.avtErr != null && !requestScope.avtErr.isEmpty()}">
+                                                                    <div>
+                                                                        <h6 style="color: red;">${requestScope.avtErr}</h6>
+                                                                    </div>
+                                                                </c:if>
+                                                            </div>
+                                                        </div>
+                                                    </div>
+                                                    <hr class="my-0" />
+                                                    <div class="card-body">
+                                                        <div class="row">
+                                                            <div class="mb-3 col-md-6">
+                                                                <label for="name" class="form-label">Name</label>
+                                                                <input
+                                                                    class="form-control"
+                                                                    type="text"
+                                                                    id="name"
+                                                                    name="name"
+                                                                    value="${requestScope.user.name}"
+                                                                    autofocus />
+                                                                <c:if test="${requestScope.nameErr != null && !requestScope.nameErr.isEmpty()}">
+                                                                    <h6 style="color: red;">${requestScope.nameErr}</h6>
+                                                                </c:if>
+                                                            </div>
+                                                            <div class="mb-3 col-md-6">
+                                                                <label for="email" class="form-label">E-mail</label>
+                                                                <input
+                                                                    class="form-control"
+                                                                    type="text"
+                                                                    id="email"
+                                                                    name="email"
+                                                                    value="${requestScope.user.email}"
+                                                                    placeholder="john.doe@example.com" 
+                                                                    readonly/>
+                                                            </div>
+                                                            <div class="mb-3 col-md-6">
+                                                                <label for="roleSelect" class="form-label">Role</label>
+                                                                <select id="roleSelect" class="select2 form-select" name="roleId">
+                                                                    <c:forEach items="${requestScope.roleList}" var="role">
+                                                                        <c:if test="${requestScope.user.role == role.id}">
+                                                                            <option value="${role.id}" selected>${role.name}</option>
+                                                                        </c:if>
+                                                                        <c:if test="${requestScope.user.role != role.id}">
+                                                                            <option value="${role.id}">${role.name}</option>
+                                                                        </c:if>
+                                                                    </c:forEach>
+                                                                </select>
+                                                            </div>
+                                                            <div class="mb-3 col-md-6">
+                                                                <label class="form-label" for="status">Status</label>
+                                                                <div class="form-control" id="status">
+                                                                    <c:if test="${requestScope.user.status == 1}">
+                                                                        <span class="badge rounded-pill bg-success" >Active</span>
+                                                                    </c:if>
+                                                                    <c:if test="${requestScope.user.status == 0}">
+                                                                        <span class="badge rounded-pill bg-danger" >Inactive</span>
+                                                                    </c:if>
+                                                                    <c:if test="${requestScope.user.status == 2}">
+                                                                        <span class="badge rounded-pill bg-info" >Unverified</span>
+                                                                    </c:if>
+                                                                </div>
+                                                            </div>
+                                                        </div>
+                                                        <div class="mt-2">
+                                                            <button type="submit" class="btn btn-primary me-2"
+                                                                    onclick="document.getElementById('action').value = 'saveChanges'">Save changes</button>
+                                                        </div>
+                                                    </div>
+                                                    <!-- /Account -->
+                                                </div>
+                                            </div>
+                                            <c:if test="${requestScope.user.role < 3}">
+                                                <div class="tab-pane fade" id="navs-pills-assign-subject" role="tabpanel">
+                                                    <div class="input-group mr-3 mb-3" style="overflow: auto;">
+                                                        <label for="subjectId">Subject: </label>
+                                                        <select style="height: 38px;" name="subjectId" id="subjectId" class="mr-3 ml-3" 
+                                                                onmousedown="if (this.options.length > 5) {
+                                                                            this.size = 5;
+                                                                            document.getElementById('sortBy').style.height = '115px';
+                                                                        }"  
+                                                                onblur="this.size = 0;
+                                                                        document.getElementById('sortBy').style.height = '38px';">
+                                                            <c:forEach items="${requestScope.unassignedSubjectList}" var="subject">
+                                                                <c:if test="${requestScope.subject.id == subject.id}">
+                                                                    <option value="${subject.id}" selected>${subject.code}</option>
+                                                                </c:if>
+                                                                <c:if test="${requestScope.subject.id != subject.id}">
+                                                                    <option value="${subject.id}">${subject.code}</option>
+                                                                </c:if>
+                                                            </c:forEach>
+                                                        </select>
+                                                        <button style="height: 38px; float: right;" 
+                                                                class="btn btn-outline-primary mr-2" type="submit"
+                                                                onclick="document.getElementById('action').value = 'assignSubject';">Assign subject</button>
+                                                        <c:if test="${requestScope.err != null && !requestScope.err.isEmpty()}">
+                                                            <h6 style="color: red;">${requestScope.err}</h6>
+                                                        </c:if>
+                                                    </div>
+                                                    <div class="card">
+                                                        <h5 class="card-header">Subject list</h5>
+                                                        <div class="table-responsive text-nowrap">
+                                                            <table class="table">
+                                                                <thead>
+                                                                    <tr>
+                                                                        <th>#</th>
+                                                                        <th>Code</th>
+                                                                        <th>Name</th>
+                                                                        <th></th>
+                                                                    </tr>
+                                                                </thead>
+                                                                <tbody class="table-border-bottom-0">
+                                                                    <c:forEach items="${requestScope.subjectList}" var="subject">
+                                                                        <tr>
+                                                                            <td class="text-primary">${subject.id}</td>
+                                                                            <td class="text-primary">${subject.code}</td>
+                                                                            <td class="text-primary">${subject.name}</td>
+                                                                            <td>
+                                                                                <button class="btn btn-icon btn-outline-danger"
+                                                                                        type="button"
+                                                                                        style="height: 25px; width: 25px; float: left;"
+                                                                                        data-toggle="tooltip" data-placement="bottom" title="Remove"
+                                                                                        onclick="
+                                                                                                document.getElementById('modalSubjectId').value = ${subject.id};"
+                                                                                        data-bs-toggle="modal" data-bs-target="#modalAssign">
+                                                                                    <i class="bx bx-trash"></i>
+                                                                                </button>
+                                                                            </td>
+                                                                        </tr>
+                                                                    </c:forEach>
+                                                                </tbody>
+                                                            </table>
+
+                                                        </div>
+
+                                                        <!--/ Basic Bootstrap Table -->
+
+
+                                                    </div>
+                                                </div>
+                                            </c:if>
+                                        </div>
+                                    </div>
                                 </div>
+
+
                             </form>
                             <hr class="my-5" />
 
+                            <a class="btn btn-primary" href="${pageContext.request.contextPath}/user">Back</a>
+
                         </div>
                         <!-- / Content -->
 
@@ -208,6 +343,35 @@
         </div>
         <!-- / Layout wrapper -->
 
+        <div class="modal fade" id="modalAssign" tabindex="-1" aria-hidden="true">
+            <form action="${pageContext.request.contextPath}/user/update">
+                <input type="hidden" name="userId" value="${requestScope.user.id}"/>
+                <input type="hidden" name="action" value="removeSubject"/>
+                <input type="hidden" name="subjectId" id="modalSubjectId"/>
+                <div class="modal-dialog modal-dialog-centered" role="document">
+                    <div class="modal-content">
+                        <div class="modal-header">
+                            <h5 class="modal-title" id="modalCenterTitle">Remove subject</h5>
+                            <button
+                                type="button"
+                                class="btn-close"
+                                data-bs-dismiss="modal"
+                                aria-label="Close"></button>
+                        </div>
+                        <div class="modal-body">
+                            <h5 id="modalOrderBodyText">Are you sure you want to remove subject?</h5>
+                        </div>
+                        <div class="modal-footer">
+                            <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
+                                No
+                            </button>
+                            <button type="submit" class="btn btn-primary">Yes</button>
+                        </div>
+                    </div>
+                </div>
+            </form>
+        </div>
+
         <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
         <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.bundle.min.js"></script>
         <script src="../lib/easing/easing.min.js"></script>
Index: web/WEB-INF/home/home.jsp
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/web/WEB-INF/home/home.jsp b/web/WEB-INF/home/home.jsp
new file mode 100644
--- /dev/null	(date 1721252670161)
+++ b/web/WEB-INF/home/home.jsp	(date 1721252670161)
@@ -0,0 +1,120 @@
+<%@page isELIgnored="false" %>
+<%@taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
+<!DOCTYPE html>
+<html lang="en">
+
+    <head>
+        <meta charset="utf-8">
+        <title>Knowledge Revising System</title>
+        <meta content="width=device-width, initial-scale=1.0" name="viewport">
+        <meta content="Free HTML Templates" name="keywords">
+        <meta content="Free HTML Templates" name="description">
+
+        <!-- Favicon -->
+        <link href="img/favicon.ico" rel="icon">
+
+        <!-- Google Web Fonts -->
+        <link rel="preconnect" href="https://fonts.gstatic.com">
+        <link href="https://fonts.googleapis.com/css2?family=Jost:wght@500;600;700&family=Open+Sans:wght@400;600&display=swap" rel="stylesheet">
+
+        <!-- Font Awesome -->
+        <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css" rel="stylesheet">
+
+        <!-- Libraries Stylesheet -->
+        <link href="lib/owlcarousel/assets/owl.carousel.min.css" rel="stylesheet">
+
+        <!-- Customized Bootstrap Stylesheet -->
+        <link href="css/style.css" rel="stylesheet">
+    </head>
+
+    <body>
+        <jsp:include page="/WEB-INF/common/header.jsp"/>
+
+        <!-- Header Start -->
+        <div class="jumbotron jumbotron-fluid position-relative overlay-bottom" style="margin-bottom: 90px;">
+            <div class="container text-center my-5 py-5">
+                <h1 class="text-white mt-4 mb-4">Learn From Home</h1>
+                <h1 class="text-white display-1 mb-5">Knowledge Revising System</h1>
+                <div class="mx-auto mb-5" style="width: 100%; max-width: 600px;">
+                    <div class="input-group">
+                        <input type="text" class="form-control border-light" style="padding: 30px 25px;" placeholder="Keyword">
+                        <div class="input-group-append">
+                            <button class="btn btn-secondary px-4 px-lg-5">Search</button>
+                        </div>
+                    </div>
+                </div>
+            </div>
+        </div>
+        <!-- Header End -->
+
+
+        <!-- About Start -->
+        <div class="container-fluid py-5">
+            <div class="container py-5">
+                <div class="row">
+                    <div class="col-lg-5 mb-5 mb-lg-0" style="min-height: 500px;">
+                        <div class="position-relative h-100">
+                            <img class="position-absolute w-100 h-100" src="assets/img/home_1.jpg" style="object-fit: cover;">
+                        </div>
+                    </div>
+                    <div class="col-lg-7">
+                        <div class="section-title position-relative mb-4">
+                            <h6 class="d-inline-block position-relative text-secondary text-uppercase pb-2">About Us</h6>
+                            <h1 class="display-4">First Choice For Online Education For FPT University Students</h1>
+                        </div>
+                        <p>Knowledge Revising System allows students all across FPT University to study anytime, anywhere. This platform provides two learning methods for students, so they can choose their favorite options and study effectively.</p>
+                        <div class="row pt-3 mx-0">
+                            <div class="col-3 px-0">
+                                <div class="bg-success text-center p-4">
+                                    <h1 class="text-white" data-toggle="counter-up">${requestScope.numberOfSubjects}</h1>
+                                    <h6 class="text-uppercase text-white">Available<span class="d-block">Subjects</span></h6>
+                                </div>
+                            </div>
+                            <div class="col-3 px-0">
+                                <div class="bg-primary text-center p-4">
+                                    <h1 class="text-white" data-toggle="counter-up">${requestScope.numberOfClasses}</h1>
+                                    <h6 class="text-uppercase text-white">Online<span class="d-block">Classes</span></h6>
+                                </div>
+                            </div>
+                            <div class="col-3 px-0">
+                                <div class="bg-secondary text-center p-4">
+                                    <h1 class="text-white" data-toggle="counter-up">${requestScope.numberOfTeachers}</h1>
+                                    <h6 class="text-uppercase text-white">Skilled<span class="d-block">Instructors</span></h6>
+                                </div>
+                            </div>
+                            <div class="col-3 px-0">
+                                <div class="bg-warning text-center p-4">
+                                    <h1 class="text-white" data-toggle="counter-up">${requestScope.numberOfStudents}</h1>
+                                    <h6 class="text-uppercase text-white">Happy<span class="d-block">Students</span></h6>
+                                </div>
+                            </div>
+                        </div>
+                    </div>
+                </div>
+            </div>
+        </div>
+        <!-- About End -->
+
+        
+        <jsp:include page="/WEB-INF/common/footer.jsp"/>
+
+
+        <!-- Back to Top -->
+        <a href="#" class="btn btn-lg btn-primary rounded-0 btn-lg-square back-to-top"><i class="fa fa-angle-double-up"></i></a>
+
+
+        <!-- JavaScript Libraries -->
+        <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
+        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.bundle.min.js"></script>
+        <script src="lib/easing/easing.min.js"></script>
+        <script src="lib/waypoints/waypoints.min.js"></script>
+        <script src="lib/counterup/counterup.min.js"></script>
+        <script src="lib/owlcarousel/owl.carousel.min.js"></script>
+
+        <!-- Template Javascript -->
+        <script src="js/main.js"></script>
+        
+        <script src="js/header.js"></script>
+    </body>
+
+</html>
Index: web/WEB-INF/contact/contactadmin.jsp
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/web/WEB-INF/contact/contactadmin.jsp b/web/WEB-INF/contact/contactadmin.jsp
new file mode 100644
--- /dev/null	(date 1721252670161)
+++ b/web/WEB-INF/contact/contactadmin.jsp	(date 1721252670161)
@@ -0,0 +1,159 @@
+<%@page isELIgnored="false" %>
+<%@taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
+<!DOCTYPE html>
+<html lang="en">
+
+    <head>
+        <meta charset="utf-8">
+        <title>Knowledge Revising System</title>
+        <meta content="width=device-width, initial-scale=1.0" name="viewport">
+        <meta content="Free HTML Templates" name="keywords">
+        <meta content="Free HTML Templates" name="description">
+
+        <!-- Favicon -->
+        <link href="img/favicon.ico" rel="icon">
+
+        <!-- Google Web Fonts -->
+        <link rel="preconnect" href="https://fonts.gstatic.com">
+        <link href="https://fonts.googleapis.com/css2?family=Jost:wght@500;600;700&family=Open+Sans:wght@400;600&display=swap" rel="stylesheet">
+
+        <!-- Font Awesome -->
+        <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css" rel="stylesheet">
+
+        <!-- Libraries Stylesheet -->
+        <link href="lib/owlcarousel/assets/owl.carousel.min.css" rel="stylesheet">
+
+        <!-- Customized Bootstrap Stylesheet -->
+        <link href="css/style.css" rel="stylesheet">
+    </head>
+
+    <body>
+        <jsp:include page="/WEB-INF/common/header.jsp"/>
+
+
+        <!-- Contact Start -->
+        <div class="container-fluid py-5" id="contact-form">
+            <div class="container py-5">
+                <div class="row align-items-center">
+                    <div class="col-lg-5 mb-5 mb-lg-0">
+                        <div class="bg-light d-flex flex-column justify-content-center px-5" style="height: 450px;">
+                            <div class="d-flex align-items-center mb-5">
+                                <div class="btn-icon bg-primary mr-4">
+                                    <i class="fa fa-2x fa-map-marker-alt text-white"></i>
+                                </div>
+                                <div class="mt-n1">
+                                    <h4>Our Location</h4>
+                                    <p class="m-0">123 Street, New York, USA</p>
+                                </div>
+                            </div>
+                            <div class="d-flex align-items-center mb-5">
+                                <div class="btn-icon bg-secondary mr-4">
+                                    <i class="fa fa-2x fa-phone-alt text-white"></i>
+                                </div>
+                                <div class="mt-n1">
+                                    <h4>Call Us</h4>
+                                    <p class="m-0">+012 345 6789</p>
+                                </div>
+                            </div>
+                            <div class="d-flex align-items-center">
+                                <div class="btn-icon bg-warning mr-4">
+                                    <i class="fa fa-2x fa-envelope text-white"></i>
+                                </div>
+                                <div class="mt-n1">
+                                    <h4>Email Us</h4>
+                                    <p class="m-0">info@example.com</p>
+                                </div>
+                            </div>
+                        </div>
+                    </div>
+                    <div class="col-lg-7">
+                        <div class="section-title position-relative mb-4">
+                            <h6 class="d-inline-block position-relative text-secondary text-uppercase pb-2">Need Help?</h6>
+                            <h1 class="display-4">Send Us A Message</h1>
+                            <h5 class="d-inline-block position-relative text-success pb-2">${requestScope.success}</h5>
+                            <h5 class="d-inline-block position-relative text-secondary pb-2">${requestScope.err}</h5>
+                        </div>
+                        <div class="contact-form">
+                            <form action="${pageContext.request.contextPath}/contact" method="post">
+                                <input type="hidden" name="action" value="enterInfo"/>
+                                <div class="row">
+                                    <c:if test="${sessionScope.user == null}">
+                                        <div class="col-6 form-group">
+                                            <input type="text" name="name" 
+                                                   class="form-control border-top-0 border-right-0 border-left-0 p-0" 
+                                                   placeholder="Your Name" value="${requestScope.contact.name}">
+                                            <h6 style="color: red; font-style: italic;">${requestScope.contactErr.nameErr}</h6>
+                                        </div>
+                                        <div class="col-6 form-group">
+                                            <input type="text" name="email" 
+                                                   class="form-control border-top-0 border-right-0 border-left-0 p-0" 
+                                                   placeholder="Your Email" value="${requestScope.contact.email}">
+                                            <h6 style="color: red; font-style: italic;">${requestScope.contactErr.emailErr}</h6>
+                                        </div>
+                                    </c:if>
+                                    <c:if test="${sessionScope.user != null}">
+                                        <div class="col-6 form-group">
+                                            <input type="text" name="name"
+                                                   class="form-control border-top-0 border-right-0 border-left-0 p-0" 
+                                                   placeholder="Your Name" value="${sessionScope.user.name}"
+                                                   readonly>
+                                        </div>
+                                        <div class="col-6 form-group">
+                                            <input type="text" name="email" 
+                                                   class="form-control border-top-0 border-right-0 border-left-0 p-0" 
+                                                   placeholder="Your Email" value="${sessionScope.user.email}"
+                                                   readonly>
+                                        </div>
+                                    </c:if>
+                                </div>
+                                <div class="form-group">
+                                    <input type="text" name="phone" 
+                                           class="form-control border-top-0 border-right-0 border-left-0 p-0" 
+                                           placeholder="Your Phone Number" value="${requestScope.contact.phone}">
+                                    <h6 style="color: red; font-style: italic;">${requestScope.contactErr.phoneErr}</h6>
+                                </div>
+                                <div class="form-group">
+                                    <input type="text" name="subject" 
+                                           class="form-control border-top-0 border-right-0 border-left-0 p-0" 
+                                           placeholder="Subject" value="${requestScope.contact.subject}">
+                                    <h6 style="color: red; font-style: italic;">${requestScope.contactErr.subjectErr}</h6>
+                                </div>
+                                <div class="form-group">
+                                    <textarea name="message"
+                                              class="form-control border-top-0 border-right-0 border-left-0 p-0" 
+                                              rows="5" placeholder="Message">${requestScope.contact.message}</textarea>
+                                    <h6 style="color: red; font-style: italic;">${requestScope.contactErr.messageErr}</h6>
+                                </div>
+                                <div>
+                                    <button class="btn btn-primary py-3 px-5" type="submit">Send Message</button>
+                                </div>
+                            </form>
+                        </div>
+                    </div>
+                </div>
+            </div>
+        </div>
+        <!-- Contact End -->
+
+        <jsp:include page="/WEB-INF/common/footer.jsp"/>
+
+
+        <!-- Back to Top -->
+        <a href="#" class="btn btn-lg btn-primary rounded-0 btn-lg-square back-to-top"><i class="fa fa-angle-double-up"></i></a>
+
+
+        <!-- JavaScript Libraries -->
+        <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
+        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.bundle.min.js"></script>
+        <script src="lib/easing/easing.min.js"></script>
+        <script src="lib/waypoints/waypoints.min.js"></script>
+        <script src="lib/counterup/counterup.min.js"></script>
+        <script src="lib/owlcarousel/owl.carousel.min.js"></script>
+
+        <!-- Template Javascript -->
+        <script src="js/main.js"></script>
+
+        <script src="js/header.js"></script>
+    </body>
+
+</html>
Index: web/WEB-INF/views/question/questiondetails.jsp
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><%@page isELIgnored=\"false\" %>\r\n<%@taglib prefix=\"c\" uri=\"http://java.sun.com/jsp/jstl/core\" %>\r\n<%@page contentType=\"text/html\" pageEncoding=\"UTF-8\"%>\r\n<html\r\n    lang=\"en\"\r\n    class=\"light-style layout-menu-fixed layout-compact\"\r\n    dir=\"ltr\"\r\n    data-theme=\"theme-default\"\r\n    data-assets-path=\"../assets/\"\r\n    data-template=\"vertical-menu-template-free\">\r\n    <head>\r\n        <meta charset=\"utf-8\" />\r\n        <meta\r\n            name=\"viewport\"\r\n            content=\"width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0\" />\r\n\r\n        <title>Question details</title>\r\n\r\n        <meta name=\"description\" content=\"\" />\r\n\r\n        <!-- Favicon -->\r\n        <link rel=\"icon\" type=\"image/x-icon\" href=\"../assets/img/favicon/favicon.ico\" />\r\n\r\n        <!-- Fonts -->\r\n        <link rel=\"preconnect\" href=\"https://fonts.googleapis.com\" />\r\n        <link rel=\"preconnect\" href=\"https://fonts.gstatic.com\" crossorigin />\r\n        <link\r\n            href=\"https://fonts.googleapis.com/css2?family=Public+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&display=swap\"\r\n            rel=\"stylesheet\" />\r\n\r\n        <link rel=\"stylesheet\" href=\"../assets/vendor/fonts/boxicons.css\" />\r\n\r\n        <!-- Core CSS -->\r\n        <link rel=\"stylesheet\" href=\"../assets/vendor/css/core.css\" class=\"template-customizer-core-css\" />\r\n        <link rel=\"stylesheet\" href=\"../assets/vendor/css/theme-default.css\" class=\"template-customizer-theme-css\" />\r\n        <link rel=\"stylesheet\" href=\"../assets/css/demo.css\" />\r\n\r\n        <!-- Vendors CSS -->\r\n        <link rel=\"stylesheet\" href=\"../assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.css\" />\r\n        <link rel=\"stylesheet\" href=\"../assets/vendor/libs/apex-charts/apex-charts.css\" />\r\n\r\n        <!-- Page CSS -->\r\n\r\n        <!-- Favicon -->\r\n        <link href=\"../img/favicon.ico\" rel=\"icon\">\r\n\r\n        <!-- Google Web Fonts -->\r\n        <link rel=\"preconnect\" href=\"https://fonts.gstatic.com\">\r\n        <link href=\"https://fonts.googleapis.com/css2?family=Jost:wght@500;600;700&family=Open+Sans:wght@400;600&display=swap\" rel=\"stylesheet\"> \r\n\r\n        <!-- Font Awesome -->\r\n        <link href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css\" rel=\"stylesheet\">\r\n\r\n        <!-- Libraries Stylesheet -->\r\n        <link href=\"../lib/owlcarousel/../assets/owl.carousel.min.css\" rel=\"stylesheet\">\r\n\r\n        <!-- Customized Bootstrap Stylesheet -->\r\n        <link href=\"../css/style.css\" rel=\"stylesheet\">\r\n\r\n        <!-- Helpers -->\r\n        <script src=\"../assets/vendor/js/helpers.js\"></script>\r\n        <!--! Template customizer & Theme config files MUST be included after core stylesheets and helpers.js in the <head> section -->\r\n        <!--? Config:  Mandatory theme config file contain global vars & default theme options, Set your preferred theme option in this file.  -->\r\n        <script src=\"../assets/js/config.js\"></script>\r\n\r\n\r\n    </head>\r\n\r\n    <body>\r\n        <!-- Layout wrapper -->\r\n        <div class=\"layout-wrapper layout-content-navbar\">\r\n            <div class=\"layout-container\">\r\n                <!-- Menu -->\r\n\r\n                <jsp:include page=\"/WEB-INF/common/sider.jsp\"/>\r\n                <!-- / Menu -->\r\n\r\n                <!-- Layout container -->\r\n                <div class=\"layout-page\">\r\n\r\n                    <!-- Content wrapper -->\r\n                    <div class=\"content-wrapper\">\r\n                        <!-- Content -->\r\n                        <jsp:include page=\"/WEB-INF/common/header.jsp\"/>\r\n\r\n                        <div class=\"container-xxl flex-grow-1 container-p-y\">\r\n\r\n\r\n                            <h4 class=\"py-3 mb-4\"><span class=\"text-muted fw-light\">Question /</span> Question details</h4>\r\n                            <form action=\"${pageContext.request.contextPath}/question/update\" method=\"post\">\r\n                                <div class=\"col-xxl\">\r\n                                    <div class=\"card mb-4\">\r\n                                        <div class=\"card-header d-flex align-items-center justify-content-between mb-3\">\r\n                                            <small class=\"text-muted float-end\">Input question and answers content</small>\r\n                                        </div>\r\n                                        <div class=\"card-body\">\r\n                                            <input type=\"hidden\" name=\"questionId\" value=\"${requestScope.question.id}\"/>\r\n                                            <input type=\"hidden\" name=\"action\" value=\"answerChange\"/>\r\n\r\n                                            <div class=\"row mb-5\">\r\n                                                <label class=\"col-sm-2 col-form-label\" for=\"basic-icon-default-fullname2\">Question</label>\r\n                                                <div class=\"col-sm-10\">\r\n                                                    <textarea name=\"question\" id=\"basic-icon-default-fullname2\"\r\n                                                              class=\"form-control border-top-0 border-right-0 border-left-0 p-0\" \r\n                                                              rows=\"5\" placeholder=\"Question content\" readonly>${requestScope.question.content}</textarea>\r\n                                                </div>\r\n                                            </div>\r\n                                            <c:forEach items=\"${requestScope.answers}\" var=\"answer\">\r\n                                                <div class=\"row mb-3\">\r\n                                                    <label class=\"col-sm-2 col-form-label\" for=\"basic-icon-default-fullname\">Answer</label>\r\n\r\n                                                    <div class=\"col-sm-10\">\r\n                                                        <div class=\"input-group\">\r\n                                                            <c:if test=\"${answer.isCorrect}\">\r\n                                                                <span style=\"height: 38px; width: 38px;\" class=\"input-group-text\"></span>\r\n                                                                <input\r\n                                                                    class=\"form-check-input mt-0 ml-2\"\r\n                                                                    type=\"checkbox\" style=\"align-self: center; \"\r\n                                                                    name=\"${answer.id}isCorrect\"\r\n                                                                    disabled\r\n                                                                    checked/>\r\n                                                            </c:if>\r\n                                                            <c:if test=\"${!answer.isCorrect}\">\r\n                                                                <span style=\"height: 38px; width: 38px;\" class=\"input-group-text\"></span>\r\n                                                                <input\r\n                                                                    class=\"form-check-input mt-0 ml-2\"\r\n                                                                    name=\"${answer.id}isCorrect\"\r\n                                                                    type=\"checkbox\" style=\"align-self: center; \"\r\n                                                                    disabled/>\r\n                                                            </c:if>\r\n\r\n                                                            <input type=\"text\" class=\"form-control\" id=\"basic-icon-default-fullname\"\r\n                                                                   name=\"${answer.id}\"\r\n                                                                   value=\"${answer.content}\"\r\n                                                                   readonly/>\r\n                                                        </div>\r\n                                                    </div>\r\n                                                </div>\r\n                                            </c:forEach>\r\n                                            <div class=\"row mb-3\">\r\n                                                <div class=\"row justify-content-end\">\r\n                                                    <div class=\"col-sm-10\">\r\n                                                        <button type=\"submit\" class=\"btn btn-primary\" disabled>Update answer</button>\r\n                                                        <h3>${requestScope.err}</h3>\r\n                                                    </div>\r\n                                                </div>\r\n                                            </div>\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n                            </form>\r\n                            <hr class=\"my-5\" />\r\n\r\n                        </div>\r\n                        <!-- / Content -->\r\n\r\n                        <div class=\"content-backdrop fade\"></div>\r\n                        <jsp:include page=\"/WEB-INF/common/footer.jsp\"/>\r\n                    </div>\r\n                    <!-- Content wrapper -->\r\n\r\n\r\n                </div>\r\n                <!-- / Layout page -->\r\n            </div>\r\n        </div>\r\n        <!-- / Layout wrapper -->\r\n\r\n        <script src=\"https://code.jquery.com/jquery-3.4.1.min.js\"></script>\r\n        <script src=\"https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.bundle.min.js\"></script>\r\n        <script src=\"../lib/easing/easing.min.js\"></script>\r\n        <script src=\"../lib/waypoints/waypoints.min.js\"></script>\r\n        <script src=\"../lib/counterup/counterup.min.js\"></script>\r\n        <script src=\"../lib/owlcarousel/owl.carousel.min.js\"></script>\r\n\r\n        <!-- Template Javascript -->\r\n        <script src=\"../js/main.js\"></script>\r\n\r\n        <!-- Core JS -->\r\n        <!-- build:js ../assets/vendor/js/core.js -->\r\n\r\n        <script src=\"../assets/vendor/libs/jquery/jquery.js\"></script>\r\n        <script src=\"../assets/vendor/libs/popper/popper.js\"></script>\r\n        <script src=\"../assets/vendor/js/bootstrap.js\"></script>\r\n        <script src=\"../assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.js\"></script>\r\n        <script src=\"../assets/vendor/js/menu.js\"></script>\r\n\r\n        <!-- endbuild -->\r\n\r\n        <!-- Vendors JS -->\r\n        <script src=\"../assets/vendor/libs/apex-charts/apexcharts.js\"></script>\r\n\r\n        <!-- Main JS -->\r\n        <script src=\"../assets/js/main.js\"></script>\r\n\r\n        <!-- Page JS -->\r\n        <script src=\"../assets/js/dashboards-analytics.js\"></script>\r\n\r\n        <!-- Place this tag in your head or just before your close body tag. -->\r\n        <script async defer src=\"https://buttons.github.io/buttons.js\"></script>\r\n    </body>\r\n</html>\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/web/WEB-INF/views/question/questiondetails.jsp b/web/WEB-INF/views/question/questiondetails.jsp
--- a/web/WEB-INF/views/question/questiondetails.jsp	(revision d6ad1445e1c07c5da0ab8951156084fe4a182d1f)
+++ b/web/WEB-INF/views/question/questiondetails.jsp	(date 1721252670161)
@@ -151,6 +151,8 @@
                             </form>
                             <hr class="my-5" />
 
+                            <a class="btn btn-primary" href="${pageContext.request.contextPath}/question">Back</a>
+
                         </div>
                         <!-- / Content -->
 
Index: database/database design.sql
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>-- Create the database\r\ncreate DATABASE `KMS-G6-SE1808`;\r\nUSE `KMS-G6-SE1808`;\r\n\r\ncreate table `role`\r\n(\r\n    id   int(1) primary key,\r\n    name varchar(7)\r\n);\r\n-- Create the 'user' table\r\nCREATE TABLE user\r\n(\r\n    id           INT AUTO_INCREMENT PRIMARY KEY,\r\n    name         VARCHAR(50),\r\n    email        VARCHAR(35) UNIQUE,\r\n    avt          VARCHAR(100) default 'assets/img/default_avt.jpg',\r\n    password     VARCHAR(60),\r\n    role         INT(1),\r\n    status       int(1),\r\n    date_created date         default (curdate()),\r\n\r\n    foreign key (role) references `role` (id)\r\n);\r\n\r\nCREATE TABLE contact\r\n(\r\n    email   VARCHAR(35),\r\n    name    VARCHAR(255),\r\n    subject VARCHAR(255),\r\n    message TEXT\r\n);\r\n\r\n-- Create the 'subject' table\r\nCREATE TABLE subject\r\n(\r\n    id                   INT AUTO_INCREMENT PRIMARY KEY,\r\n    code                 VARCHAR(7) UNIQUE,\r\n    name                 VARCHAR(255),\r\n    status               BIT DEFAULT 0,\r\n    exam_no_of_questions tinyint\r\n);\r\n\r\n-- Create the 'subject_in_charged' table\r\nCREATE TABLE subject_in_charged\r\n(\r\n    user_id    INT,\r\n    subject_id INT,\r\n    PRIMARY KEY (user_id, subject_id),\r\n    FOREIGN KEY (user_id) REFERENCES user (id),\r\n    FOREIGN KEY (subject_id) REFERENCES subject (id)\r\n);\r\n\r\n-- Create the 'class' table\r\nCREATE TABLE class\r\n(\r\n    id   INT AUTO_INCREMENT PRIMARY KEY,\r\n    code VARCHAR(40) UNIQUE\r\n);\r\n\r\n-- Create the 'group' table\r\nCREATE TABLE `group`\r\n(\r\n    id            INT AUTO_INCREMENT PRIMARY KEY,\r\n    class_id      INT,\r\n    subject_id    INT,\r\n    instructor_id INT,\r\n    FOREIGN KEY (class_id) REFERENCES class (id),\r\n    FOREIGN KEY (subject_id) REFERENCES subject (id),\r\n    FOREIGN KEY (instructor_id) REFERENCES user (id)\r\n);\r\n\r\n-- Create the 'student_group' table\r\nCREATE TABLE student_group\r\n(\r\n    student_id INT,\r\n    group_id   INT,\r\n    PRIMARY KEY (student_id, group_id),\r\n    FOREIGN KEY (student_id) REFERENCES user (id),\r\n    FOREIGN KEY (group_id) REFERENCES `group` (id)\r\n);\r\n\r\n-- Create the 'group_announcement' table\r\nCREATE TABLE group_announcement\r\n(\r\n    id           INT AUTO_INCREMENT PRIMARY KEY,\r\n    group_id     INT,\r\n    announcement TEXT,\r\n    FOREIGN KEY (group_id) REFERENCES `group` (id)\r\n);\r\n\r\n-- Create the 'flashcard_set' table\r\nCREATE TABLE flashcard_set\r\n(\r\n    id         INT AUTO_INCREMENT PRIMARY KEY,\r\n    name       VARCHAR(255),\r\n    subject_id INT,\r\n    created_by INT,\r\n    FOREIGN KEY (created_by) REFERENCES user (id),\r\n    FOREIGN KEY (subject_id) REFERENCES subject (id)\r\n);\r\n\r\n-- Create the 'flashcard_question' table\r\nCREATE TABLE flashcard_question\r\n(\r\n    id               INT AUTO_INCREMENT PRIMARY KEY,\r\n    term             text,\r\n    definition       text,\r\n    flashcard_set_id INT,\r\n    FOREIGN KEY (flashcard_set_id) REFERENCES flashcard_set (id)\r\n);\r\n\r\n-- Create the 'lesson' table\r\ncreate table lesson\r\n(\r\n    id         int auto_increment primary key,\r\n    name       varchar(100) unique not null,\r\n    `order`    int   not null,\r\n    subject_id int          not null,\r\n    status\t\tbit default 1,\r\n\r\n    foreign key (subject_id) references subject (id)\r\n);\r\n\r\ncreate table material\r\n(\r\n    id  int auto_increment primary key,\r\n    uri varchar(100)\r\n);\r\n\r\ncreate table material_lesson\r\n(\r\n    material_id int,\r\n    lesson_id   int,\r\n\r\n    primary key (material_id, lesson_id),\r\n    foreign key (material_id) references material (id),\r\n    foreign key (lesson_id) references lesson (id)\r\n);\r\n\r\ncreate table question\r\n(\r\n    id        int auto_increment primary key,\r\n    content   varchar(255) not null,\r\n    lesson_id int default null,\r\n    status    bit          not null,\r\n\r\n    foreign key (lesson_id) references lesson (id)\r\n);\r\n\r\ncreate table answer\r\n(\r\n    id          int auto_increment primary key,\r\n    content     varchar(255) not null,\r\n    is_correct  bit          not null,\r\n    question_id int          not null,\r\n\r\n    foreign key (question_id) references question (id)\r\n);\r\n\r\ncreate table test(\r\n\tid\t\t\t\tint primary key,\r\n    name\t\t\tvarchar(255),\r\n\tno_of_question \tsmallint\r\n);\r\n\r\ncreate table test_group(\r\n\ttest_id\t\tint,\r\n    group_id \tint,\r\n    \r\n    foreign key (test_id) references test(id),\r\n    foreign key (group_id) references `group`(id)\r\n);\r\n\r\ncreate table test_lesson(\r\n\ttest_id\t\tint,\r\n    lesson_id \tint,\r\n    \r\n    foreign key (test_id) references test(id),\r\n    foreign key (lesson_id) references `lesson`(id)\r\n);\r\n\r\ncreate table result\r\n(\r\n    id              int auto_increment primary key,\r\n    correct_answers int,\r\n    score           tinyint,\r\n    date_taken      date,\r\n    attempt         int,\r\n    user_id         int,\r\n    exam_subject_id int,\r\n    test_id \t\tint,\r\n\r\n    foreign key (user_id) references user (id),\r\n    foreign key (exam_subject_id) references subject (id),\r\n    foreign key (test_id) references test(id)\r\n);\r\n\r\ncreate table result_details\r\n(\r\n    id          int primary key auto_increment,\r\n    result_id   int,\r\n    question_id int,\r\n    is_scored\tbit,\r\n    content\t\tvarchar(255),\r\n\r\n    foreign key (result_id) references result(id)\r\n);\r\n\r\ncreate table result_answer_selected\r\n(\r\n    id                \tint auto_increment primary key,\r\n    result_details_id \tint,\r\n    answer_id         \tint,\r\n    content\t\t\t\tvarchar(100),\r\n    is_correct\t\t\tbit,\r\n    is_selected       \tbit,\r\n\r\n    foreign key (result_details_id) references result_details(id)\r\n);\r\n\r\ninsert into role(id, name)\r\nvalues (0, 'Admin'),\r\n       (1, 'Manager'),\r\n       (2, 'Teacher'),\r\n       (3, 'Student');\r\n\r\n-- Insert users\r\nINSERT INTO user (name, email, password, role, status)\r\nVALUES ('ThuyBT02', 'thuybt02@fpt.edu.vn', 'password', 2, 1),\r\n       ('KienNT', 'kiennt@fpt.edu.vn', 'password', 2, 1),\r\n       ('HungNM142', 'hungnm142@fpt.edu.vn', 'password', 2, 1),\r\n       ('LinhDTT43', 'linhdtt43@fpt.edu.vn', 'password', 2, 1),\r\n       ('Hoannn6', 'hoannn6@fpt.edu.vn', 'password', 2, 1),\r\n       ('Doan Binh An', 'ExampleEmail@fpt.edu.vn', 'password', 3, 1),\r\n       ('admin', 'admin1@email.com', 'a', 0, 1),\r\n       ('manager', 'manager1@email.com', 'a', 1, 1),\r\n       ('teacher', 'teacher1@email.com', 'a', 2, 1),\r\n       ('student', 'student1@email.com', 'a', 3, 1),\r\n       ('Duong Quan Hao', 'ngunguoi123ys@gmail.com', '$2a$12$lL4NJHo5/Ng0cUmAj3Iig.lOqejnHA4uVnU9A82rDIVq9Lbqxj9m6',\r\n\t\t\t0, 1);\r\n\t\r\nupdate user set avt = 'assets/img/annandmaryann.png' where email = 'ngunguoi123ys@gmail.com';\r\n\r\n-- Insert subjects\r\nINSERT INTO subject (code, name, status, exam_no_of_questions)\r\nVALUES ('PRN212', 'Basis Cross-Platform Application Programming With .NET', 1, 50),\r\n       ('SWP391', 'Application development project', 1, 50),\r\n       ('SWR302', 'Software Requirement', 1, 50),\r\n       ('SWT301', 'Software Testing', 1, 50),\r\n       ('FER202', 'Front-End web development with React', 1, 50);\r\n\r\n-- Insert classes\r\nINSERT INTO class (code)\r\nVALUES ('SE1808-NET'),\r\n       ('SE1840-KS'),\r\n       ('SE1827-NJ');\r\n\r\n-- Insert groups\r\nINSERT INTO `group` (class_id, subject_id, instructor_id)\r\nVALUES ((SELECT id FROM class WHERE code = 'SE1808-NET'), (SELECT id FROM subject WHERE code = 'PRN212'),\r\n        (SELECT id FROM user WHERE email = 'thuybt02@fpt.edu.vn')),\r\n       ((SELECT id FROM class WHERE code = 'SE1808-NET'), (SELECT id FROM subject WHERE code = 'SWP391'),\r\n        (SELECT id FROM user WHERE email = 'kiennt@fpt.edu.vn')),\r\n       ((SELECT id FROM class WHERE code = 'SE1840-KS'), (SELECT id FROM subject WHERE code = 'SWR302'),\r\n        (SELECT id FROM user WHERE email = 'hungnm142@fpt.edu.vn')),\r\n       ((SELECT id FROM class WHERE code = 'SE1840-KS'), (SELECT id FROM subject WHERE code = 'SWT301'),\r\n        (SELECT id FROM user WHERE email = 'linhdtt43@fpt.edu.vn')),\r\n       ((SELECT id FROM class WHERE code = 'SE1827-NJ'), (SELECT id FROM subject WHERE code = 'FER202'),\r\n        (SELECT id FROM user WHERE email = 'hoannn6@fpt.edu.vn'));\r\n\r\n-- Insert student groups without duplicates\r\nINSERT INTO student_group (student_id, group_id)\r\nVALUES ((SELECT id FROM user WHERE email = 'ExampleEmail@fpt.edu.vn'), (SELECT id\r\n                                                                        FROM `group`\r\n                                                                        WHERE class_id = (SELECT id FROM class WHERE code = 'SE1827-NJ')\r\n                                                                          AND subject_id = (SELECT id FROM subject WHERE code = 'FER202'))),\r\n       ((SELECT id FROM user WHERE email = 'ExampleEmail@fpt.edu.vn'), (SELECT id\r\n                                                                        FROM `group`\r\n                                                                        WHERE class_id = (SELECT id FROM class WHERE code = 'SE1808-NET')\r\n                                                                          AND subject_id = (SELECT id FROM subject WHERE code = 'PRN212'))),\r\n       ((SELECT id FROM user WHERE email = 'ExampleEmail@fpt.edu.vn'), (SELECT id\r\n                                                                        FROM `group`\r\n                                                                        WHERE class_id = (SELECT id FROM class WHERE code = 'SE1808-NET')\r\n                                                                          AND subject_id = (SELECT id FROM subject WHERE code = 'SWP391'))),\r\n       ((SELECT id FROM user WHERE email = 'ExampleEmail@fpt.edu.vn'), (SELECT id\r\n                                                                        FROM `group`\r\n                                                                        WHERE class_id = (SELECT id FROM class WHERE code = 'SE1840-KS')\r\n                                                                          AND subject_id = (SELECT id FROM subject WHERE code = 'SWR302'))),\r\n       ((SELECT id FROM user WHERE email = 'ExampleEmail@fpt.edu.vn'), (SELECT id\r\n                                                                        FROM `group`\r\n                                                                        WHERE class_id = (SELECT id FROM class WHERE code = 'SE1840-KS')\r\n                                                                          AND subject_id = (SELECT id FROM subject WHERE code = 'SWT301')));\r\n\r\n-- Insert subject in charged\r\nINSERT INTO subject_in_charged (user_id, subject_id)\r\nVALUES ((SELECT id FROM user WHERE email = 'thuybt02@fpt.edu.vn'), (SELECT id FROM subject WHERE code = 'PRN212')),\r\n       ((SELECT id FROM user WHERE email = 'kiennt@fpt.edu.vn'), (SELECT id FROM subject WHERE code = 'SWP391')),\r\n       ((SELECT id FROM user WHERE email = 'hungnm142@fpt.edu.vn'), (SELECT id FROM subject WHERE code = 'SWR302')),\r\n       ((SELECT id FROM user WHERE email = 'linhdtt43@fpt.edu.vn'), (SELECT id FROM subject WHERE code = 'SWT301')),\r\n       ((SELECT id FROM user WHERE email = 'hoannn6@fpt.edu.vn'), (SELECT id FROM subject WHERE code = 'FER202'));\r\n\r\ninsert into lesson(name, `order`, subject_id)\r\nvalues ('Introduction to .NET Platform - Visual Studio.NET', 1, (select id from subject where code = 'PRN212')),\r\n       ('C# Programming', 2, (select id from subject where code = 'PRN212')),\r\n       ('Object-Oriented Programming', 3, (select id from subject where code = 'PRN212')),\r\n       ('Collections and Generics', 4, (select id from subject where code = 'PRN212')),\r\n       ('Design Pattern in .NET', 5, (select id from subject where code = 'PRN212')),\r\n       ('Delegate ,Event_LINQ', 6, (select id from subject where code = 'PRN212')),\r\n       ('Building Windows Presentation Foundation (WPF) Application', 7,\r\n        (select id from subject where code = 'PRN212')),\r\n       ('Working with Databases Using Entity Framework Core', 8, (select id from subject where code = 'PRN212')),\r\n       ('Working with Files and System.IO', 9, (select id from subject where code = 'PRN212')),\r\n       ('Working with XML and JSON Serializing', 10, (select id from subject where code = 'PRN212')),\r\n       ('Concurrency Programming', 11, (select id from subject where code = 'PRN212'));\r\n\r\nINSERT INTO question(content, lesson_id, status)\r\nVALUES ('What is the difference between `String` and `string` in C#?',\r\n        (select id from lesson where name = 'Introduction to .NET Platform - Visual Studio.NET'), 1),\r\n       ('Can ASP.NET Core work with the .NET Framework?',\r\n        (select id from lesson where name = 'Introduction to .NET Platform - Visual Studio.NET'), 1),\r\n       ('What are the components of MVC (Model-View-Controller)?',\r\n        (select id from lesson where name = 'Introduction to .NET Platform - Visual Studio.NET'), 1),\r\n       ('What is inheritance in .NET?',\r\n        (select id from lesson where name = 'Introduction to .NET Platform - Visual Studio.NET'), 1),\r\n       ('What’s the difference between a class and an object?',\r\n        (select id from lesson where name = 'Introduction to .NET Platform - Visual Studio.NET'), 1),\r\n       ('What is managed code in .NET?',\r\n        (select id from lesson where name = 'Introduction to .NET Platform - Visual Studio.NET'), 1);\r\n\r\nINSERT INTO answer(content, is_correct, question_id)\r\nVALUES ('`String` is an alias for `System.String`.', 1,\r\n        (select id from question where content = 'What is the difference between `String` and `string` in C#?')),\r\n       ('`string` is an alias for `System.String`.', 0,\r\n        (select id from question where content = 'What is the difference between `String` and `string` in C#?')),\r\n       ('There is no difference; they are interchangeable.', 0,\r\n        (select id from question where content = 'What is the difference between `String` and `string` in C#?')),\r\n       ('`String` is a value type, and `string` is a reference type.', 0,\r\n        (select id from question where content = 'What is the difference between `String` and `string` in C#?')),\r\n\r\n       ('No, ASP.NET Core only works with .NET Core.', 0,\r\n        (select id from question where content = 'Can ASP.NET Core work with the .NET Framework?')),\r\n       ('Yes, ASP.NET Core can work with both .NET Core and .NET Framework.', 1,\r\n        (select id from question where content = 'Can ASP.NET Core work with the .NET Framework?')),\r\n       ('ASP.NET Core is independent of any framework.', 0,\r\n        (select id from question where content = 'Can ASP.NET Core work with the .NET Framework?')),\r\n       ('ASP.NET Core is deprecated.', 0,\r\n        (select id from question where content = 'Can ASP.NET Core work with the .NET Framework?')),\r\n\r\n       ('Model, View, and Controller', 1,\r\n        (select id from question where content = 'What are the components of MVC (Model-View-Controller)?')),\r\n       ('Model, ViewModel, and Controller', 0,\r\n        (select id from question where content = 'What are the components of MVC (Model-View-Controller)?')),\r\n       ('Model, View, and Service', 0,\r\n        (select id from question where content = 'What are the components of MVC (Model-View-Controller)?')),\r\n       ('Model, View, and Middleware', 0,\r\n        (select id from question where content = 'What are the components of MVC (Model-View-Controller)?')),\r\n\r\n       ('It allows a class to inherit properties from an interface.', 0,\r\n        (select id from question where content = 'What is inheritance in .NET?')),\r\n       ('It promotes code reusability by allowing a class to inherit properties and behaviors from another class.', 1,\r\n        (select id from question where content = 'What is inheritance in .NET?')),\r\n       ('It is a way to create new classes from existing classes.', 0,\r\n        (select id from question where content = 'What is inheritance in .NET?')),\r\n       ('It is used to implement multiple inheritance.', 0,\r\n        (select id from question where content = 'What is inheritance in .NET?')),\r\n\r\n       ('A class is an instance of an object.', 0,\r\n        (select id from question where content = 'What’s the difference between a class and an object?')),\r\n       ('A class is a blueprint for creating objects.', 1,\r\n        (select id from question where content = 'What’s the difference between a class and an object?')),\r\n       ('An object is a blueprint for creating classes.', 0,\r\n        (select id from question where content = 'What’s the difference between a class and an object?')),\r\n       ('There is no difference; they are synonyms.', 0,\r\n        (select id from question where content = 'What’s the difference between a class and an object?')),\r\n\r\n       ('Code that runs outside the .NET runtime environment.', 0,\r\n        (select id from question where content = 'What is managed code in .NET?')),\r\n       ('Code that directly interacts with the operating system.', 0,\r\n        (select id from question where content = 'What is managed code in .NET?')),\r\n       ('Code that runs within the .NET runtime environment.', 1,\r\n        (select id from question where content = 'What is managed code in .NET?')),\r\n       ('Code that is written in unmanaged languages.', 0,\r\n        (select id from question where content = 'What is managed code in .NET?'));\r\n\r\ninsert into material(uri)\r\nvalues ('assets\\\\material\\\\Chapter 01 - Introduction to .NET Platform - Visual Studio.NET.pptx'),\r\n       ('assets\\\\material\\\\Chapter 02 - C# Programming.pptx');\r\n\r\ninsert into material_lesson (material_id, lesson_id)\r\nvalues ((select id\r\n         from material\r\n         where uri = 'assets\\\\material\\\\Chapter 01 - Introduction to .NET Platform - Visual Studio.NET.pptx'),\r\n        (SELECT id FROM lesson WHERE name = 'Introduction to .NET Platform - Visual Studio.NET')),\r\n\r\n       ((select id from material where uri = 'assets\\\\material\\\\Chapter 02 - C# Programming.pptx'),\r\n        (SELECT id FROM lesson WHERE name = 'C# Programming'));\r\n\r\nupdate user\r\nset avt = '../assets/img/admin1.png'\r\nwhere email = 'admin1@email.com';\r\n\r\n-- Insert sample flashcard sets with created_by column\r\nINSERT INTO flashcard_set (name, subject_id, created_by)\r\nVALUES ('PRN: OOP Basics', (SELECT id FROM subject WHERE code = 'PRN212'),\r\n        (SELECT id FROM user WHERE email = 'admin1@email.com')),\r\n       ('SWR: Agile Principles', (SELECT id FROM subject WHERE code = 'SWR302'),\r\n        (SELECT id FROM user WHERE email = 'admin1@email.com'));\r\n\r\n-- Insert sample flashcard questions\r\nINSERT INTO flashcard_question (term, definition, flashcard_set_id)\r\nVALUES ('Inheritance', 'A mechanism where a new class can inherit properties and methods of an existing class.',\r\n        (SELECT id FROM flashcard_set WHERE name = 'PRN: OOP Basics')),\r\n       ('Encapsulation', 'A principle of wrapping data and code as a single unit.',\r\n        (SELECT id FROM flashcard_set WHERE name = 'PRN: OOP Basics')),\r\n       ('Scrum', 'An agile process framework for managing complex knowledge work.',\r\n        (SELECT id FROM flashcard_set WHERE name = 'SWR: Agile Principles')),\r\n       ('Kanban',\r\n        'A method for managing the creation of products with an emphasis on continual delivery while not overburdening the development team.',\r\n        (SELECT id FROM flashcard_set WHERE name = 'SWR: Agile Principles'));\r\n\r\nselect *\r\nfrom flashcard_question;\r\nselect *\r\nfrom subject;
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/database/database design.sql b/database/database design.sql
--- a/database/database design.sql	(revision d6ad1445e1c07c5da0ab8951156084fe4a182d1f)
+++ b/database/database design.sql	(date 1721252670145)
@@ -158,7 +158,7 @@
 );
 
 create table test(
-	id				int primary key,
+	id				int primary key auto_increment,
     name			varchar(255),
 	no_of_question 	smallint
 );
@@ -183,7 +183,7 @@
 (
     id              int auto_increment primary key,
     correct_answers int,
-    score           tinyint,
+    score           float,
     date_taken      date,
     attempt         int,
     user_id         int,
@@ -195,27 +195,25 @@
     foreign key (test_id) references test(id)
 );
 
-create table result_details
+create table result_question
 (
     id          int primary key auto_increment,
     result_id   int,
-    question_id int,
     is_scored	bit,
     content		varchar(255),
 
     foreign key (result_id) references result(id)
 );
 
-create table result_answer_selected
+create table result_answer
 (
     id                	int auto_increment primary key,
-    result_details_id 	int,
-    answer_id         	int,
+    result_question_id 	int,
     content				varchar(100),
     is_correct			bit,
     is_selected       	bit,
 
-    foreign key (result_details_id) references result_details(id)
+    foreign key (result_question_id) references result_question(id)
 );
 
 insert into role(id, name)
@@ -383,16 +381,16 @@
         (select id from question where content = 'What is managed code in .NET?'));
 
 insert into material(uri)
-values ('assets\\material\\Chapter 01 - Introduction to .NET Platform - Visual Studio.NET.pptx'),
-       ('assets\\material\\Chapter 02 - C# Programming.pptx');
+values ('assets/material/Chapter 01 - Introduction to .NET Platform - Visual Studio.NET.pptx'),
+       ('assets/material/Chapter 02 - C# Programming.pptx');
 
 insert into material_lesson (material_id, lesson_id)
 values ((select id
          from material
-         where uri = 'assets\\material\\Chapter 01 - Introduction to .NET Platform - Visual Studio.NET.pptx'),
+         where uri = 'assets/material/Chapter 01 - Introduction to .NET Platform - Visual Studio.NET.pptx'),
         (SELECT id FROM lesson WHERE name = 'Introduction to .NET Platform - Visual Studio.NET')),
 
-       ((select id from material where uri = 'assets\\material\\Chapter 02 - C# Programming.pptx'),
+       ((select id from material where uri = 'assets/material/Chapter 02 - C# Programming.pptx'),
         (SELECT id FROM lesson WHERE name = 'C# Programming'));
 
 update user
Index: web/verificate-email.jsp
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><%--\r\n  Created by IntelliJ IDEA.\r\n  User: PC\r\n  Date: 04-Jun-24\r\n  Time: 12:12 PM\r\n  To change this template use File | Settings | File Templates.\r\n--%>\r\n<%@ page language=\"java\" contentType=\"text/html; charset=UTF-8\" pageEncoding=\"UTF-8\" %>\r\n<%@ taglib uri=\"http://java.sun.com/jsp/jstl/core\" prefix=\"c\" %>\r\n<!-- This taglib is not used in this file -->\r\n<html>\r\n<head>\r\n    <meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\">\r\n    <title>Verify your email</title>\r\n    <link rel=\"stylesheet\" href=\"https://unpkg.com/bootstrap@5.3.3/dist/css/bootstrap.min.css\">\r\n    <link rel=\"stylesheet\"\r\n          href=\"https://unpkg.com/bs-brain@2.0.4/components/registrations/registration-7/assets/css/registration-7.css\">\r\n\r\n    <!-- Favicon -->\r\n    <link href=\"img/favicon.ico\" rel=\"icon\">\r\n\r\n    <!-- Google Web Fonts -->\r\n    <link rel=\"preconnect\" href=\"https://fonts.gstatic.com\">\r\n    <link href=\"https://fonts.googleapis.com/css2?family=Jost:wght@500;600;700&family=Open+Sans:wght@400;600&display=swap\"\r\n          rel=\"stylesheet\">\r\n\r\n    <!-- Font Awesome -->\r\n    <link href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css\" rel=\"stylesheet\">\r\n\r\n    <!-- Libraries Stylesheet -->\r\n    <link href=\"lib/owlcarousel/assets/owl.carousel.min.css\" rel=\"stylesheet\">\r\n\r\n    <!-- Customized Bootstrap Stylesheet -->\r\n    <link href=\"css/style.css\" rel=\"stylesheet\">\r\n</head>\r\n<body>\r\n<jsp:include page=\"header1.jsp\"/>\r\n<section class=\"bg-light p-3 p-md-4 p-xl-5\">\r\n    <div class=\"container\">\r\n        <div class=\"row justify-content-center\">\r\n            <div class=\"col-12 col-md-9 col-lg-7 col-xl-6 col-xxl-5\">\r\n                <div class=\"card border border-light-subtle rounded-4\">\r\n                    <div class=\"card-body p-3 p-md-4 p-xl-5\">\r\n                        <div class=\"row\">\r\n                            <div class=\"col-12\">\r\n                                <div class=\"mb-5\">\r\n                                    <div class=\"text-center mb-4\">\r\n                                        <a href=\"home\" class=\"navbar-brand ml-lg-3\">\r\n                                            <h1 class=\"m-0 text-uppercase text-primary\"><i\r\n                                                    class=\"fa fa-book-reader mr-3\"></i>KRS</h1>\r\n                                        </a>\r\n                                    </div>\r\n                                    <h2 class=\"h4 text-center\">Email Verification</h2>\r\n                                    <h3 class=\"fs-6 fw-normal text-secondary text-center m-0\">Please enter the code sent\r\n                                        to your email. If you do not see the code, check your spam</h3>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                        <!-- Verificaiton code -->\r\n                        <form action=\"verify-email\" method=\"post\">\r\n                            <div class=\"row gy-3 overflow-hidden\">\r\n                                <div class=\"col-12\">\r\n                                    <div class=\"form-floating mb-3\">\r\n                                        <input type=\"password\" class=\"form-control\" name=\"verifycode\" id=\"verifycode\"\r\n                                               placeholder=\"Verificaiton code\" required>\r\n                                        <label for=\"verifycode\" class=\"form-label\">Verificaiton code</label>\r\n                                    </div>\r\n                                    <div class=\"col-12\">\r\n                                        <div class=\"d-grid gap-2\">\r\n                                            <span class=\"text-danger font-italic\">${sessionScope.message}</span>\r\n\r\n                                            <button class=\"btn bsb-btn-md btn-primary\" type=\"submit\">Verify</button>\r\n                                            <button class=\"btn bsb-btn-md btn-secondary\" type=\"button\"\r\n                                                    onclick=\"window.history.back();\">Go Back\r\n                                            </button>\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        </form>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</section>\r\n<jsp:include page=\"footer.jsp\"/>\r\n</body>\r\n</html>\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/web/verificate-email.jsp b/web/verificate-email.jsp
--- a/web/verificate-email.jsp	(revision d6ad1445e1c07c5da0ab8951156084fe4a182d1f)
+++ b/web/verificate-email.jsp	(date 1721252670209)
@@ -34,7 +34,7 @@
     <link href="css/style.css" rel="stylesheet">
 </head>
 <body>
-<jsp:include page="header1.jsp"/>
+<jsp:include page="header.jsp"/>
 <section class="bg-light p-3 p-md-4 p-xl-5">
     <div class="container">
         <div class="row justify-content-center">
Index: web/WEB-INF/views/question/newquestion.jsp
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><%@page isELIgnored=\"false\" %>\r\n<%@taglib prefix=\"c\" uri=\"http://java.sun.com/jsp/jstl/core\" %>\r\n<%@page contentType=\"text/html\" pageEncoding=\"UTF-8\"%>\r\n<html\r\n    lang=\"en\"\r\n    class=\"light-style layout-menu-fixed layout-compact\"\r\n    dir=\"ltr\"\r\n    data-theme=\"theme-default\"\r\n    data-assets-path=\"../assets/\"\r\n    data-template=\"vertical-menu-template-free\">\r\n    <head>\r\n        <meta charset=\"utf-8\" />\r\n        <meta\r\n            name=\"viewport\"\r\n            content=\"width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0\" />\r\n\r\n        <title>New Question</title>\r\n\r\n        <meta name=\"description\" content=\"\" />\r\n\r\n        <!-- Favicon -->\r\n        <link rel=\"icon\" type=\"image/x-icon\" href=\"../assets/img/favicon/favicon.ico\" />\r\n\r\n        <!-- Fonts -->\r\n        <link rel=\"preconnect\" href=\"https://fonts.googleapis.com\" />\r\n        <link rel=\"preconnect\" href=\"https://fonts.gstatic.com\" crossorigin />\r\n        <link\r\n            href=\"https://fonts.googleapis.com/css2?family=Public+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&display=swap\"\r\n            rel=\"stylesheet\" />\r\n\r\n        <link rel=\"stylesheet\" href=\"../assets/vendor/fonts/boxicons.css\" />\r\n\r\n        <!-- Core CSS -->\r\n        <link rel=\"stylesheet\" href=\"../assets/vendor/css/core.css\" class=\"template-customizer-core-css\" />\r\n        <link rel=\"stylesheet\" href=\"../assets/vendor/css/theme-default.css\" class=\"template-customizer-theme-css\" />\r\n        <link rel=\"stylesheet\" href=\"../assets/css/demo.css\" />\r\n\r\n        <!-- Vendors CSS -->\r\n        <link rel=\"stylesheet\" href=\"../assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.css\" />\r\n        <link rel=\"stylesheet\" href=\"../assets/vendor/libs/apex-charts/apex-charts.css\" />\r\n\r\n        <!-- Page CSS -->\r\n\r\n        <!-- Favicon -->\r\n        <link href=\"../img/favicon.ico\" rel=\"icon\">\r\n\r\n        <!-- Google Web Fonts -->\r\n        <link rel=\"preconnect\" href=\"https://fonts.gstatic.com\">\r\n        <link href=\"https://fonts.googleapis.com/css2?family=Jost:wght@500;600;700&family=Open+Sans:wght@400;600&display=swap\" rel=\"stylesheet\"> \r\n\r\n        <!-- Font Awesome -->\r\n        <link href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css\" rel=\"stylesheet\">\r\n\r\n        <!-- Libraries Stylesheet -->\r\n        <link href=\"../lib/owlcarousel/assets/owl.carousel.min.css\" rel=\"stylesheet\">\r\n\r\n        <!-- Customized Bootstrap Stylesheet -->\r\n        <link href=\"../css/style.css\" rel=\"stylesheet\">\r\n\r\n        <!-- Helpers -->\r\n        <script src=\"../assets/vendor/js/helpers.js\"></script>\r\n        <!--! Template customizer & Theme config files MUST be included after core stylesheets and helpers.js in the <head> section -->\r\n        <!--? Config:  Mandatory theme config file contain global vars & default theme options, Set your preferred theme option in this file.  -->\r\n        <script src=\"../assets/js/config.js\"></script>\r\n        <script>\r\n            function setActiveTab(currentPage) {\r\n                if (currentPage === 'enterData') {\r\n                    document.getElementById(\"navs-pills-enter-data\").className = \"tab-pane fade show active\";\r\n                    document.getElementById(\"buttonEnterData\").ariaSelected = true;\r\n                    document.getElementById(\"buttonEnterData\").className = \"nav-link active\";\r\n                    document.getElementById(\"buttonImportFile\").className = \"nav-link\";\r\n                    document.getElementById(\"buttonImportFile\").ariaSelected = false;\r\n                } else {\r\n                    document.getElementById(\"navs-pills-import-file\").className = \"tab-pane fade show active\";\r\n                    document.getElementById(\"buttonImportFile\").ariaSelected = true;\r\n                    document.getElementById(\"buttonImportFile\").className = \"nav-link active\";\r\n                    document.getElementById(\"buttonEnterData\").className = \"nav-link\";\r\n                    document.getElementById(\"buttonEnterData\").ariaSelected = false;\r\n                }\r\n            }\r\n            function getActiveTab() {\r\n                if (document.getElementById(\"buttonImportFile\").className === 'nav-link active') {\r\n                    return \"inportFile\";\r\n                } else {\r\n                    return \"enterData\";\r\n                }\r\n            }\r\n            function setActiveTabForRefresh() {\r\n                document.getElementById('currentPage').value = getActiveTab();\r\n            }\r\n        </script>\r\n\r\n    </head>\r\n\r\n    <body onload=\"setActiveTab('${requestScope.currentPage}');\">\r\n        <!-- Layout wrapper -->\r\n        <div class=\"layout-wrapper layout-content-navbar\">\r\n            <div class=\"layout-container\">\r\n                <!-- Menu -->\r\n\r\n                <jsp:include page=\"/WEB-INF/common/sider.jsp\"/>\r\n                <!-- / Menu -->\r\n\r\n                <!-- Layout container -->\r\n                <div class=\"layout-page\">\r\n\r\n                    <!-- Content wrapper -->\r\n                    <div class=\"content-wrapper\">\r\n                        <!-- Content -->\r\n                        <jsp:include page=\"/WEB-INF/common/header.jsp\"/>\r\n\r\n                        <div class=\"container-xxl flex-grow-1 container-p-y\">\r\n\r\n\r\n                            <h4 class=\"py-3 mb-4\"><span class=\"text-muted fw-light\">Question /</span> New question</h4>\r\n\r\n                            <form id=\"newQuestionForm\" method=\"post\" action=\"${pageContext.request.contextPath}/question/new\" enctype=\"multipart/form-data\">\r\n                                <div style=\"width: 100%;\">\r\n                                    <input type=\"hidden\" name=\"action\" id=\"action\"/>\r\n                                    <input type=\"hidden\" name=\"deletedId\" id=\"deletedId\"/>\r\n                                    <input type=\"hidden\" name=\"currentPage\" id=\"currentPage\"/>\r\n                                    <div class=\"row\" style=\"width: 100%\">\r\n                                        <div class=\"input-group mr-3 mb-4\">\r\n                                            <label for=\"subjectselect\">Subject: </label>\r\n                                            <select style=\"height: 38px;\" name=\"subjectId\" id=\"subjectselect\" class=\"mr-3 ml-3\" \r\n                                                    onchange=\"document.getElementById('action').value = 'changeSubjectAndLesson';\r\n                                                            setActiveTabForRefresh();\r\n                                                            document.getElementById('newQuestionForm').submit();\"\r\n                                                    onmousedown=\"if (this.options.length > 5) {\r\n                                                                this.size = 5;\r\n                                                                document.getElementById('subjectselect').style.height = '115px';\r\n                                                            }\"  \r\n                                                    onblur=\"this.size = 0;\r\n                                                            document.getElementById('subjectselect').style.height = '38px';\">\r\n                                                <c:if test=\"${(requestScope.subject == null)}\">\r\n                                                    <option selected>All subjects</option>\r\n                                                </c:if>\r\n                                                <c:if test=\"${(requestScope.subject != null)}\">\r\n                                                    <option>All subjects</option>\r\n                                                </c:if>\r\n                                                <c:forEach items=\"${requestScope.subjectList}\" var=\"subject\">\r\n                                                    <c:if test=\"${subject.id == requestScope.subject.id}\">\r\n                                                        <option value=\"${subject.id}\" selected>${subject.code}</option>\r\n                                                    </c:if>\r\n                                                    <c:if test=\"${subject.id != requestScope.subject.id}\">\r\n                                                        <option value=\"${subject.id}\">${subject.code}</option>\r\n                                                    </c:if>\r\n                                                </c:forEach>\r\n                                            </select>\r\n                                            <label for=\"lessonSelect\">Lesson: </label>\r\n                                            <select style=\"height: 38px;\" name=\"lessonId\" id=\"lessonSelect\" class=\"mr-3 ml-3\" \r\n                                                    onchange=\"document.getElementById('action').value = 'changeSubjectAndLesson';\r\n                                                            setActiveTabForRefresh();\r\n                                                            document.getElementById('newQuestionForm').submit();\"\r\n                                                    onmousedown=\"if (this.options.length > 5) {\r\n                                                                this.size = 5;\r\n                                                                document.getElementById('lessonSelect').style.height = '115px';\r\n                                                            }\"  \r\n                                                    onblur=\"this.size = 0;\r\n                                                            document.getElementById('lessonSelect').style.height = '38px';\">\r\n                                                <c:if test=\"${(requestScope.lesson == null)}\">\r\n                                                    <option selected>All lessons</option>\r\n                                                </c:if>\r\n                                                <c:if test=\"${(requestScope.lesson != null)}\">\r\n                                                    <option>All lessons</option>\r\n                                                </c:if>\r\n                                                <c:forEach items=\"${requestScope.lessonList}\" var=\"lesson\">\r\n                                                    <c:if test=\"${lesson.id == requestScope.lesson.id}\">\r\n                                                        <option value=\"${lesson.id}\" selected>${lesson.name}</option>\r\n                                                    </c:if>\r\n                                                    <c:if test=\"${lesson.id != requestScope.lesson.id}\">\r\n                                                        <option value=\"${lesson.id}\">${lesson.name}</option>\r\n                                                    </c:if>\r\n                                                </c:forEach>\r\n                                            </select>\r\n                                            <c:if test=\"${requestScope.lessonErr != null}\">\r\n                                                <h5 style=\"color: red;\">${requestScope.lessonErr}</h5>\r\n                                            </c:if>\r\n                                        </div>\r\n                                        <div class=\"row\">\r\n                                            <div class=\"nav-align-top mb-4\">\r\n                                                <ul class=\"nav nav-pills mb-3\" role=\"tablist\">\r\n                                                    <li class=\"nav-item\">\r\n                                                        <button\r\n                                                            type=\"button\"\r\n                                                            id=\"buttonEnterData\"\r\n                                                            role=\"tab\"\r\n                                                            data-bs-toggle=\"tab\"\r\n                                                            data-bs-target=\"#navs-pills-enter-data\"\r\n                                                            aria-controls=\"navs-pills-enter-data\">\r\n                                                            Enter question data\r\n                                                        </button>\r\n                                                    </li>\r\n                                                    <li class=\"nav-item\">\r\n                                                        <button\r\n                                                            type=\"button\"\r\n                                                            id=\"buttonImportFile\"\r\n                                                            role=\"tab\"\r\n                                                            data-bs-toggle=\"tab\"\r\n                                                            data-bs-target=\"#navs-pills-import-file\"\r\n                                                            aria-controls=\"navs-pills-import-file\">\r\n                                                            Import with .xls file\r\n                                                        </button>\r\n                                                    </li>\r\n                                                </ul>\r\n                                                <div class=\"tab-content\" style=\"width: 100%;\">\r\n                                                    <div class=\"tab-pane fade\" id=\"navs-pills-enter-data\" role=\"tabpanel\">\r\n                                                        <div class=\"col-xxl\">\r\n                                                            <div class=\"card mb-4\">\r\n                                                                <div class=\"card-header d-flex align-items-center justify-content-between mb-3\">\r\n                                                                    <small class=\"text-muted float-end\">Input question and answers content</small>\r\n                                                                </div>\r\n                                                                <div class=\"card-body\">\r\n                                                                    <div class=\"row mb-3\">\r\n                                                                        <label class=\"col-sm-2 col-form-label\" for=\"basic-icon-default-fullname2\">Question</label>\r\n                                                                        <div class=\"col-sm-10\">\r\n                                                                            <textarea name=\"question\" id=\"basic-icon-default-fullname2\"\r\n                                                                                      class=\"form-control border-top-0 border-right-0 border-left-0 p-0\" \r\n                                                                                      rows=\"5\" placeholder=\"Question content\">${requestScope.question.content}</textarea>\r\n                                                                        </div>\r\n                                                                    </div>\r\n                                                                    <c:if test=\"${requestScope.questionErr != null}\">\r\n                                                                        <div class=\"row mb-3\">\r\n                                                                            <div class=\"col-sm-2\"></div>\r\n                                                                            <div class=\"col-sm-10\">\r\n                                                                                <h5 style=\"color: red;\">${requestScope.questionErr}</h5>\r\n                                                                            </div>\r\n                                                                        </div>\r\n                                                                    </c:if>\r\n                                                                    <c:if test=\"${requestScope.answerErr != null}\">\r\n                                                                        <div class=\"row mb-3\">\r\n                                                                            <div class=\"col-sm-2\"></div>\r\n                                                                            <div class=\"col-sm-10\">\r\n                                                                                <h5 style=\"color: red;\">${requestScope.answerErr}</h5>\r\n                                                                            </div>\r\n                                                                        </div>\r\n                                                                    </c:if>\r\n                                                                    <c:forEach items=\"${requestScope.answerList}\" var=\"answer\">\r\n                                                                        <div class=\"row mb-3\">\r\n                                                                            <label class=\"col-sm-2 col-form-label\" for=\"basic-icon-default-fullname\">Answer</label>\r\n\r\n                                                                            <div class=\"col-sm-9\">\r\n                                                                                <div class=\"input-group\">\r\n\r\n                                                                                    <c:if test=\"${answer.isCorrect}\">\r\n                                                                                        <span style=\"height: 38px; width: 38px;\" class=\"input-group-text\"></span>\r\n                                                                                        <input\r\n                                                                                            class=\"form-check-input mt-0 ml-2\"\r\n                                                                                            type=\"checkbox\" style=\"align-self: center; \"\r\n                                                                                            name=\"${answer.id}isCorrect\"\r\n                                                                                            checked/>\r\n                                                                                    </c:if>\r\n                                                                                    <c:if test=\"${!answer.isCorrect}\">\r\n                                                                                        <span style=\"height: 38px; width: 38px;\" class=\"input-group-text\"></span>\r\n                                                                                        <input\r\n                                                                                            class=\"form-check-input mt-0 ml-2\"\r\n                                                                                            name=\"${answer.id}isCorrect\"\r\n                                                                                            type=\"checkbox\" style=\"align-self: center; \"/>\r\n                                                                                    </c:if>\r\n\r\n                                                                                    <input type=\"text\" class=\"form-control\" id=\"basic-icon-default-fullname\"\r\n                                                                                           name=\"${answer.id}\"\r\n                                                                                           value=\"${answer.content}\"/>\r\n                                                                                </div>\r\n                                                                            </div>\r\n                                                                            <c:if test=\"${requestScope.answerList.size() > 2}\">\r\n                                                                                <div class=\"col-sm-1\">\r\n                                                                                    <button style=\"height: 38px; width: 38px;\" class=\"btn btn-icon\"\r\n                                                                                            type=\"submit\"\r\n                                                                                            onclick=\"document.getElementById('action').value = 'deleteAnswer';\r\n                                                                                                    document.getElementById('deletedId').value = ${answer.id};\">\r\n                                                                                        <i style=\"color: red;\" class=\"bx bx-trash\"></i>\r\n                                                                                    </button>\r\n                                                                                </div>\r\n                                                                            </c:if>\r\n                                                                        </div>\r\n                                                                    </c:forEach>\r\n                                                                    <div class=\"row mb-3\">\r\n                                                                        <div class=\"col-sm-2\"></div>\r\n                                                                        <div class=\"col-sm-10\">\r\n                                                                            <button type=\"submit\" style=\"height: 38px; width: 38px;\" \r\n                                                                                    class=\"btn btn-icon btn-primary\"\r\n                                                                                    onclick=\"document.getElementById('action').value = 'addAnswer';\">\r\n                                                                                <i class=\"bx bx-plus\"></i>\r\n                                                                            </button>\r\n                                                                        </div>\r\n                                                                    </div>\r\n                                                                    <div class=\"row mb-3\">\r\n                                                                        <div class=\"col-sm-2\"></div>\r\n                                                                        <div class=\"col-sm-10\">\r\n                                                                            <button style=\"height: 38px;\" class=\"btn btn-primary\"\r\n                                                                                    type=\"submit\"\r\n                                                                                    onclick=\"document.getElementById('action').value = 'insertQuestion'\">\r\n                                                                                Add question\r\n                                                                            </button>\r\n                                                                        </div>\r\n                                                                    </div>\r\n                                                                </div>\r\n                                                            </div>\r\n                                                        </div>\r\n                                                    </div>\r\n                                                    <div class=\"tab-pane fade\" id=\"navs-pills-import-file\" role=\"tabpanel\">\r\n                                                        <div class=\"row mb-3\">\r\n                                                            <label for=\"formFile\" class=\"form-label\">Choose an excel file</label>\r\n                                                            <div class=\"col-sm-9\">\r\n                                                                <input class=\"form-control\" type=\"file\" id=\"formFile\"\r\n                                                                       accept=\"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,application/vnd.ms-excel\"\r\n                                                                       name=\"file\"\r\n                                                                       style=\"width: 100%;\"/>\r\n                                                            </div>\r\n                                                            <div class=\"col-sm-3\">\r\n                                                                <button\r\n                                                                    style=\"height: 38px;\" class=\"btn btn-primary ml-3\"\r\n                                                                    type=\"submit\"\r\n                                                                    onclick=\"document.getElementById('action').value = 'insertQuestionByFile'\">\r\n                                                                    Import file\r\n                                                                </button>\r\n                                                            </div>\r\n                                                        </div>\r\n                                                        <c:if test=\"${(requestScope.fileErr != null) && (!requestScope.fileErr.isEmpty())}\">\r\n                                                            <div class=\"row mb-3\">\r\n                                                                <h5 style=\"color: red;\">Import file failed</h5>\r\n                                                            </div>\r\n                                                        </c:if>\r\n                                                        <p>\r\n                                                            Please follow this template to import question with Excel file\r\n                                                            <a class=\"btn btn-info\" href=\"template.xlsx\"\r\n                                                               style=\"color: white; text-decoration: none; height: 38px;\" download>Download template</a>\r\n                                                        </p>\r\n                                                    </div>\r\n                                                </div>\r\n                                            </div>\r\n                                        </div>\r\n\r\n                                    </div>\r\n                                </div>\r\n                            </form>\r\n                            <hr class=\"my-5\" />\r\n\r\n\r\n\r\n                        </div>\r\n                        <!-- / Content -->\r\n\r\n                        <div class=\"content-backdrop fade\"></div>\r\n                        <jsp:include page=\"/WEB-INF/common/footer.jsp\"/>\r\n                    </div>\r\n                    <!-- Content wrapper -->\r\n\r\n\r\n                </div>\r\n                <!-- / Layout page -->\r\n            </div>\r\n        </div>\r\n        <!-- / Layout wrapper -->\r\n\r\n\r\n\r\n        <script src=\"https://code.jquery.com/jquery-3.4.1.min.js\"></script>\r\n        <script src=\"https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.bundle.min.js\"></script>\r\n        <script src=\"../lib/easing/easing.min.js\"></script>\r\n        <script src=\"../lib/waypoints/waypoints.min.js\"></script>\r\n        <script src=\"../lib/counterup/counterup.min.js\"></script>\r\n        <script src=\"../lib/owlcarousel/owl.carousel.min.js\"></script>\r\n\r\n        <!-- Template Javascript -->\r\n        <script src=\"../js/main.js\"></script>\r\n\r\n        <!-- Core JS -->\r\n        <!-- build:js ../assets/vendor/js/core.js -->\r\n\r\n        <script src=\"../assets/vendor/libs/jquery/jquery.js\"></script>\r\n        <script src=\"../assets/vendor/libs/popper/popper.js\"></script>\r\n        <script src=\"../assets/vendor/js/bootstrap.js\"></script>\r\n        <script src=\"../assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.js\"></script>\r\n        <script src=\"../assets/vendor/js/menu.js\"></script>\r\n\r\n        <!-- endbuild -->\r\n\r\n        <!-- Vendors JS -->\r\n        <script src=\"../assets/vendor/libs/apex-charts/apexcharts.js\"></script>\r\n\r\n        <!-- Main JS -->\r\n        <script src=\"../assets/js/main.js\"></script>\r\n\r\n        <!-- Page JS -->\r\n        <script src=\"../assets/js/dashboards-analytics.js\"></script>\r\n\r\n        <!-- Place this tag in your head or just before your close body tag. -->\r\n        <script async defer src=\"https://buttons.github.io/buttons.js\"></script>\r\n    </body>\r\n</html>\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/web/WEB-INF/views/question/newquestion.jsp b/web/WEB-INF/views/question/newquestion.jsp
--- a/web/WEB-INF/views/question/newquestion.jsp	(revision d6ad1445e1c07c5da0ab8951156084fe4a182d1f)
+++ b/web/WEB-INF/views/question/newquestion.jsp	(date 1721252670161)
@@ -337,7 +337,7 @@
                             </form>
                             <hr class="my-5" />
 
-
+                            <a class="btn btn-primary" href="${pageContext.request.contextPath}/question">Back</a>
 
                         </div>
                         <!-- / Content -->
Index: src/java/controller/google/LoginGoogleServlet.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>/*\r\n * Click nbfs://nbhost/SystemFileSystem/Templates/Licenses/license-default.txt to change this license\r\n * Click nbfs://nbhost/SystemFileSystem/Templates/JSP_Servlet/Servlet.java to edit this template\r\n */\r\npackage controller.google;\r\n\r\nimport dal.UserDAO;\r\nimport jakarta.servlet.RequestDispatcher;\r\nimport jakarta.servlet.ServletException;\r\nimport jakarta.servlet.annotation.WebServlet;\r\nimport jakarta.servlet.http.HttpServlet;\r\nimport jakarta.servlet.http.HttpServletRequest;\r\nimport jakarta.servlet.http.HttpServletResponse;\r\nimport jakarta.servlet.http.HttpSession;\r\nimport model.google.GooglePojo;\r\nimport model.user.User;\r\n\r\nimport java.io.IOException;\r\nimport java.sql.SQLException;\r\n\r\n/**\r\n * @author PC\r\n */\r\n@WebServlet(\"/login-google\")\r\npublic class LoginGoogleServlet extends HttpServlet {\r\n\r\n    private static final long serialVersionUID = 1L;\r\n\r\n    public LoginGoogleServlet() {\r\n        super();\r\n    }\r\n\r\n    protected void doGet(HttpServletRequest request, HttpServletResponse response)\r\n            throws ServletException, IOException {\r\n        String code = request.getParameter(\"code\");\r\n        if (code == null || code.isEmpty()) {\r\n            response.sendRedirect(\"login.jsp\");\r\n        } else {\r\n            String accessToken = GoogleUtils.getToken(code);\r\n            GooglePojo googlePojo = GoogleUtils.getUserInfo(accessToken);\r\n            String email = googlePojo.getEmail();\r\n            UserDAO userDAO = new UserDAO();\r\n            try {\r\n                HttpSession session = request.getSession();\r\n                if (userDAO.checkEmailExist(email)) {\r\n                    // email đã tồn tại trong database\r\n                    User user = new User();\r\n                    user = userDAO.loginGoogle(email);\r\n                    session.setAttribute(\"user\", user);\r\n                    RequestDispatcher rd = request.getRequestDispatcher(\"dashboard.jsp\");\r\n                    rd.forward(request, response);\r\n                } else {\r\n                    // email chưa tồn tại trong database\r\n                    session.setAttribute(\"email\", email);\r\n                    response.sendRedirect(\"set-password.jsp\");\r\n                }\r\n            } catch (SQLException e) {\r\n                throw new RuntimeException(e);\r\n            }\r\n        }\r\n    }\r\n\r\n    @Override\r\n    protected void doPost(HttpServletRequest request, HttpServletResponse response)\r\n            throws ServletException, IOException {\r\n        doGet(request, response);\r\n    }\r\n\r\n    @Override\r\n    public String getServletInfo() {\r\n        return \"Handles Google Login\";\r\n    }\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/java/controller/google/LoginGoogleServlet.java b/src/java/controller/google/LoginGoogleServlet.java
--- a/src/java/controller/google/LoginGoogleServlet.java	(revision d6ad1445e1c07c5da0ab8951156084fe4a182d1f)
+++ b/src/java/controller/google/LoginGoogleServlet.java	(date 1721252670148)
@@ -5,7 +5,6 @@
 package controller.google;
 
 import dal.UserDAO;
-import jakarta.servlet.RequestDispatcher;
 import jakarta.servlet.ServletException;
 import jakarta.servlet.annotation.WebServlet;
 import jakarta.servlet.http.HttpServlet;
@@ -47,8 +46,7 @@
                     User user = new User();
                     user = userDAO.loginGoogle(email);
                     session.setAttribute("user", user);
-                    RequestDispatcher rd = request.getRequestDispatcher("dashboard.jsp");
-                    rd.forward(request, response);
+                    response.sendRedirect("dashboard.jsp");
                 } else {
                     // email chưa tồn tại trong database
                     session.setAttribute("email", email);
Index: nbproject/private/private.properties
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><<<<<<< HEAD\r\ndeploy.ant.properties.file=C:\\\\Users\\\\janec\\\\AppData\\\\Roaming\\\\NetBeans\\\\17\\\\tomcat101.properties\r\nj2ee.server.home=C:/Program Files/Apache Software Foundation/Tomcat 10.1\r\nj2ee.server.instance=tomcat101:home=C:\\\\Program Files\\\\Apache Software Foundation\\\\Tomcat 10.1\r\njavac.debug=true\r\njavadoc.preview=true\r\nselected.browser=SL[/Browsers/MicrosoftEdgeBrowser\r\nuser.properties.file=C:\\\\Users\\\\PC\\\\AppData\\\\Roaming\\\\NetBeans\\\\17\\\\build.properties\r\n=======\r\ndeploy.ant.properties.file=C:\\\\Users\\\\PC\\\\AppData\\\\Roaming\\\\NetBeans\\\\17\\\\tomcat101.properties\r\nj2ee.server.home=C:/Program Files/Apache Software Foundation/Tomcat 10.1\r\nj2ee.server.instance=tomcat101:home=C:\\\\Program Files\\\\Apache Software Foundation\\\\Tomcat 10.1\r\n>>>>>>> 3e5956e5bfb70681caef0e0eb378d018bb808990\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>ISO-8859-1
===================================================================
diff --git a/nbproject/private/private.properties b/nbproject/private/private.properties
--- a/nbproject/private/private.properties	(revision d6ad1445e1c07c5da0ab8951156084fe4a182d1f)
+++ b/nbproject/private/private.properties	(date 1721252670148)
@@ -5,9 +5,9 @@
 javac.debug=true
 javadoc.preview=true
 selected.browser=SL[/Browsers/MicrosoftEdgeBrowser
-user.properties.file=C:\\Users\\PC\\AppData\\Roaming\\NetBeans\\17\\build.properties
+user.properties.file=C:\\Users\\DELL\\AppData\\Roaming\\NetBeans\\17\\build.properties
 =======
-deploy.ant.properties.file=C:\\Users\\PC\\AppData\\Roaming\\NetBeans\\17\\tomcat101.properties
+deploy.ant.properties.file=C:\\Users\\DELL\\AppData\\Roaming\\NetBeans\\17\\tomcat101.properties
 j2ee.server.home=C:/Program Files/Apache Software Foundation/Tomcat 10.1
 j2ee.server.instance=tomcat101:home=C:\\Program Files\\Apache Software Foundation\\Tomcat 10.1
 >>>>>>> 3e5956e5bfb70681caef0e0eb378d018bb808990
Index: web/successful-signup.jsp
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/web/successful-signup.jsp b/web/successful-signup.jsp
new file mode 100644
--- /dev/null	(date 1721252670209)
+++ b/web/successful-signup.jsp	(date 1721252670209)
@@ -0,0 +1,17 @@
+<%-- 
+    Document   : successful-singup
+    Created on : May 14, 2024, 9:19:28 PM
+    Author     : PC
+--%>
+
+<%@page contentType="text/html" pageEncoding="UTF-8"%>
+<!DOCTYPE html>
+<html>
+    <head>
+        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
+        <title>JSP Page</title>
+    </head>
+    <body>
+        <h1>SUCCESS</h1>
+    </body>
+</html>
Index: src/java/dal/MaterialDAO.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package dal;\r\n\r\nimport java.io.File;\r\nimport model.material.Material;\r\nimport java.io.Serializable;\r\nimport java.sql.PreparedStatement;\r\nimport java.sql.ResultSet;\r\nimport java.sql.SQLException;\r\nimport java.util.ArrayList;\r\n\r\npublic class MaterialDAO extends DBContext implements Serializable {\r\n\r\n    public MaterialDAO() {\r\n    }\r\n\r\n    private boolean isUriExist(String uri) {\r\n        String sql = \"select * from material where uri = ?;\";\r\n        try {\r\n            PreparedStatement st = connection.prepareStatement(sql);\r\n            st.setString(1, uri);\r\n            ResultSet rs = st.executeQuery();\r\n            return rs.next();\r\n        } catch (SQLException e) {\r\n            System.out.println(e.getMessage());\r\n            throw new AssertionError();\r\n        }\r\n    }\r\n\r\n    private void insertNewMaterial(String uri) throws SQLException {\r\n        String sql = \"insert into material(uri) values (?);\";\r\n        PreparedStatement st = connection.prepareStatement(sql);\r\n        st.setString(1, uri);\r\n        st.execute();\r\n    }\r\n\r\n    public void insertMaterial(String uri, int lessonId) throws SQLException {\r\n        if (!isUriExist(uri)) {\r\n            insertNewMaterial(uri);\r\n        }\r\n\r\n        String sql = \"insert into material_lesson(material_id, lesson_id) values (\"\r\n                + \"(select id from material where uri = ?),?\"\r\n                + \")\";\r\n        PreparedStatement st = connection.prepareStatement(sql);\r\n        st.setString(1, uri);\r\n        st.setInt(2, lessonId);\r\n        st.execute();\r\n    }\r\n\r\n    private Material getMaterialInfo(ResultSet rs, String workingDir) throws SQLException {\r\n        String uri = rs.getString(\"uri\");\r\n        int id = rs.getInt(\"id\");\r\n        File file = new File(workingDir + uri);\r\n        Material m = new Material();\r\n\r\n        if (file.exists()) {\r\n\r\n            m.setId(id);\r\n            m.setUri(uri);\r\n            m.setWebUri(uri.replace(\"\\\\\", \"/\"));\r\n            String name = file.getName();\r\n            m.setName(name);\r\n\r\n        }\r\n        return m;\r\n    }\r\n\r\n    public ArrayList<Material> getAllMaterialOfALesson(int lessonId, String workingDir) {\r\n        ArrayList<Material> ret = new ArrayList<>();\r\n        String sql = \"select * from material where id in (\"\r\n                + \"select material_id from material_lesson where lesson_id = ?);\";\r\n        try {\r\n            PreparedStatement st = connection.prepareStatement(sql);\r\n            st.setInt(1, lessonId);\r\n            ResultSet rs = st.executeQuery();\r\n            while (rs.next()) {\r\n                Material m = getMaterialInfo(rs, workingDir);\r\n                ret.add(m);\r\n            }\r\n        } catch (SQLException e) {\r\n            System.out.println(e.getMessage());\r\n        }\r\n        return ret;\r\n    }\r\n\r\n    public void removeMaterial(int id) throws SQLException {\r\n        String sql = \"delete from material where id = ?\";\r\n        PreparedStatement st = connection.prepareStatement(sql);\r\n        st.setInt(1, id);\r\n        st.execute();\r\n    }\r\n\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/java/dal/MaterialDAO.java b/src/java/dal/MaterialDAO.java
--- a/src/java/dal/MaterialDAO.java	(revision d6ad1445e1c07c5da0ab8951156084fe4a182d1f)
+++ b/src/java/dal/MaterialDAO.java	(date 1721252670148)
@@ -1,7 +1,7 @@
 package dal;
 
 import java.io.File;
-import model.material.Material;
+import model.Material;
 import java.io.Serializable;
 import java.sql.PreparedStatement;
 import java.sql.ResultSet;
@@ -13,59 +13,20 @@
     public MaterialDAO() {
     }
 
-    private boolean isUriExist(String uri) {
-        String sql = "select * from material where uri = ?;";
-        try {
-            PreparedStatement st = connection.prepareStatement(sql);
-            st.setString(1, uri);
-            ResultSet rs = st.executeQuery();
-            return rs.next();
-        } catch (SQLException e) {
-            System.out.println(e.getMessage());
-            throw new AssertionError();
-        }
-    }
-
-    private void insertNewMaterial(String uri) throws SQLException {
-        String sql = "insert into material(uri) values (?);";
-        PreparedStatement st = connection.prepareStatement(sql);
-        st.setString(1, uri);
-        st.execute();
-    }
+    private Material getMaterialInfo(ResultSet rs) throws SQLException {
+        Material m = new Material();
 
-    public void insertMaterial(String uri, int lessonId) throws SQLException {
-        if (!isUriExist(uri)) {
-            insertNewMaterial(uri);
-        }
-
-        String sql = "insert into material_lesson(material_id, lesson_id) values ("
-                + "(select id from material where uri = ?),?"
-                + ")";
-        PreparedStatement st = connection.prepareStatement(sql);
-        st.setString(1, uri);
-        st.setInt(2, lessonId);
-        st.execute();
-    }
-
-    private Material getMaterialInfo(ResultSet rs, String workingDir) throws SQLException {
+        m.setId(rs.getInt("id"));
         String uri = rs.getString("uri");
-        int id = rs.getInt("id");
-        File file = new File(workingDir + uri);
-        Material m = new Material();
-
-        if (file.exists()) {
-
-            m.setId(id);
-            m.setUri(uri);
-            m.setWebUri(uri.replace("\\", "/"));
-            String name = file.getName();
-            m.setName(name);
+        m.setUri(uri);
 
-        }
+        String[] parts = uri.split("/");
+        m.setName(parts[parts.length - 1]);
+
         return m;
     }
 
-    public ArrayList<Material> getAllMaterialOfALesson(int lessonId, String workingDir) {
+    public ArrayList<Material> getAllMaterialOfALesson(int lessonId) {
         ArrayList<Material> ret = new ArrayList<>();
         String sql = "select * from material where id in ("
                 + "select material_id from material_lesson where lesson_id = ?);";
@@ -74,7 +35,7 @@
             st.setInt(1, lessonId);
             ResultSet rs = st.executeQuery();
             while (rs.next()) {
-                Material m = getMaterialInfo(rs, workingDir);
+                Material m = getMaterialInfo(rs);
                 ret.add(m);
             }
         } catch (SQLException e) {
@@ -83,10 +44,77 @@
         return ret;
     }
 
-    public void removeMaterial(int id) throws SQLException {
-        String sql = "delete from material where id = ?";
+    public boolean isMaterialExist(int lessonId, String uri)
+            throws SQLException {
+        String sql = "select m.uri as uri "
+                + "from material m join material_lesson ml where "
+                + "m.id = ml.material_id "
+                + "and uri = ? "
+                + "and ml.lesson_id = ?; ";
+        PreparedStatement st = connection.prepareStatement(sql);
+        st.setString(1, uri);
+        st.setInt(2, lessonId);
+        ResultSet rs = st.executeQuery();
+        if (rs.next()) {
+            return true;
+        }
+        return false;
+    }
+
+    private void insertIntoMaterial(String uri) throws SQLException {
+        String sql = "insert into material(uri) values (?);";
+        PreparedStatement st = connection.prepareStatement(sql);
+        st.setString(1, uri);
+        st.execute();
+    }
+
+    private void insertIntoMaterial_Lesson(int lessonId, String uri) throws SQLException {
+        String sql = "insert into material_lesson(lesson_id, material_id)"
+                + "values (?,"
+                + "(select id from material where uri = ?))";
+        PreparedStatement st = connection.prepareStatement(sql);
+        st.setInt(1, lessonId);
+        st.setString(2, uri);
+        st.execute();
+    }
+
+    public void insertMaterial(int lessonId, String uri) throws SQLException {
+        insertIntoMaterial(uri);
+        insertIntoMaterial_Lesson(lessonId, uri);
+    }
+
+    public void removeFromMaterial_Lesson(int lessonId, int materialId) throws SQLException {
+        String sql = "delete from material_lesson where"
+                + " lesson_id = ? and material_id = ?;";
         PreparedStatement st = connection.prepareStatement(sql);
-        st.setInt(1, id);
+        st.setInt(1, lessonId);
+        st.setInt(2, materialId);
+        st.execute();
+    }
+
+    public boolean isMaterialUsed(int materialId) throws SQLException {
+        String sql = "select * from material_lesson where material_id = ?;";
+        PreparedStatement st = connection.prepareStatement(sql);
+        st.setInt(1, materialId);
+        ResultSet rs = st.executeQuery();
+        return rs.next();
+    }
+
+    public Material getMaterialMatchId(int materialId) throws SQLException {
+        String sql = "select * from material where id = ?;";
+        PreparedStatement st = connection.prepareStatement(sql);
+        st.setInt(1, materialId);
+        ResultSet rs = st.executeQuery();
+        if (rs.next()) {
+            return getMaterialInfo(rs);
+        }
+        return null;
+    }
+
+    public void removeMaterial(Material m) throws SQLException {
+        String sql = "delete from material where id = ?;";
+        PreparedStatement st = connection.prepareStatement(sql);
+        st.setInt(1, m.getId());
         st.execute();
     }
 
Index: nbproject/project.properties
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>annotation.processing.enabled=true\r\nannotation.processing.enabled.in.editor=true\r\nannotation.processing.processors.list=\r\nannotation.processing.run.all.processors=true\r\nannotation.processing.source.output=${build.generated.sources.dir}/ap-source-output\r\nbuild.classes.dir=${build.web.dir}/WEB-INF/classes\r\nbuild.classes.excludes=**/*.java,**/*.form\r\nbuild.dir=build\r\nbuild.generated.dir=${build.dir}/generated\r\nbuild.generated.sources.dir=${build.dir}/generated-sources\r\nbuild.test.classes.dir=${build.dir}/test/classes\r\nbuild.test.results.dir=${build.dir}/test/results\r\nbuild.web.dir=${build.dir}/web\r\nbuild.web.excludes=${build.classes.excludes}\r\nclient.urlPart=\r\ncompile.jsps=false\r\nconf.dir=${source.root}/conf\r\ndebug.classpath=${build.classes.dir}:${javac.classpath}\r\ndebug.test.classpath=\\\r\n    ${run.test.classpath}\r\ndisplay.browser=true\r\n# Files to be excluded from distribution war\r\ndist.archive.excludes=\r\ndist.dir=dist\r\ndist.ear.war=${dist.dir}/${war.ear.name}\r\ndist.javadoc.dir=${dist.dir}/javadoc\r\ndist.war=${dist.dir}/${war.name}\r\nendorsed.classpath=\r\nexcludes=\r\nfile.reference.activation-1.1.1.jar=lib\\\\activation-1.1.1.jar\r\nfile.reference.commons-codec-1.15.jar=lib\\\\xls\\\\commons-codec-1.15.jar\r\nfile.reference.commons-collections4-4.4.jar=lib\\\\xls\\\\commons-collections4-4.4.jar\r\nfile.reference.commons-compress-1.21.jar=lib\\\\xls\\\\commons-compress-1.21.jar\r\nfile.reference.commons-io-2.11.0.jar=lib\\\\xls\\\\commons-io-2.11.0.jar\r\nfile.reference.commons-logging-1.2.jar=lib/commons-logging-1.2.jar\r\nfile.reference.commons-logging-1.2.jar-1=lib\\\\xls\\\\commons-logging-1.2.jar\r\nfile.reference.commons-math3-3.6.1.jar=lib\\\\xls\\\\commons-math3-3.6.1.jar\r\nfile.reference.curvesapi-1.07.jar=lib\\\\xls\\\\curvesapi-1.07.jar\r\nfile.reference.fluent-hc-4.5.5.jar=lib/fluent-hc-4.5.5.jar\r\nfile.reference.gson-2.8.2.jar=lib/gson-2.8.2.jar\r\nfile.reference.httpclient-4.5.5.jar=lib/httpclient-4.5.5.jar\r\nfile.reference.httpcore-4.4.9.jar=lib/httpcore-4.4.9.jar\r\nfile.reference.jakarta.activation-2.0.1.jar=lib\\\\xls\\\\jakarta.activation-2.0.1.jar\r\nfile.reference.jakarta.xml.bind-api-3.0.1.jar=lib\\\\xls\\\\jakarta.xml.bind-api-3.0.1.jar\r\nfile.reference.javax.activation-1.2.0.jar=lib//javax.activation-1.2.0.jar\r\nfile.reference.javax.mail.jar=lib/javax.mail.jar\r\nfile.reference.log4j-api-2.18.0.jar=lib\\\\xls\\\\log4j-api-2.18.0.jar\r\nfile.reference.mysql-connector-j-8.4.0.jar=lib/mysql-connector-j-8.4.0.jar\r\nfile.reference.jakarta.servlet.jsp.jstl-2.0.0.jar=lib/jakarta.servlet.jsp.jstl-2.0.0.jar\r\nfile.reference.jakarta.servlet.jsp.jstl-api-2.0.0.jar=lib/jakarta.servlet.jsp.jstl-api-2.0.0.jar\r\nfile.reference.json-20240303.jar=lib/json-20240303.jar\r\nfile.reference.mysql-connector-j-8.4.0.jar=lib/mysql-connector-j-8.4.0.jar\r\nfile.reference.poi-5.2.3.jar=lib\\\\xls\\\\poi-5.2.3.jar\r\nfile.reference.poi-examples-5.2.3.jar=lib\\\\xls\\\\poi-examples-5.2.3.jar\r\nfile.reference.poi-excelant-5.2.3.jar=lib\\\\xls\\\\poi-excelant-5.2.3.jar\r\nfile.reference.poi-javadoc-5.2.3.jar=lib\\\\xls\\\\poi-javadoc-5.2.3.jar\r\nfile.reference.poi-ooxml-5.2.3.jar=lib\\\\xls\\\\poi-ooxml-5.2.3.jar\r\nfile.reference.poi-ooxml-full-5.2.3.jar=lib\\\\xls\\\\poi-ooxml-full-5.2.3.jar\r\nfile.reference.poi-ooxml-lite-5.2.3.jar=lib\\\\xls\\\\poi-ooxml-lite-5.2.3.jar\r\nfile.reference.poi-scratchpad-5.2.3.jar=lib\\\\xls\\\\poi-scratchpad-5.2.3.jar\r\nfile.reference.restfb-2.3.0.jar=lib/restfb-2.3.0.jar\r\nfile.reference.slf4j-api-1.7.36.jar=lib\\\\xls\\\\slf4j-api-1.7.36.jar\r\nfile.reference.SparseBitSet-1.2.jar=lib\\\\xls\\\\SparseBitSet-1.2.jar\r\nfile.reference.xmlbeans-5.1.1.jar=lib\\\\xls\\\\xmlbeans-5.1.1.jar\r\nincludes=**\r\nj2ee.compile.on.save=true\r\nj2ee.copy.static.files.on.save=true\r\nj2ee.deploy.on.save=true\r\nj2ee.platform=10-web\r\nj2ee.platform.classpath=${j2ee.server.home}/bin/tomcat-juli.jar:${j2ee.server.home}/lib/annotations-api.jar:${j2ee.server.home}/lib/catalina-ant.jar:${j2ee.server.home}/lib/catalina-ha.jar:${j2ee.server.home}/lib/catalina-ssi.jar:${j2ee.server.home}/lib/catalina-storeconfig.jar:${j2ee.server.home}/lib/catalina-tribes.jar:${j2ee.server.home}/lib/catalina.jar:${j2ee.server.home}/lib/ecj-4.27.jar:${j2ee.server.home}/lib/el-api.jar:${j2ee.server.home}/lib/jakartaee-migration-1.0.8-shaded.jar:${j2ee.server.home}/lib/jasper-el.jar:${j2ee.server.home}/lib/jasper.jar:${j2ee.server.home}/lib/jaspic-api.jar:${j2ee.server.home}/lib/jsp-api.jar:${j2ee.server.home}/lib/servlet-api.jar:${j2ee.server.home}/lib/tomcat-api.jar:${j2ee.server.home}/lib/tomcat-coyote.jar:${j2ee.server.home}/lib/tomcat-dbcp.jar:${j2ee.server.home}/lib/tomcat-i18n-cs.jar:${j2ee.server.home}/lib/tomcat-i18n-de.jar:${j2ee.server.home}/lib/tomcat-i18n-es.jar:${j2ee.server.home}/lib/tomcat-i18n-fr.jar:${j2ee.server.home}/lib/tomcat-i18n-ja.jar:${j2ee.server.home}/lib/tomcat-i18n-ko.jar:${j2ee.server.home}/lib/tomcat-i18n-pt-BR.jar:${j2ee.server.home}/lib/tomcat-i18n-ru.jar:${j2ee.server.home}/lib/tomcat-i18n-zh-CN.jar:${j2ee.server.home}/lib/tomcat-jdbc.jar:${j2ee.server.home}/lib/tomcat-jni.jar:${j2ee.server.home}/lib/tomcat-util-scan.jar:${j2ee.server.home}/lib/tomcat-util.jar:${j2ee.server.home}/lib/tomcat-websocket.jar:${j2ee.server.home}/lib/websocket-api.jar:${j2ee.server.home}/lib/websocket-client-api.jar\r\nj2ee.server.type=Tomcat\r\njar.compress=false\r\njavac.classpath=\\\r\n    ${file.reference.commons-logging-1.2.jar}:\\\r\n    ${file.reference.fluent-hc-4.5.5.jar}:\\\r\n    ${file.reference.gson-2.8.2.jar}:\\\r\n    ${file.reference.httpclient-4.5.5.jar}:\\\r\n    ${file.reference.httpcore-4.4.9.jar}:\\\r\n    ${file.reference.mysql-connector-j-8.4.0.jar}:\\\r\n    ${file.reference.jakarta.servlet.jsp.jstl-2.0.0.jar}:\\\r\n    ${file.reference.jakarta.servlet.jsp.jstl-api-2.0.0.jar}:\\\r\n    ${file.reference.json-20240303.jar}:\\\r\n    ${file.reference.restfb-2.3.0.jar}:\\\r\n    ${file.reference.javax.mail.jar}:\\\r\n    ${file.reference.activation-1.1.1.jar}:\\\r\n    ${file.reference.javax.activation-1.2.0.jar}:\\\r\n    ${file.reference.SparseBitSet-1.2.jar}:\\\r\n    ${file.reference.commons-codec-1.15.jar}:\\\r\n    ${file.reference.commons-collections4-4.4.jar}:\\\r\n    ${file.reference.commons-compress-1.21.jar}:\\\r\n    ${file.reference.commons-io-2.11.0.jar}:\\\r\n    ${file.reference.commons-logging-1.2.jar-1}:\\\r\n    ${file.reference.commons-math3-3.6.1.jar}:\\\r\n    ${file.reference.curvesapi-1.07.jar}:\\\r\n    ${file.reference.jakarta.activation-2.0.1.jar}:\\\r\n    ${file.reference.jakarta.xml.bind-api-3.0.1.jar}:\\\r\n    ${file.reference.log4j-api-2.18.0.jar}:\\\r\n    ${file.reference.poi-5.2.3.jar}:\\\r\n    ${file.reference.poi-examples-5.2.3.jar}:\\\r\n    ${file.reference.poi-excelant-5.2.3.jar}:\\\r\n    ${file.reference.poi-javadoc-5.2.3.jar}:\\\r\n    ${file.reference.poi-ooxml-5.2.3.jar}:\\\r\n    ${file.reference.poi-ooxml-full-5.2.3.jar}:\\\r\n    ${file.reference.poi-ooxml-lite-5.2.3.jar}:\\\r\n    ${file.reference.poi-scratchpad-5.2.3.jar}:\\\r\n    ${file.reference.slf4j-api-1.7.36.jar}:\\\r\n    ${file.reference.xmlbeans-5.1.1.jar}\r\n    ${file.reference.mysql-connector-j-8.4.0.jar}:\\\r\n    ${file.reference.json-20240303.jar}:\\\r\n    ${file.reference.restfb-2.3.0.jar}:\\\r\n    ${file.reference.jakarta.servlet.jsp.jstl-2.0.0.jar}:\\\r\n    ${file.reference.jakarta.servlet.jsp.jstl-api-2.0.0.jar}\r\n# Space-separated list of extra javac options\r\njavac.compilerargs=\r\njavac.debug=true\r\njavac.deprecation=false\r\njavac.processorpath=\\\r\n    ${javac.classpath}\r\njavac.source=17\r\njavac.target=17\r\njavac.test.classpath=\\\r\n    ${javac.classpath}:\\\r\n    ${build.classes.dir}\r\njavac.test.processorpath=\\\r\n    ${javac.test.classpath}\r\njavadoc.additionalparam=\r\njavadoc.author=false\r\njavadoc.encoding=${source.encoding}\r\njavadoc.noindex=false\r\njavadoc.nonavbar=false\r\njavadoc.notree=false\r\njavadoc.preview=true\r\njavadoc.private=false\r\njavadoc.splitindex=true\r\njavadoc.use=true\r\njavadoc.version=false\r\njavadoc.windowtitle=\r\nlib.dir=${web.docbase.dir}/WEB-INF/lib\r\npersistence.xml.dir=${conf.dir}\r\nplatform.active=default_platform\r\nresource.dir=setup\r\nrun.test.classpath=\\\r\n    ${javac.test.classpath}:\\\r\n    ${build.test.classes.dir}\r\n# Space-separated list of JVM arguments used when running a class with a main method or a unit test\r\n# (you may also define separate properties like run-sys-prop.name=value instead of -Dname=value):\r\nrunmain.jvmargs=\r\nsource.encoding=UTF-8\r\nsource.root=src\r\nsrc.dir=${source.root}/java\r\ntest.src.dir=test\r\nwar.content.additional=\r\nwar.ear.name=${war.name}\r\nwar.name=se1808-g6.war\r\nweb.docbase.dir=web\r\nwebinf.dir=web/WEB-INF\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>ISO-8859-1
===================================================================
diff --git a/nbproject/project.properties b/nbproject/project.properties
--- a/nbproject/project.properties	(revision d6ad1445e1c07c5da0ab8951156084fe4a182d1f)
+++ b/nbproject/project.properties	(date 1721252670148)
@@ -67,7 +67,7 @@
 j2ee.copy.static.files.on.save=true
 j2ee.deploy.on.save=true
 j2ee.platform=10-web
-j2ee.platform.classpath=${j2ee.server.home}/bin/tomcat-juli.jar:${j2ee.server.home}/lib/annotations-api.jar:${j2ee.server.home}/lib/catalina-ant.jar:${j2ee.server.home}/lib/catalina-ha.jar:${j2ee.server.home}/lib/catalina-ssi.jar:${j2ee.server.home}/lib/catalina-storeconfig.jar:${j2ee.server.home}/lib/catalina-tribes.jar:${j2ee.server.home}/lib/catalina.jar:${j2ee.server.home}/lib/ecj-4.27.jar:${j2ee.server.home}/lib/el-api.jar:${j2ee.server.home}/lib/jakartaee-migration-1.0.8-shaded.jar:${j2ee.server.home}/lib/jasper-el.jar:${j2ee.server.home}/lib/jasper.jar:${j2ee.server.home}/lib/jaspic-api.jar:${j2ee.server.home}/lib/jsp-api.jar:${j2ee.server.home}/lib/servlet-api.jar:${j2ee.server.home}/lib/tomcat-api.jar:${j2ee.server.home}/lib/tomcat-coyote.jar:${j2ee.server.home}/lib/tomcat-dbcp.jar:${j2ee.server.home}/lib/tomcat-i18n-cs.jar:${j2ee.server.home}/lib/tomcat-i18n-de.jar:${j2ee.server.home}/lib/tomcat-i18n-es.jar:${j2ee.server.home}/lib/tomcat-i18n-fr.jar:${j2ee.server.home}/lib/tomcat-i18n-ja.jar:${j2ee.server.home}/lib/tomcat-i18n-ko.jar:${j2ee.server.home}/lib/tomcat-i18n-pt-BR.jar:${j2ee.server.home}/lib/tomcat-i18n-ru.jar:${j2ee.server.home}/lib/tomcat-i18n-zh-CN.jar:${j2ee.server.home}/lib/tomcat-jdbc.jar:${j2ee.server.home}/lib/tomcat-jni.jar:${j2ee.server.home}/lib/tomcat-util-scan.jar:${j2ee.server.home}/lib/tomcat-util.jar:${j2ee.server.home}/lib/tomcat-websocket.jar:${j2ee.server.home}/lib/websocket-api.jar:${j2ee.server.home}/lib/websocket-client-api.jar
+j2ee.platform.classpath=${j2ee.server.home}/bin/tomcat-juli.jar:${j2ee.server.home}/lib/annotations-api.jar:${j2ee.server.home}/lib/catalina-ant.jar:${j2ee.server.home}/lib/catalina-ha.jar:${j2ee.server.home}/lib/catalina-ssi.jar:${j2ee.server.home}/lib/catalina-storeconfig.jar:${j2ee.server.home}/lib/catalina-tribes.jar:${j2ee.server.home}/lib/catalina.jar:${j2ee.server.home}/lib/ecj-4.27.jar:${j2ee.server.home}/lib/el-api.jar:${j2ee.server.home}/lib/jakartaee-migration-1.0.7-shaded.jar:${j2ee.server.home}/lib/jasper-el.jar:${j2ee.server.home}/lib/jasper.jar:${j2ee.server.home}/lib/jaspic-api.jar:${j2ee.server.home}/lib/jsp-api.jar:${j2ee.server.home}/lib/servlet-api.jar:${j2ee.server.home}/lib/tomcat-api.jar:${j2ee.server.home}/lib/tomcat-coyote.jar:${j2ee.server.home}/lib/tomcat-dbcp.jar:${j2ee.server.home}/lib/tomcat-i18n-cs.jar:${j2ee.server.home}/lib/tomcat-i18n-de.jar:${j2ee.server.home}/lib/tomcat-i18n-es.jar:${j2ee.server.home}/lib/tomcat-i18n-fr.jar:${j2ee.server.home}/lib/tomcat-i18n-ja.jar:${j2ee.server.home}/lib/tomcat-i18n-ko.jar:${j2ee.server.home}/lib/tomcat-i18n-pt-BR.jar:${j2ee.server.home}/lib/tomcat-i18n-ru.jar:${j2ee.server.home}/lib/tomcat-i18n-zh-CN.jar:${j2ee.server.home}/lib/tomcat-jdbc.jar:${j2ee.server.home}/lib/tomcat-jni.jar:${j2ee.server.home}/lib/tomcat-util-scan.jar:${j2ee.server.home}/lib/tomcat-util.jar:${j2ee.server.home}/lib/tomcat-websocket.jar:${j2ee.server.home}/lib/websocket-api.jar:${j2ee.server.home}/lib/websocket-client-api.jar
 j2ee.server.type=Tomcat
 jar.compress=false
 javac.classpath=\
Index: src/java/controller/dashboard/DashboardServlet.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package controller.dashboard;\r\n\r\nimport dal.*;\r\nimport java.io.IOException;\r\nimport java.io.PrintWriter;\r\nimport jakarta.servlet.ServletException;\r\nimport jakarta.servlet.annotation.WebServlet;\r\nimport jakarta.servlet.http.HttpServlet;\r\nimport jakarta.servlet.http.HttpServletRequest;\r\nimport jakarta.servlet.http.HttpServletResponse;\r\nimport java.util.ArrayList;\r\nimport java.util.Date;\r\nimport model.classes.Classes;\r\nimport model.question.Question;\r\nimport model.subject.Subject;\r\nimport model.user.User;\r\n\r\n@WebServlet(name = \"DashboardServlet\", urlPatterns = {\"/dashboard\"})\r\npublic class DashboardServlet extends HttpServlet {\r\n\r\n    UserDAO userDAO = new UserDAO();\r\n    SubjectDAO subjectDAO = new SubjectDAO();\r\n    ClassDAO classDAO = new ClassDAO();\r\n    QuestionDAO questionDAO = new QuestionDAO();\r\n\r\n    protected void processRequest(HttpServletRequest request, HttpServletResponse response)\r\n            throws ServletException, IOException {\r\n        response.setContentType(\"text/html;charset=UTF-8\");\r\n        try (PrintWriter out = response.getWriter()) {\r\n            /* TODO output your page here. You may use following sample code. */\r\n            out.println(\"<!DOCTYPE html>\");\r\n            out.println(\"<html>\");\r\n            out.println(\"<head>\");\r\n            out.println(\"<title>Servlet DashboardServlet</title>\");\r\n            out.println(\"</head>\");\r\n            out.println(\"<body>\");\r\n            out.println(\"<h1>Servlet DashboardServlet at \" + request.getContextPath() + \"</h1>\");\r\n            out.println(\"</body>\");\r\n            out.println(\"</html>\");\r\n        }\r\n    }\r\n\r\n    private boolean isEqualDate(Date date1, Date date2) {\r\n        return date1.getDay() == date2.getDay() && date1.getMonth() == date2.getMonth()\r\n                && date1.getYear() == date2.getYear();\r\n    }\r\n\r\n    private void getUserStatistics(HttpServletRequest request) {\r\n        ArrayList<User> userList = userDAO.getAllUsers();\r\n        int newUsersToday = 0;\r\n        Date today = new Date();\r\n        for (User user : userList) {\r\n            if (isEqualDate(today, user.getDateCreated())) {\r\n                newUsersToday++;\r\n            }\r\n        }\r\n        request.setAttribute(\"newUsersToday\", newUsersToday);\r\n        request.setAttribute(\"userList\", userList);\r\n    }\r\n\r\n    private void getClassStastistic(HttpServletRequest request) {\r\n        ArrayList<Classes> classList = classDAO.getAllClasses();\r\n        request.setAttribute(\"classList\", classList);\r\n    }\r\n\r\n    private void getSubjectStastistics(HttpServletRequest request) {\r\n        ArrayList<Subject> subjectList = subjectDAO.getAllSubject();\r\n        request.setAttribute(\"subjectList\", subjectList);\r\n    }\r\n\r\n    private void getQuestionStastistic(HttpServletRequest request) {\r\n        ArrayList<Question> questionList = questionDAO.getAllQuestions();\r\n        request.setAttribute(\"questionList\", questionList);\r\n\r\n    }\r\n\r\n    private void getStatistic(HttpServletRequest request) {\r\n        getUserStatistics(request);\r\n        getSubjectStastistics(request);\r\n        getClassStastistic(request);\r\n        getQuestionStastistic(request);\r\n    }\r\n\r\n    @Override\r\n    protected void doGet(HttpServletRequest request, HttpServletResponse response)\r\n            throws ServletException, IOException {\r\n        getStatistic(request);\r\n        request.getRequestDispatcher(\"/dashboard.jsp\").forward(request, response);\r\n    }\r\n\r\n    @Override\r\n    protected void doPost(HttpServletRequest request, HttpServletResponse response)\r\n            throws ServletException, IOException {\r\n        processRequest(request, response);\r\n    }\r\n\r\n    @Override\r\n    public String getServletInfo() {\r\n        return \"Short description\";\r\n    }// </editor-fold>\r\n\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/java/controller/dashboard/DashboardServlet.java b/src/java/controller/dashboard/DashboardServlet.java
--- a/src/java/controller/dashboard/DashboardServlet.java	(revision d6ad1445e1c07c5da0ab8951156084fe4a182d1f)
+++ b/src/java/controller/dashboard/DashboardServlet.java	(date 1721252670148)
@@ -1,4 +1,3 @@
-package controller.dashboard;
 
 import dal.*;
 import java.io.IOException;
@@ -8,10 +7,11 @@
 import jakarta.servlet.http.HttpServlet;
 import jakarta.servlet.http.HttpServletRequest;
 import jakarta.servlet.http.HttpServletResponse;
+import jakarta.servlet.http.HttpSession;
 import java.util.ArrayList;
 import java.util.Date;
 import model.classes.Classes;
-import model.question.Question;
+import model.Question;
 import model.subject.Subject;
 import model.user.User;
 
@@ -84,14 +84,34 @@
     @Override
     protected void doGet(HttpServletRequest request, HttpServletResponse response)
             throws ServletException, IOException {
-        getStatistic(request);
-        request.getRequestDispatcher("/dashboard.jsp").forward(request, response);
+        String contextPath = request.getServletContext().getContextPath();
+        String loginPage = contextPath + "/login.jsp";
+        String homePage = contextPath + "/home";
+        HttpSession session = request.getSession();
+        User user = (User) session.getAttribute("user");
+        if (user == null) {
+            response.sendRedirect(loginPage);
+        } else {
+            User u = userDAO.getUserById(user.getId());
+            if (u != null && u.getEmail() != null) {
+                session.setAttribute("user", u);
+                if (user.getRole() > 1) {
+                    response.sendRedirect(homePage);
+                } else {
+                    getStatistic(request);
+                    request.getRequestDispatcher("/WEB-INF/dashboard/dashboard.jsp").forward(request, response);
+                }
+            } else {
+                response.sendRedirect(loginPage);
+            }
+        }
+
     }
 
     @Override
     protected void doPost(HttpServletRequest request, HttpServletResponse response)
             throws ServletException, IOException {
-        processRequest(request, response);
+        doGet(request, response);
     }
 
     @Override
Index: nbproject/private/private.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<project-private xmlns=\"http://www.netbeans.org/ns/project-private/1\">\r\n    <editor-bookmarks xmlns=\"http://www.netbeans.org/ns/editor-bookmarks/2\" lastBookmarkId=\"0\"/>\r\n    <open-files xmlns=\"http://www.netbeans.org/ns/projectui-open-files/2\">\r\n        <group>\r\n            <file>file:/C:/Users/PC/Documents/SWP%20documents/se1808-g6/src/java/controller/flashcard/FlashcardTest.java</file>\r\n            <file>file:/C:/Users/PC/Documents/SWP%20documents/se1808-g6/src/java/controller/flashcard/FlashcardMatch.java</file>\r\n            <file>file:/C:/Users/PC/Documents/SWP%20documents/se1808-g6/src/java/controller/course/CourseNewAnnouncement.java</file>\r\n            <file>file:/C:/Users/PC/Documents/SWP%20documents/se1808-g6/src/java/controller/flashcard/FlashcardLearn.java</file>\r\n            <file>file:/C:/Users/PC/Documents/SWP%20documents/se1808-g6/src/java/controller/user/UserDashboardController.java</file>\r\n        </group>\r\n    </open-files>\r\n</project-private>\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/nbproject/private/private.xml b/nbproject/private/private.xml
--- a/nbproject/private/private.xml	(revision d6ad1445e1c07c5da0ab8951156084fe4a182d1f)
+++ b/nbproject/private/private.xml	(date 1721252679014)
@@ -3,11 +3,16 @@
     <editor-bookmarks xmlns="http://www.netbeans.org/ns/editor-bookmarks/2" lastBookmarkId="0"/>
     <open-files xmlns="http://www.netbeans.org/ns/projectui-open-files/2">
         <group>
-            <file>file:/C:/Users/PC/Documents/SWP%20documents/se1808-g6/src/java/controller/flashcard/FlashcardTest.java</file>
-            <file>file:/C:/Users/PC/Documents/SWP%20documents/se1808-g6/src/java/controller/flashcard/FlashcardMatch.java</file>
-            <file>file:/C:/Users/PC/Documents/SWP%20documents/se1808-g6/src/java/controller/course/CourseNewAnnouncement.java</file>
-            <file>file:/C:/Users/PC/Documents/SWP%20documents/se1808-g6/src/java/controller/flashcard/FlashcardLearn.java</file>
-            <file>file:/C:/Users/PC/Documents/SWP%20documents/se1808-g6/src/java/controller/user/UserDashboardController.java</file>
+            <file>file:/E:/Program%20Files/NetBeansProjects/se1808-g6/src/java/controller/UserServlet.java</file>
+            <file>file:/E:/Program%20Files/NetBeansProjects/se1808-g6/src/java/controller/LessonServlet.java</file>
+            <file>file:/E:/Program%20Files/NetBeansProjects/se1808-g6/src/java/controller/material/MaterialServlet.java</file>
+            <file>file:/E:/Program%20Files/NetBeansProjects/se1808-g6/src/java/model/Material.java</file>
+            <file>file:/E:/Program%20Files/NetBeansProjects/se1808-g6/src/java/dal/MaterialDAO.java</file>
+            <file>file:/E:/Program%20Files/NetBeansProjects/se1808-g6/web/WEB-INF/views/question/newquestion.jsp</file>
+            <file>file:/E:/Program%20Files/NetBeansProjects/se1808-g6/src/java/controller/DashboardServlet.java</file>
+            <file>file:/E:/Program%20Files/NetBeansProjects/se1808-g6/web/WEB-INF/views/material/materiallist.jsp</file>
+            <file>file:/E:/Program%20Files/NetBeansProjects/se1808-g6/src/java/common/FileHandler.java</file>
+            <file>file:/E:/Program%20Files/NetBeansProjects/se1808-g6/web/WEB-INF/views/lesson/lessondetails.jsp</file>
         </group>
     </open-files>
 </project-private>
Index: src/java/controller/QuestionServlet.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package controller;\r\n\r\nimport model.Question;\r\nimport model.Answer;\r\nimport common.ReadQuestionFromXlsFile;\r\nimport dal.*;\r\nimport java.io.IOException;\r\nimport java.io.PrintWriter;\r\nimport java.sql.SQLException;\r\nimport jakarta.servlet.ServletException;\r\nimport jakarta.servlet.annotation.MultipartConfig;\r\nimport jakarta.servlet.annotation.WebServlet;\r\nimport jakarta.servlet.http.HttpServlet;\r\nimport jakarta.servlet.http.HttpServletRequest;\r\nimport jakarta.servlet.http.HttpServletResponse;\r\nimport jakarta.servlet.http.HttpSession;\r\nimport jakarta.servlet.http.Part;\r\nimport java.util.ArrayList;\r\nimport java.util.Collections;\r\nimport model.Lesson;\r\nimport model.user.User;\r\n\r\n@MultipartConfig\r\n@WebServlet(name = \"QuestionServlet\", urlPatterns = {\"/question\", \"/question/details\", \"/question/update\", \"/question/new\"})\r\npublic class QuestionServlet extends HttpServlet {\r\n\r\n    ArrayList<Answer> answerList;\r\n    int lastAnswerId;\r\n    private final int rowPerPage = 6;\r\n\r\n    protected void processRequest(HttpServletRequest request, HttpServletResponse response)\r\n            throws ServletException, IOException {\r\n        response.setContentType(\"text/html;charset=UTF-8\");\r\n        try (PrintWriter out = response.getWriter()) {\r\n            /* TODO output your page here. You may use following sample code. */\r\n            out.println(\"<!DOCTYPE html>\");\r\n            out.println(\"<html>\");\r\n            out.println(\"<head>\");\r\n            out.println(\"<title>Servlet QuestionServlet</title>\");\r\n            out.println(\"</head>\");\r\n            out.println(\"<body>\");\r\n            out.println(\"<h1>Servlet QuestionServlet at \" + request.getContextPath() + \"</h1>\");\r\n            out.println(\"</body>\");\r\n            out.println(\"</html>\");\r\n        }\r\n    }\r\n\r\n    QuestionDAO questionDAO = new QuestionDAO();\r\n    AnswerDAO answerDAO = new AnswerDAO();\r\n    LessonDAO lessonDAO = new LessonDAO();\r\n    SubjectDAO subjectDAO = new SubjectDAO();\r\n    ReadQuestionFromXlsFile reader = new ReadQuestionFromXlsFile();\r\n\r\n    void refreshSession(HttpServletRequest request) {\r\n        HttpSession session = request.getSession();\r\n        session.setAttribute(\"user\", session.getAttribute(\"user\"));\r\n    }\r\n\r\n    @Override\r\n    protected void doGet(HttpServletRequest request, HttpServletResponse response)\r\n            throws ServletException, IOException {\r\n        doPost(request, response);\r\n    }\r\n\r\n    @Override\r\n    protected void doPost(HttpServletRequest request, HttpServletResponse response)\r\n            throws ServletException, IOException {\r\n        /*\r\n        HttpSession session = request.getSession();\r\n        User user = (User) session.getAttribute(\"user\");\r\n        if (user == null) {\r\n            response.sendRedirect(request.getContextPath() + \"/login.jsp\");\r\n        } else if (user.getRole() != 0) {\r\n            response.sendRedirect(\"../home\");\r\n        } else {\r\n            refreshSession(request);\r\n         */\r\n        String action = request.getServletPath();\r\n        switch (action) {\r\n            case \"/question\":\r\n                viewQuestionList(request, response);\r\n                break;\r\n            case \"/question/details\":\r\n                viewQuestionDetails(request, response);\r\n                break;\r\n            case \"/question/update\":\r\n                updateQuestion(request, response);\r\n                break;\r\n            case \"/question/new\":\r\n                newQuestion(request, response);\r\n                break;\r\n        }\r\n\r\n    }\r\n\r\n    private ArrayList<Question> getAllMatchKeyWord(ArrayList<Question> list, String keyWord) {\r\n        ArrayList<Question> ret = new ArrayList<>();\r\n        keyWord = keyWord.toLowerCase();\r\n        for (Question q : list) {\r\n            if (q.getContent().toLowerCase().contains(keyWord)) {\r\n                ret.add(q);\r\n            }\r\n        }\r\n        return ret;\r\n    }\r\n\r\n    private int getNoOfPages(ArrayList<Question> list) {\r\n        int length = list.size();\r\n        if (length == 0) {\r\n            return 1;\r\n        }\r\n        int noOfPages = length / rowPerPage;\r\n        if (length % rowPerPage == 0) {\r\n            return noOfPages;\r\n        }\r\n        return noOfPages + 1;\r\n    }\r\n\r\n    private int getPage(HttpServletRequest request, int noOfPages) {\r\n        String cur = request.getParameter(\"currentPage\");\r\n        if ((cur == null) || (cur.isEmpty())) {\r\n            return 1;\r\n        }\r\n\r\n        int currentPage = Integer.parseInt(cur);\r\n        switch (request.getParameter(\"pageAction\")) {\r\n            case \"firstPage\":\r\n                return 1;\r\n            case \"prevPage\": {\r\n                currentPage--;\r\n                if (currentPage < 1) {\r\n                    return 1;\r\n                } else {\r\n                    return currentPage;\r\n                }\r\n            }\r\n            case \"nextPage\": {\r\n                currentPage++;\r\n                if (currentPage > noOfPages) {\r\n                    return noOfPages;\r\n                } else {\r\n                    return currentPage;\r\n                }\r\n            }\r\n            case \"lastPage\":\r\n                return noOfPages;\r\n        }\r\n\r\n        String newpage = request.getParameter(\"newPage\");\r\n        if ((newpage != null) && (!newpage.isEmpty())) {\r\n            int newPage = Integer.parseInt(newpage);\r\n            return newPage;\r\n        }\r\n        return currentPage;\r\n\r\n    }\r\n\r\n    private ArrayList<Question> getAllQuestionsOfPage(int page, ArrayList<Question> list) {\r\n        ArrayList<Question> ret = new ArrayList<>();\r\n        int start = rowPerPage * (page - 1) + 1;\r\n        int end = rowPerPage * page;\r\n        if (start < 1) {\r\n            start = 1;\r\n        }\r\n        if (end > list.size()) {\r\n            end = list.size();\r\n        }\r\n\r\n        for (int i = start - 1; i < end; i++) {\r\n            ret.add(list.get(i));\r\n        }\r\n        return ret;\r\n    }\r\n\r\n    private void viewQuestionList(HttpServletRequest request, HttpServletResponse response)\r\n            throws ServletException, IOException {\r\n\r\n        ArrayList<Question> list = null;\r\n\r\n        String sid = request.getParameter(\"subjectid\");\r\n        if ((sid != null) && (!sid.equals(\"All subjects\")) && (!sid.isEmpty())) {\r\n            int subjectId = Integer.parseInt(sid);\r\n            request.setAttribute(\"subject\", subjectDAO.getSubjectMatchId(subjectId));\r\n            request.setAttribute(\"lessonList\", lessonDAO.getAllLesson(subjectId));\r\n\r\n            String lid = request.getParameter(\"lessonId\");\r\n            if ((lid != null) && (!lid.equals(\"All lessons\")) && (!lid.isEmpty())) {\r\n                int lessonId = Integer.parseInt(lid);\r\n                Lesson lesson = lessonDAO.getLessonMatchId(lessonId);\r\n                if (lesson.getSubjectId() == subjectId) {\r\n                    request.setAttribute(\"lesson\", lessonDAO.getLessonMatchId(lessonId));\r\n                    list = questionDAO.getAllQuestionsOfALesson(lessonId);\r\n                } else {\r\n                    list = questionDAO.getAllQuestionsOfASubject(subjectId);\r\n                }\r\n            } else {\r\n                list = questionDAO.getAllQuestionsOfASubject(subjectId);\r\n            }\r\n\r\n        } else {\r\n            String lid = request.getParameter(\"lessonId\");\r\n            if ((lid != null) && (!lid.equals(\"All lessons\")) && (!lid.isEmpty())) {\r\n                int lessonId = Integer.parseInt(lid);\r\n                request.setAttribute(\"lesson\", lessonDAO.getLessonMatchId(lessonId));\r\n                list = questionDAO.getAllQuestionsOfALesson(lessonId);\r\n            } else {\r\n                list = questionDAO.getAllQuestions();\r\n            }\r\n\r\n            request.setAttribute(\"lessonList\", lessonDAO.getAllLessons());\r\n        }\r\n\r\n        String keyWord = request.getParameter(\"keyword\");\r\n        if (keyWord != null) {\r\n            list = getAllMatchKeyWord(list, keyWord);\r\n        }\r\n\r\n        String sortBy = request.getParameter(\"sortBy\");\r\n        if (sortBy != null) {\r\n            switch (sortBy) {\r\n                case \"none\":\r\n                    break;\r\n                case \"content\":\r\n                    Collections.sort(list, new Question.SortByContent());\r\n                    break;\r\n                case \"subject\":\r\n                    Collections.sort(list, new Question.SortBySubject());\r\n                    break;\r\n                case \"lesson\":\r\n                    Collections.sort(list, new Question.SortByLesson());\r\n                    break;\r\n                case \"status\":\r\n                    Collections.sort(list, new Question.SortByStatus());\r\n                    break;\r\n            }\r\n        }\r\n\r\n        int noOfPages = getNoOfPages(list);\r\n        int currentPage = getPage(request, noOfPages);\r\n        list = getAllQuestionsOfPage(currentPage, list);\r\n\r\n        request.setAttribute(\"currentPage\", currentPage);\r\n        request.setAttribute(\"noOfPages\", noOfPages);\r\n        request.setAttribute(\"sortBy\", sortBy);\r\n        request.setAttribute(\"list\", list);\r\n        request.setAttribute(\"keyword\", keyWord);\r\n        request.setAttribute(\"subjectList\", subjectDAO.getAllSubject());\r\n        request.getRequestDispatcher(\"/WEB-INF/views/question/questionlist.jsp\").forward(request, response);\r\n    }\r\n\r\n    private void viewQuestionDetails(HttpServletRequest request, HttpServletResponse response)\r\n            throws ServletException, IOException {\r\n        int questionId = Integer.parseInt(request.getParameter(\"questionId\"));\r\n        Question question = questionDAO.getQuestionMatchId(questionId);\r\n        if (question == null) {\r\n            response.sendRedirect(\"../question\");\r\n        } else {\r\n            ArrayList<Answer> answer = answerDAO.getAllAnswersOfAQuestion(questionId);\r\n            request.setAttribute(\"question\", question);\r\n            request.setAttribute(\"answers\", answer);\r\n            request.getRequestDispatcher(\"/WEB-INF/views/question/questiondetails.jsp\").forward(request, response);\r\n        }\r\n    }\r\n\r\n    private void updateAnswer(HttpServletRequest request, HttpServletResponse response, Question question)\r\n            throws IOException, ServletException {\r\n        ArrayList<Answer> answer = answerDAO.getAllAnswersOfAQuestion(question.getId());\r\n        boolean succesful = true;\r\n        for (Answer a : answer) {\r\n            String content = request.getParameter(String.valueOf(a.getId()));\r\n            a.setContent(content);\r\n            if (request.getParameter(a.getId() + \"isCorrect\") != null) {\r\n                a.setIsCorrect(true);\r\n            } else {\r\n                a.setIsCorrect(false);\r\n            }\r\n            try {\r\n                answerDAO.updateAnswer(a);\r\n\r\n            } catch (SQLException e) {\r\n                succesful = false;\r\n                System.out.println(e.getMessage());\r\n            }\r\n        }\r\n\r\n        if (succesful) {\r\n            response.sendRedirect(\"../question\");\r\n        } else {\r\n            request.setAttribute(\"err\", \"Update failed!\");\r\n            request.setAttribute(\"question\", question);\r\n            request.setAttribute(\"answers\", answer);\r\n            request.getRequestDispatcher(\"/WEB-INF/views/question/questiondetails.jsp\").forward(request, response);\r\n        }\r\n    }\r\n\r\n    private void changeQuestionStatus(Question question, HttpServletResponse response)\r\n            throws IOException {\r\n        try {\r\n            questionDAO.changeQuestionStatus(question);\r\n        } catch (SQLException e) {\r\n            System.out.println(e.getMessage());\r\n        }\r\n        response.sendRedirect(\"../question\");\r\n    }\r\n\r\n    private void updateQuestion(HttpServletRequest request, HttpServletResponse response)\r\n            throws IOException, ServletException {\r\n        int questionId = Integer.parseInt(request.getParameter(\"questionId\"));\r\n        System.out.println(questionId);\r\n        Question question = questionDAO.getQuestionMatchId(questionId);\r\n        if (question == null) {\r\n            response.sendRedirect(\"../question\");\r\n        } else {\r\n            switch (request.getParameter(\"action\")) {\r\n                case \"answerChange\":\r\n                    updateAnswer(request, response, question);\r\n                    break;\r\n                case \"changeStatus\":\r\n                    changeQuestionStatus(question, response);\r\n                    break;\r\n            }\r\n\r\n        }\r\n    }\r\n\r\n    private void newQuestionForm(HttpServletRequest request, HttpServletResponse response,\r\n            int subjectId, int lessonId) throws IOException, ServletException {\r\n        answerList = new ArrayList<>();\r\n        Answer a = new Answer();\r\n        a.setIsCorrect(false);\r\n        a.setId(1);\r\n        answerList.add(a);\r\n\r\n        Answer a1 = new Answer();\r\n        a1.setIsCorrect(false);\r\n        a1.setId(2);\r\n        answerList.add(a1);\r\n\r\n        lastAnswerId = 2;\r\n\r\n        if (subjectId != 0) {\r\n            request.setAttribute(\"subject\", subjectDAO.getSubjectMatchId(subjectId));\r\n            request.setAttribute(\"lessonList\", lessonDAO.getAllLesson(subjectId));\r\n        } else {\r\n            request.setAttribute(\"lessonList\", lessonDAO.getAllLessons());\r\n        }\r\n        if (lessonId != 0) {\r\n            request.setAttribute(\"lesson\", lessonDAO.getLessonMatchId(lessonId));\r\n        }\r\n\r\n        request.setAttribute(\"subjectList\", subjectDAO.getAllSubject());\r\n        request.setAttribute(\"answerList\", answerList);\r\n        request.getRequestDispatcher(\"/WEB-INF/views/question/newquestion.jsp\").forward(request, response);\r\n    }\r\n\r\n    private void getAnswerListInfo(HttpServletRequest request) {\r\n        for (Answer a : answerList) {\r\n            int id = a.getId();\r\n            a.setContent(request.getParameter(String.valueOf(id)));\r\n            if (request.getParameter(id + \"isCorrect\") != null) {\r\n                a.setIsCorrect(true);\r\n            } else {\r\n                a.setIsCorrect(false);\r\n            }\r\n        }\r\n    }\r\n\r\n    private void changeSubjectAndLesson(HttpServletRequest request, HttpServletResponse response,\r\n            int subjectId, int lessonId)\r\n            throws ServletException, IOException {\r\n        if (subjectId != 0) {\r\n            request.setAttribute(\"subject\", subjectDAO.getSubjectMatchId(subjectId));\r\n            request.setAttribute(\"lessonList\", lessonDAO.getAllLesson(subjectId));\r\n            if (lessonId != 0) {\r\n                Lesson l = lessonDAO.getLessonMatchId(lessonId);\r\n                if (l.getSubject().getId() == subjectId) {\r\n                    request.setAttribute(\"lesson\", l);\r\n                }\r\n            }\r\n        } else {\r\n            request.setAttribute(\"lessonList\", lessonDAO.getAllLessons());\r\n            if (lessonId != 0) {\r\n                request.setAttribute(\"lesson\", lessonDAO.getLessonMatchId(lessonId));\r\n            }\r\n        }\r\n        request.setAttribute(\"subjectList\", subjectDAO.getAllSubject());\r\n\r\n        getAnswerListInfo(request);\r\n        request.setAttribute(\"answerList\", answerList);\r\n        Question q = new Question();\r\n        q.setContent(request.getParameter(\"question\"));\r\n        request.setAttribute(\"question\", q);\r\n        request.getRequestDispatcher(\"/WEB-INF/views/question/newquestion.jsp\").forward(request, response);\r\n    }\r\n\r\n    private void addAnswer(HttpServletRequest request, HttpServletResponse response,\r\n            int subjectId, int lessonId) throws ServletException, IOException {\r\n        if (subjectId != 0) {\r\n            request.setAttribute(\"subject\", subjectDAO.getSubjectMatchId(subjectId));\r\n            request.setAttribute(\"lessonList\", lessonDAO.getAllLesson(subjectId));\r\n        } else {\r\n            request.setAttribute(\"lessonList\", lessonDAO.getAllLessons());\r\n        }\r\n        if (lessonId != 0) {\r\n            request.setAttribute(\"lesson\", lessonDAO.getLessonMatchId(lessonId));\r\n        }\r\n        request.setAttribute(\"subjectList\", subjectDAO.getAllSubject());\r\n\r\n        getAnswerListInfo(request);\r\n        lastAnswerId++;\r\n        Answer a = new Answer();\r\n        a.setId(lastAnswerId);\r\n        a.setIsCorrect(false);\r\n        answerList.add(a);\r\n        request.setAttribute(\"answerList\", answerList);\r\n\r\n        Question q = new Question();\r\n        q.setContent(request.getParameter(\"question\"));\r\n        request.setAttribute(\"question\", q);\r\n        request.getRequestDispatcher(\"/WEB-INF/views/question/newquestion.jsp\").forward(request, response);\r\n    }\r\n\r\n    private int getIndexById(int id) {\r\n        int index = 0;\r\n        for (Answer a : answerList) {\r\n            if (a.getId() == id) {\r\n                return index;\r\n            }\r\n            index++;\r\n        }\r\n        return index;\r\n    }\r\n\r\n    private void deleteAnswer(HttpServletRequest request, HttpServletResponse response,\r\n            int subjectId, int lessonId) throws ServletException, IOException {\r\n        if (subjectId != 0) {\r\n            request.setAttribute(\"subject\", subjectDAO.getSubjectMatchId(subjectId));\r\n            request.setAttribute(\"lessonList\", lessonDAO.getAllLesson(subjectId));\r\n        } else {\r\n            request.setAttribute(\"lessonList\", lessonDAO.getAllLessons());\r\n        }\r\n        if (lessonId != 0) {\r\n            request.setAttribute(\"lesson\", lessonDAO.getLessonMatchId(lessonId));\r\n        }\r\n        request.setAttribute(\"subjectList\", subjectDAO.getAllSubject());\r\n\r\n        getAnswerListInfo(request);\r\n        int deletedId = Integer.parseInt(request.getParameter(\"deletedId\"));\r\n        answerList.remove(getIndexById(deletedId));\r\n        request.setAttribute(\"answerList\", answerList);\r\n\r\n        Question q = new Question();\r\n        q.setContent(request.getParameter(\"question\"));\r\n        request.setAttribute(\"question\", q);\r\n        request.getRequestDispatcher(\"/WEB-INF/views/question/newquestion.jsp\").forward(request, response);\r\n    }\r\n\r\n    private void insertQuestion(HttpServletRequest request, HttpServletResponse response,\r\n            int subjectId, int lessonId) throws ServletException, IOException {\r\n        boolean successful = true;\r\n        Lesson lesson = null;\r\n        if (lessonId != 0) {\r\n            lesson = lessonDAO.getLessonMatchId(lessonId);\r\n            request.setAttribute(\"lesson\", lesson);\r\n        } else {\r\n            successful = false;\r\n            request.setAttribute(\"lessonErr\", \"Please choose a lesson\");\r\n        }\r\n        getAnswerListInfo(request);\r\n        Question q = new Question();\r\n        q.setContent(request.getParameter(\"question\"));\r\n        if (q.getContent().isEmpty()) {\r\n            successful = false;\r\n            request.setAttribute(\"questionErr\", \"Question cannot be blank!\");\r\n        }\r\n        if (q.getContent().length() > 255) {\r\n            successful = false;\r\n            request.setAttribute(\"questionErr\", \"Question content can not exceed 255 characters!\");\r\n        }\r\n\r\n        int nonEmptyAnswers = 0;\r\n        int checked = 0;\r\n        for (Answer a : answerList) {\r\n            if (!a.getContent().isEmpty()) {\r\n                nonEmptyAnswers++;\r\n                if (a.getContent().length() > 255) {\r\n                    successful = false;\r\n                    request.setAttribute(\"answerErr\", \"Please enter answer within 255 characters!\");\r\n                    break;\r\n                } else {\r\n                    if (a.isIsCorrect()) {\r\n                        checked++;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        if (nonEmptyAnswers < 2) {\r\n            successful = false;\r\n            request.setAttribute(\"answerErr\", \"Please enter at least 2 answers!\");\r\n        } else {\r\n            if (checked == 0) {\r\n                request.setAttribute(\"answerErr\", \"Please select at least one correct answer!\");\r\n            }\r\n        }\r\n\r\n        if (successful) {\r\n            q.setLesson(lesson);\r\n            q.setStatus(true);\r\n            questionDAO.insertQuestion(q);\r\n            for (Answer a : answerList) {\r\n                answerDAO.insertAnswer(a, q);\r\n            }\r\n            response.sendRedirect(\"../question\");\r\n        } else {\r\n            if (subjectId != 0) {\r\n                request.setAttribute(\"subject\", subjectDAO.getSubjectMatchId(subjectId));\r\n                request.setAttribute(\"lessonList\", lessonDAO.getAllLesson(subjectId));\r\n            } else {\r\n                request.setAttribute(\"lessonList\", lessonDAO.getAllLessons());\r\n            }\r\n            request.setAttribute(\"subjectList\", subjectDAO.getAllSubject());\r\n            request.setAttribute(\"answerList\", answerList);\r\n            request.setAttribute(\"question\", q);\r\n            request.getRequestDispatcher(\"/WEB-INF/views/question/newquestion.jsp\").forward(request, response);\r\n        }\r\n\r\n    }\r\n\r\n    private void insertQuestionByFile(HttpServletRequest request, HttpServletResponse response,\r\n            int subjectId, int lessonId) throws ServletException, IOException {\r\n        boolean successful = true;\r\n        Lesson lesson = null;\r\n        if (lessonId != 0) {\r\n            lesson = lessonDAO.getLessonMatchId(lessonId);\r\n            request.setAttribute(\"lesson\", lesson);\r\n            Part filePart = request.getPart(\"file\");\r\n            if ((filePart == null) || (filePart.getSize() == 0)) {\r\n                successful = false;\r\n                request.setAttribute(\"fileErr\", \"Please choose a file!\");\r\n            } else {\r\n                try {\r\n                    reader.readQuestionFromFile(filePart, lesson);\r\n                } catch (IOException e) {\r\n                    successful = false;\r\n                    request.setAttribute(\"fileErr\", \"Import file failed!\");\r\n                }\r\n            }\r\n        } else {\r\n            successful = false;\r\n            request.setAttribute(\"lessonErr\", \"Please choose a lesson\");\r\n        }\r\n\r\n        if (successful) {\r\n            response.sendRedirect(\"../question\");\r\n        } else {\r\n            if (subjectId != 0) {\r\n                request.setAttribute(\"subject\", subjectDAO.getSubjectMatchId(subjectId));\r\n                request.setAttribute(\"lessonList\", lessonDAO.getAllLesson(subjectId));\r\n            } else {\r\n                request.setAttribute(\"lessonList\", lessonDAO.getAllLessons());\r\n            }\r\n            request.setAttribute(\"subjectList\", subjectDAO.getAllSubject());\r\n            request.setAttribute(\"answerList\", answerList);\r\n            Question q = new Question();\r\n            q.setContent(request.getParameter(\"question\"));\r\n            request.setAttribute(\"question\", q);\r\n            request.getRequestDispatcher(\"/WEB-INF/views/question/newquestion.jsp\").forward(request, response);\r\n        }\r\n    }\r\n\r\n    private void newQuestion(HttpServletRequest request, HttpServletResponse response)\r\n            throws ServletException, IOException {\r\n        int subjectId = 0, lessonId = 0;\r\n        String sid = request.getParameter(\"subjectId\");\r\n        if ((sid != null) && (!sid.isEmpty()) && (!sid.equals(\"All subjects\"))) {\r\n            subjectId = Integer.parseInt(sid);\r\n        }\r\n        String lid = request.getParameter(\"lessonId\");\r\n        if ((lid != null) && (!lid.isEmpty()) && (!lid.equals(\"All lessons\"))) {\r\n            lessonId = Integer.parseInt(lid);\r\n        }\r\n\r\n        switch (request.getParameter(\"action\")) {\r\n            case \"newQuestion\":\r\n                request.setAttribute(\"currentPage\", \"enterData\");\r\n                newQuestionForm(request, response, subjectId, lessonId);\r\n                break;\r\n            case \"changeSubjectAndLesson\":\r\n                request.setAttribute(\"currentPage\", request.getParameter(\"currentPage\"));\r\n                changeSubjectAndLesson(request, response, subjectId, lessonId);\r\n                break;\r\n            case \"addAnswer\":\r\n                request.setAttribute(\"currentPage\", \"enterData\");\r\n                addAnswer(request, response, subjectId, lessonId);\r\n                break;\r\n            case \"deleteAnswer\":\r\n                request.setAttribute(\"currentPage\", \"enterData\");\r\n                deleteAnswer(request, response, subjectId, lessonId);\r\n                break;\r\n            case \"insertQuestion\":\r\n                request.setAttribute(\"currentPage\", \"enterData\");\r\n                insertQuestion(request, response, subjectId, lessonId);\r\n                break;\r\n            case \"insertQuestionByFile\":\r\n                request.setAttribute(\"currentPage\", \"importFile\");\r\n                insertQuestionByFile(request, response, subjectId, lessonId);\r\n                break;\r\n        }\r\n    }\r\n\r\n    @Override\r\n    public String getServletInfo() {\r\n        return \"Short description\";\r\n    }// </editor-fold>\r\n\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/java/controller/QuestionServlet.java b/src/java/controller/QuestionServlet.java
--- a/src/java/controller/QuestionServlet.java	(revision d6ad1445e1c07c5da0ab8951156084fe4a182d1f)
+++ b/src/java/controller/QuestionServlet.java	(date 1721252670148)
@@ -51,11 +51,6 @@
     SubjectDAO subjectDAO = new SubjectDAO();
     ReadQuestionFromXlsFile reader = new ReadQuestionFromXlsFile();
 
-    void refreshSession(HttpServletRequest request) {
-        HttpSession session = request.getSession();
-        session.setAttribute("user", session.getAttribute("user"));
-    }
-
     @Override
     protected void doGet(HttpServletRequest request, HttpServletResponse response)
             throws ServletException, IOException {
@@ -65,32 +60,41 @@
     @Override
     protected void doPost(HttpServletRequest request, HttpServletResponse response)
             throws ServletException, IOException {
-        /*
+        String contextPath = request.getServletContext().getContextPath();
+        String loginPage = contextPath + "/login.jsp";
+        String homePage = contextPath + "/home";
+        UserDAO userDAO = new UserDAO();
         HttpSession session = request.getSession();
         User user = (User) session.getAttribute("user");
         if (user == null) {
-            response.sendRedirect(request.getContextPath() + "/login.jsp");
-        } else if (user.getRole() != 0) {
-            response.sendRedirect("../home");
+            response.sendRedirect(loginPage);
         } else {
-            refreshSession(request);
-         */
-        String action = request.getServletPath();
-        switch (action) {
-            case "/question":
-                viewQuestionList(request, response);
-                break;
-            case "/question/details":
-                viewQuestionDetails(request, response);
-                break;
-            case "/question/update":
-                updateQuestion(request, response);
-                break;
-            case "/question/new":
-                newQuestion(request, response);
-                break;
+            User u = userDAO.getUserById(user.getId());
+            if (u != null && u.getEmail() != null) {
+                session.setAttribute("user", u);
+                if (user.getRole() > 1) {
+                    response.sendRedirect(homePage);
+                } else {
+                    String action = request.getServletPath();
+                    switch (action) {
+                        case "/question":
+                            viewQuestionList(request, response);
+                            break;
+                        case "/question/details":
+                            viewQuestionDetails(request, response);
+                            break;
+                        case "/question/update":
+                            updateQuestion(request, response);
+                            break;
+                        case "/question/new":
+                            newQuestion(request, response);
+                            break;
+                    }
+                }
+            } else {
+                response.sendRedirect(loginPage);
+            }
         }
-
     }
 
     private ArrayList<Question> getAllMatchKeyWord(ArrayList<Question> list, String keyWord) {
Index: src/java/model/Lesson.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package model;\r\n\r\nimport model.subject.Subject;\r\n\r\npublic class Lesson {\r\n\r\n    int id, subjectId, order;\r\n    String name;\r\n    boolean status;\r\n    Subject subject;\r\n\r\n    public Lesson() {\r\n    }\r\n\r\n    public Lesson(int id, int subjectId, int order, String name, boolean status, Subject subject) {\r\n        this.id = id;\r\n        this.subjectId = subjectId;\r\n        this.order = order;\r\n        this.name = name;\r\n        this.status = status;\r\n        this.subject = subject;\r\n    }\r\n\r\n    public int getOrder() {\r\n        return order;\r\n    }\r\n\r\n    public void setOrder(int order) {\r\n        this.order = order;\r\n    }\r\n\r\n    public boolean isStatus() {\r\n        return status;\r\n    }\r\n\r\n    public void setStatus(boolean status) {\r\n        this.status = status;\r\n    }\r\n\r\n    public Subject getSubject() {\r\n        return subject;\r\n    }\r\n\r\n    public void setSubject(Subject subject) {\r\n        this.subject = subject;\r\n    }\r\n\r\n    public int getId() {\r\n        return id;\r\n    }\r\n\r\n    public void setId(int id) {\r\n        this.id = id;\r\n    }\r\n\r\n    public int getSubjectId() {\r\n        return subjectId;\r\n    }\r\n\r\n    public void setSubjectId(int subjectId) {\r\n        this.subjectId = subjectId;\r\n    }\r\n\r\n    public String getName() {\r\n        return name;\r\n    }\r\n\r\n    public void setName(String name) {\r\n        this.name = name;\r\n    }\r\n\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/java/model/Lesson.java b/src/java/model/Lesson.java
--- a/src/java/model/Lesson.java	(revision d6ad1445e1c07c5da0ab8951156084fe4a182d1f)
+++ b/src/java/model/Lesson.java	(date 1721252670159)
@@ -1,5 +1,6 @@
 package model;
 
+import java.util.Comparator;
 import model.subject.Subject;
 
 public class Lesson {
@@ -69,4 +70,45 @@
         this.name = name;
     }
 
+    public static class SortByName implements Comparator<Lesson> {
+
+        @Override
+        public int compare(Lesson l1, Lesson l2) {
+            return l1.getName().compareTo(l2.getName());
+        }
+
+    }
+
+    public static class SortByStatus implements Comparator<Lesson> {
+
+        @Override
+        public int compare(Lesson l1, Lesson l2) {
+            if (l1.isStatus() == l2.isStatus()) {
+                return 0;
+            }
+            if (l1.isStatus() && !l2.isStatus()) {
+                return -1;
+            }
+            return 1;
+        }
+
+    }
+
+    public static class SortBySubject implements Comparator<Lesson> {
+
+        @Override
+        public int compare(Lesson l1, Lesson l2) {
+            return l1.getSubjectId() - l2.getSubjectId();
+        }
+
+    }
+
+    public static class SortByOrder implements Comparator<Lesson> {
+
+        @Override
+        public int compare(Lesson l1, Lesson l2) {
+            return l1.getSubjectId() - l2.getSubjectId();
+        }
+    }
+
 }
Index: web/WEB-INF/common/sider.jsp
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><%@page isELIgnored=\"false\" %>\r\n<%@taglib prefix=\"c\" uri=\"http://java.sun.com/jsp/jstl/core\" %>\r\n<%@page contentType=\"text/html\" pageEncoding=\"UTF-8\"%>\r\n<html\r\n    lang=\"en\"\r\n    class=\"light-style layout-menu-fixed layout-compact\"\r\n    dir=\"ltr\"\r\n    data-theme=\"theme-default\"\r\n    data-assets-path=\"assets/\"\r\n    data-template=\"vertical-menu-template-free\">\r\n    <head>\r\n        <meta charset=\"utf-8\" />\r\n        <meta\r\n            name=\"viewport\"\r\n            content=\"width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0\" />\r\n\r\n        <title>Dashboard</title>\r\n\r\n        <meta name=\"description\" content=\"\" />\r\n\r\n        <!-- Favicon -->\r\n        <link rel=\"icon\" type=\"image/x-icon\" href=\"assets/img/favicon/favicon.ico\" />\r\n\r\n        <!-- Fonts -->\r\n        <link rel=\"preconnect\" href=\"https://fonts.googleapis.com\" />\r\n        <link rel=\"preconnect\" href=\"https://fonts.gstatic.com\" crossorigin />\r\n        <link\r\n            href=\"https://fonts.googleapis.com/css2?family=Public+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&display=swap\"\r\n            rel=\"stylesheet\" />\r\n\r\n        <link rel=\"stylesheet\" href=\"assets/vendor/fonts/boxicons.css\" />\r\n\r\n        <!-- Core CSS -->\r\n        <link rel=\"stylesheet\" href=\"assets/vendor/css/core.css\" class=\"template-customizer-core-css\" />\r\n        <link rel=\"stylesheet\" href=\"assets/vendor/css/theme-default.css\" class=\"template-customizer-theme-css\" />\r\n        <link rel=\"stylesheet\" href=\"assets/css/demo.css\" />\r\n\r\n        <!-- Vendors CSS -->\r\n        <link rel=\"stylesheet\" href=\"assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.css\" />\r\n        <link rel=\"stylesheet\" href=\"assets/vendor/libs/apex-charts/apex-charts.css\" />\r\n\r\n        <!-- Page CSS -->\r\n\r\n        <!-- Helpers -->\r\n        <script src=\"assets/vendor/js/helpers.js\"></script>\r\n        <!--! Template customizer & Theme config files MUST be included after core stylesheets and helpers.js in the <head> section -->\r\n        <!--? Config:  Mandatory theme config file contain global vars & default theme options, Set your preferred theme option in this file.  -->\r\n        <script src=\"assets/js/config.js\"></script>\r\n    </head>\r\n\r\n    <body>\r\n        <c:set var=\"currentPage\" value=\"${pageContext.request.requestURI}\"></c:set>\r\n            <!-- Layout wrapper -->\r\n            <!-- Menu -->\r\n\r\n            <aside id=\"layout-menu\" class=\"layout-menu menu-vertical menu bg-menu-theme\">\r\n                <div class=\"app-brand demo\">\r\n                    <a href=\"${pageContext.request.contextPath}/home\" class=\"app-brand-link\">\r\n                    <h1 class=\"m-0 text-uppercase text-primary\"><i class=\"fa fa-book-reader mr-3\"></i>KRS</h1>\r\n                </a>\r\n\r\n                <a href=\"javascript:void(0);\" class=\"layout-menu-toggle menu-link text-large ms-auto d-block d-xl-none\">\r\n                    <i class=\"bx bx-chevron-left bx-sm align-middle\"></i>\r\n                </a>\r\n            </div>\r\n\r\n            <div class=\"menu-inner-shadow\"></div>\r\n\r\n            <ul class=\"menu-inner py-1\">\r\n\r\n                <li class=\"menu-header small text-uppercase\">\r\n                    <span class=\"menu-header-text\">Administration</span>\r\n                </li>\r\n                <!-- Apps -->\r\n                <li class=\"menu-item\" id=\"user-menu-item\">\r\n                    <a href=\"${pageContext.request.contextPath}/user\" class=\"menu-link\">\r\n                        <i class=\"menu-icon tf-icons bx bx-user\"></i>\r\n                        <div data-i18n=\"User list\">User list</div>\r\n                    </a>\r\n                </li>\r\n                <li class=\"menu-item\" id=\"subjectlist-menu-item\">\r\n                    <a href=\"${pageContext.request.contextPath}/subjectlist\" class=\"menu-link\">\r\n                        <i class=\"menu-icon tf-icons bx bx-book-open\"></i>\r\n                        <div data-i18n=\"Subject list\">Subject list</div>\r\n                    </a>\r\n                </li>\r\n                <li class=\"menu-item\" id=\"classlist-menu-item\">\r\n                    <a href=\"${pageContext.request.contextPath}/classlist\" class=\"menu-link\">\r\n                        <i class=\"menu-icon tf-icons bx bx-chalkboard\"></i>\r\n                        <div data-i18n=\"Class list\">Class list</div>\r\n                    </a>\r\n                </li>\r\n                <li class=\"menu-item\" id=\"lesson-menu-item\">\r\n                    <a href=\"${pageContext.request.contextPath}/lesson\" class=\"menu-link\">\r\n                        <i class=\"menu-icon tf-icons bx bx-book-alt\"></i>\r\n                        <div data-i18n=\"Lesson list\">Lesson list</div>\r\n                    </a>\r\n                </li>\r\n                <li class=\"menu-item\" id=\"question-menu-item\">\r\n                    <a href=\"${pageContext.request.contextPath}/question\" class=\"menu-link\">\r\n                        <i class=\"menu-icon tf-icons bx bx-question-mark\"></i>\r\n                        <div data-i18n=\"Question list\">Question list</div>\r\n                    </a>\r\n                </li>\r\n\r\n                <li class=\"menu-header small text-uppercase\">\r\n                    <span class=\"menu-header-text\">Navigation</span>\r\n                </li>\r\n\r\n                <li class=\"menu-item\">\r\n                    <a href=\"${pageContext.request.contextPath}/home\" class=\"menu-link\">\r\n                        <i class=\"menu-icon tf-icons bx bx-home\"></i>\r\n                        <div data-i18n=\"Home\">Home</div>\r\n                    </a>\r\n                </li>\r\n\r\n                <li class=\"menu-item\" id=\"dashboard-menu-item\">\r\n                    <a href=\"${pageContext.request.contextPath}/dashboard\" class=\"menu-link\">\r\n                        <i class=\"menu-icon tf-icons bx bx-bar-chart\"></i>\r\n                        <div data-i18n=\"Dashboard\">Dashboard</div>\r\n                    </a>\r\n                </li>\r\n\r\n            </ul>\r\n        </aside>\r\n        <!-- / Menu -->\r\n\r\n        <!-- / Layout wrapper -->\r\n\r\n        <!-- build:js assets/vendor/js/core.js -->\r\n\r\n        <script src=\"assets/vendor/libs/jquery/jquery.js\"></script>\r\n        <script src=\"assets/vendor/libs/popper/popper.js\"></script>\r\n        <script src=\"assets/vendor/js/bootstrap.js\"></script>\r\n        <script src=\"assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.js\"></script>\r\n        <script src=\"assets/vendor/js/menu.js\"></script>\r\n\r\n        <!-- endbuild -->\r\n\r\n        <!-- Vendors JS -->\r\n        <script src=\"assets/vendor/libs/apex-charts/apexcharts.js\"></script>\r\n\r\n        <!-- Main JS -->\r\n        <script src=\"assets/js/main.js\"></script>\r\n\r\n        <!-- Page JS -->\r\n\r\n        <!-- Place this tag in your head or just before your close body tag. -->\r\n        <script async defer src=\"https://buttons.github.io/buttons.js\"></script>\r\n    </body>\r\n</html>\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/web/WEB-INF/common/sider.jsp b/web/WEB-INF/common/sider.jsp
--- a/web/WEB-INF/common/sider.jsp	(revision d6ad1445e1c07c5da0ab8951156084fe4a182d1f)
+++ b/web/WEB-INF/common/sider.jsp	(date 1721252670159)
@@ -72,12 +72,14 @@
                     <span class="menu-header-text">Administration</span>
                 </li>
                 <!-- Apps -->
-                <li class="menu-item" id="user-menu-item">
-                    <a href="${pageContext.request.contextPath}/user" class="menu-link">
-                        <i class="menu-icon tf-icons bx bx-user"></i>
-                        <div data-i18n="User list">User list</div>
-                    </a>
-                </li>
+                <c:if test="${sessionScope.user.role == 0}">
+                    <li class="menu-item" id="user-menu-item">
+                        <a href="${pageContext.request.contextPath}/user" class="menu-link">
+                            <i class="menu-icon tf-icons bx bx-user"></i>
+                            <div data-i18n="User list">User list</div>
+                        </a>
+                    </li>
+                </c:if>
                 <li class="menu-item" id="subjectlist-menu-item">
                     <a href="${pageContext.request.contextPath}/subjectlist" class="menu-link">
                         <i class="menu-icon tf-icons bx bx-book-open"></i>
Index: src/java/controller/password/ResetPassword.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package controller.password;\r\n\r\nimport controller.encrypt.BCrypt;\r\nimport dal.UserDAO;\r\nimport jakarta.servlet.ServletException;\r\nimport jakarta.servlet.http.HttpServlet;\r\nimport jakarta.servlet.http.HttpServletRequest;\r\nimport jakarta.servlet.http.HttpServletResponse;\r\nimport jakarta.servlet.http.HttpSession;\r\nimport model.user.User;\r\n\r\nimport java.io.IOException;\r\nimport java.sql.SQLException;\r\n\r\n/**\r\n * Servlet for resetting the user's password.\r\n */\r\npublic class ResetPassword extends HttpServlet {\r\n\r\n    /**\r\n     * Processes requests for both HTTP <code>GET</code> and <code>POST</code>\r\n     * methods.\r\n     *\r\n     * @param request servlet request\r\n     * @param response servlet response\r\n     * @throws ServletException if a servlet-specific error occurs\r\n     * @throws IOException if an I/O error occurs\r\n     */\r\n    protected void processRequest(HttpServletRequest request, HttpServletResponse response)\r\n            throws ServletException, IOException {\r\n        UserDAO userDAO = new UserDAO();\r\n        String action = request.getParameter(\"action\");\r\n        if (action != null && action.equals(\"setNewPassword\")) {\r\n            boolean successful = true;\r\n            \r\n            String newPassword = request.getParameter(\"newPassword\");\r\n            String confirmPassword = request.getParameter(\"confirmPassword\");\r\n            int userId = Integer.parseInt(request.getParameter(\"userId\"));\r\n            if (newPassword.isEmpty()) {\r\n                successful = false;\r\n                request.setAttribute(\"newPasswordErr\", \"Password is blank!\");\r\n            }\r\n            if (newPassword.length() > 60) {\r\n                successful = false;\r\n                request.setAttribute(\"newPasswordErr\", \"Password can not exceed 60 characters!\");\r\n            }\r\n            \r\n            if (successful) {\r\n                if (!confirmPassword.equals(newPassword)) {\r\n                    successful = false;\r\n                    request.setAttribute(\"confirmPasswordErr\", \"Password does not match!\");\r\n                } else {\r\n                    try {\r\n                        userDAO.setNewPassword(userId, newPassword);\r\n                    } catch (SQLException e) {\r\n                        successful = false;\r\n                        request.setAttribute(\"err\", \"Failed to set new password, please try again later!\");\r\n                    }\r\n                }\r\n            }\r\n            \r\n            if (successful) {\r\n                response.sendRedirect(\"login.jsp\");\r\n            } else {\r\n                request.setAttribute(\"newPassword\", newPassword);\r\n                request.setAttribute(\"confirmPassword\", confirmPassword);\r\n                request.setAttribute(\"user\", userDAO.getUserById(userId));\r\n                request.getRequestDispatcher(\"setnewpassword.jsp\").forward(request, response);\r\n            }\r\n        } else {\r\n            HttpSession session = request.getSession();\r\n            User user = (User) session.getAttribute(\"user\");\r\n            UserDAO userdao = new UserDAO();\r\n            \r\n            if (user == null) {\r\n                response.sendRedirect(\"login.jsp\");\r\n                return;\r\n            }\r\n            \r\n            String oldpassword = request.getParameter(\"oldpassword\");\r\n            String newpassword = request.getParameter(\"newpassword\");\r\n            String confirmpassword = request.getParameter(\"confirmpassword\");\r\n            \r\n            if (oldpassword == null || newpassword == null || confirmpassword == null) {\r\n                session.setAttribute(\"message\", \"Please fill in all fields.\");\r\n                response.sendRedirect(\"reset-password.jsp\");\r\n            } // Check if the old password is correct\r\n            else if (!BCrypt.checkpw(oldpassword, userdao.getPasswordByEmail(user.getEmail()))) {\r\n                session.setAttribute(\"message\", \"Incorrect password.\");\r\n                response.sendRedirect(\"reset-password.jsp\");\r\n            } else if (!newpassword.equals(confirmpassword)) {\r\n                session.setAttribute(\"message\", \"New passwords do not match.\");\r\n                response.sendRedirect(\"reset-password.jsp\");\r\n            } else {\r\n                \r\n                UserDAO dao = new UserDAO();\r\n                \r\n                try {\r\n                    dao.updatePassword(user.getEmail(), oldpassword, newpassword);\r\n                    session.setAttribute(\"message\", \"Password reset successful.\");\r\n                    response.sendRedirect(\"dashboard.jsp\");\r\n                } catch (Exception e) {\r\n                    session.setAttribute(\"message\", \"Password reset failed: \" + e.getMessage());\r\n                    response.sendRedirect(\"reset-password.jsp\");\r\n                }\r\n            }\r\n        }\r\n    }\r\n    \r\n    @Override\r\n    protected void doGet(HttpServletRequest request, HttpServletResponse response)\r\n            throws ServletException, IOException {\r\n        processRequest(request, response);\r\n    }\r\n    \r\n    @Override\r\n    protected void doPost(HttpServletRequest request, HttpServletResponse response)\r\n            throws ServletException, IOException {\r\n        processRequest(request, response);\r\n    }\r\n    \r\n    @Override\r\n    public String getServletInfo() {\r\n        return \"Handles password reset requests\";\r\n    }\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/java/controller/password/ResetPassword.java b/src/java/controller/password/ResetPassword.java
--- a/src/java/controller/password/ResetPassword.java	(revision d6ad1445e1c07c5da0ab8951156084fe4a182d1f)
+++ b/src/java/controller/password/ResetPassword.java	(date 1721252670148)
@@ -65,7 +65,7 @@
                 request.setAttribute("newPassword", newPassword);
                 request.setAttribute("confirmPassword", confirmPassword);
                 request.setAttribute("user", userDAO.getUserById(userId));
-                request.getRequestDispatcher("setnewpassword.jsp").forward(request, response);
+                request.getRequestDispatcher("/WEB-INF/account/setnewpassword.jsp").forward(request, response);
             }
         } else {
             HttpSession session = request.getSession();
Index: src/java/controller/ContactServlet.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/java/controller/ContactServlet.java b/src/java/controller/ContactServlet.java
new file mode 100644
--- /dev/null	(date 1721252670148)
+++ b/src/java/controller/ContactServlet.java	(date 1721252670148)
@@ -0,0 +1,167 @@
+/*
+ * Click nbfs://nbhost/SystemFileSystem/Templates/Licenses/license-default.txt to change this license
+ * Click nbfs://nbhost/SystemFileSystem/Templates/JSP_Servlet/Servlet.java to edit this template
+ */
+package controller;
+
+import common.EmailValidator;
+import dal.ContactDAO;
+import java.io.IOException;
+import java.io.PrintWriter;
+import jakarta.servlet.ServletException;
+import jakarta.servlet.annotation.WebServlet;
+import jakarta.servlet.http.HttpServlet;
+import jakarta.servlet.http.HttpServletRequest;
+import jakarta.servlet.http.HttpServletResponse;
+import java.sql.SQLException;
+import model.contact.Contact;
+import model.contact.ContactError;
+
+/**
+ *
+ * @author DELL
+ */
+@WebServlet(name = "ContactServlet", urlPatterns = {"/contact"})
+public class ContactServlet extends HttpServlet {
+
+    /**
+     * Processes requests for both HTTP <code>GET</code> and <code>POST</code>
+     * methods.
+     *
+     * @param request servlet request
+     * @param response servlet response
+     * @throws ServletException if a servlet-specific error occurs
+     * @throws IOException if an I/O error occurs
+     */
+    protected void processRequest(HttpServletRequest request, HttpServletResponse response)
+            throws ServletException, IOException {
+        response.setContentType("text/html;charset=UTF-8");
+        try (PrintWriter out = response.getWriter()) {
+            /* TODO output your page here. You may use following sample code. */
+            out.println("<!DOCTYPE html>");
+            out.println("<html>");
+            out.println("<head>");
+            out.println("<title>Servlet ContactServlet</title>");
+            out.println("</head>");
+            out.println("<body>");
+            out.println("<h1>Servlet ContactServlet at " + request.getContextPath() + "</h1>");
+            out.println("</body>");
+            out.println("</html>");
+        }
+    }
+
+    @Override
+    protected void doGet(HttpServletRequest request, HttpServletResponse response)
+            throws ServletException, IOException {
+        doPost(request, response);
+    }
+
+    private void goToPage(HttpServletRequest request, HttpServletResponse response)
+            throws ServletException, IOException {
+        request.getRequestDispatcher("/WEB-INF/contact/contactadmin.jsp")
+                .forward(request, response);
+    }
+
+    private Contact getContactInfo(HttpServletRequest request) {
+        Contact c = new Contact();
+        c.setName(request.getParameter("name"));
+        c.setEmail(request.getParameter("email"));
+        c.setSubject(request.getParameter("subject"));
+        c.setPhone(request.getParameter("phone"));
+        c.setMessage(request.getParameter("message"));
+        return c;
+    }
+
+    private ContactError getContactErrorInfo(Contact c) {
+        boolean error = false;
+        ContactError ce = new ContactError();
+        if ((c.getName().length() < 2) || (c.getName().length() > 60)) {
+            error = true;
+            ce.setNameErr("Please input the Name with length in range of 2 to 60!");
+        } else {
+            if (!c.getName().matches("^[A-Za-z\s]+$")) {
+                error = true;
+                ce.setNameErr("Name contain invalid characters!");
+            }
+        }
+        if ((c.getEmail().length() < 5) || (c.getEmail().length() > 35)) {
+            error = true;
+            ce.setEmailErr("Please enter email from 5-35 characters!");
+        } else {
+            if (!EmailValidator.validate(c.getEmail())) {
+                error = true;
+                ce.setEmailErr("Please enter a valid email!");
+            }
+        }
+        if ((!c.getPhone().matches("0[0-9]{9}")) || (c.getPhone().equals("0000000000"))) {
+            error = true;
+            ce.setPhoneErr("Please enter a valid phone number");
+        }
+        if ((c.getSubject().length() < 5) || (c.getSubject().length() > 50)) {
+            error = true;
+            ce.setSubjectErr("Please input the subject with length in range of 5 to 50!");
+        }
+        if ((c.getMessage().length() < 1) || (c.getMessage().length() > 255)) {
+            error = true;
+            ce.setMessageErr("Please input the message with length in range of 1 to 255!");
+        }
+        if (error) {
+            return ce;
+        } else {
+            return null;
+        }
+    }
+
+    public void contactAdmin(HttpServletRequest request, HttpServletResponse response)
+            throws ServletException, IOException {
+        boolean error = false;
+        String err = "";
+        Contact c = getContactInfo(request);
+        ContactError ce = getContactErrorInfo(c);
+
+        if (ce == null) {
+            try {
+                ContactDAO contactDAO = new ContactDAO();
+                contactDAO.newContact(c);
+            } catch (SQLException e) {
+                error = true;
+                err = "Failed to send message";
+            }
+        }
+
+        if ((error) || (ce != null)) {
+            request.setAttribute("err", err);
+            request.setAttribute("contactErr", ce);
+        } else {
+            request.setAttribute("success", "Message sent successfully!");
+        }
+
+        request.setAttribute("contact", c);
+        request.getRequestDispatcher("/WEB-INF/contact/contactadmin.jsp")
+                .forward(request, response);
+    }
+
+    @Override
+    protected void doPost(HttpServletRequest request, HttpServletResponse response)
+            throws ServletException, IOException {
+        String action = request.getParameter("action");
+        if (action != null) {
+            switch (request.getParameter("action")) {
+                case "enterInfo":
+                    contactAdmin(request, response);
+                    break;
+                default:
+                    goToPage(request, response);
+                    break;
+            }
+        } else {
+            goToPage(request, response);
+        }
+    }
+
+    @Override
+    public String getServletInfo() {
+        return "Short description";
+    }// </editor-fold>
+
+}
Index: src/java/dal/UserDAO.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package dal;\r\n\r\nimport controller.encrypt.BCrypt;\r\nimport model.user.User;\r\n\r\nimport java.io.Serializable;\r\nimport java.sql.Connection;\r\nimport java.sql.PreparedStatement;\r\nimport java.sql.ResultSet;\r\nimport java.sql.SQLException;\r\nimport java.util.ArrayList;\r\n\r\nimport model.user.Role;\r\n\r\npublic class UserDAO extends DBContext implements Serializable {\r\n\r\n    public void userSignUp(User user, String password) throws SQLException {\r\n        Connection conn = null;\r\n        PreparedStatement ps = null;\r\n        ResultSet rs = null;\r\n\r\n        try {\r\n            conn = connection;\r\n\r\n            // SQL query to insert a new user, including the status column\r\n            String query = \"INSERT INTO `user` (name, email, avt, password, role, status) \"\r\n                    + \"VALUES (?, ?, ?, ?, ?, ?)\";\r\n\r\n            // Create a prepared statement with auto-generated keys\r\n            ps = conn.prepareStatement(query, PreparedStatement.RETURN_GENERATED_KEYS);\r\n            ps.setString(1, user.getName());\r\n            ps.setString(2, user.getEmail());\r\n            ps.setString(3, user.getAvatar());\r\n            String hashedpw = BCrypt.hashpw(password, BCrypt.gensalt(12));\r\n            ps.setString(4, hashedpw);\r\n            ps.setInt(5, user.getRole());\r\n            ps.setInt(6, user.getStatus());\r\n\r\n            // Execute the query\r\n            int affectedRows = ps.executeUpdate();\r\n\r\n            // Check if any rows were affected (user inserted successfully)\r\n            if (affectedRows == 0) {\r\n                throw new SQLException(\"User sign-up failed, no rows affected.\");\r\n            }\r\n\r\n            // Retrieve the auto-generated key (id)\r\n            rs = ps.getGeneratedKeys();\r\n            if (rs.next()) {\r\n                user.setId(rs.getInt(1)); // Set the generated id back to the User object\r\n            }\r\n        } finally {\r\n            // Close the ResultSet, PreparedStatement, and Connection\r\n            if (rs != null) {\r\n                rs.close();\r\n            }\r\n            if (ps != null) {\r\n                ps.close();\r\n            }\r\n            if (conn != null) {\r\n                conn.close();\r\n            }\r\n        }\r\n    }\r\n\r\n    public User login(String email, String password) throws SQLException {\r\n        Connection conn = null;\r\n        PreparedStatement ps = null;\r\n        ResultSet rs = null;\r\n        User user;\r\n\r\n        try {\r\n            conn = connection;\r\n\r\n            String query = \"SELECT * FROM `user` WHERE email = ?\";\r\n            ps = conn.prepareStatement(query);\r\n            ps.setString(1, email);\r\n\r\n            rs = ps.executeQuery();\r\n            user = new User();\r\n\r\n            if (rs.next() && checkEmailExist(email)) {\r\n                if ((BCrypt.checkpw(password, rs.getString(\"password\")))) {\r\n                    user.setId(rs.getInt(\"id\"));\r\n                    user.setName(rs.getString(\"name\"));\r\n                    user.setEmail(rs.getString(\"email\"));\r\n                    user.setAvatar(rs.getString(\"avt\"));\r\n                    int role = rs.getInt(\"role\");\r\n                    user.setRole(role);\r\n                    user.setR(getRole(role));\r\n                    user.setStatus(rs.getInt(\"status\")); // Set status from DB\r\n                }\r\n            } else if (!checkEmailExist(email)) {\r\n                user = null;\r\n            }\r\n        } finally {\r\n            if (rs != null) {\r\n                rs.close();\r\n            }\r\n            if (ps != null) {\r\n                ps.close();\r\n            }\r\n            if (conn != null) {\r\n                conn.close();\r\n            }\r\n        }\r\n\r\n        return user;\r\n    }\r\n\r\n    public User loginGoogle(String email) throws SQLException {\r\n        Connection conn = null;\r\n        PreparedStatement ps = null;\r\n        ResultSet rs = null;\r\n        User user = null;\r\n\r\n        try {\r\n            conn = connection;\r\n\r\n            String query = \"SELECT * FROM `user` WHERE email = ?\";\r\n            ps = conn.prepareStatement(query);\r\n            ps.setString(1, email);\r\n\r\n            rs = ps.executeQuery();\r\n            if (rs.next()) {\r\n                user = new User();\r\n                user.setId(rs.getInt(\"id\"));\r\n                user.setName(rs.getString(\"name\"));\r\n                user.setEmail(rs.getString(\"email\"));\r\n                user.setAvatar(rs.getString(\"avt\"));\r\n                user.setRole(rs.getInt(\"role\"));\r\n                user.setStatus(rs.getInt(\"status\")); // Set status from DB\r\n            }\r\n        } finally {\r\n            if (rs != null) {\r\n                rs.close();\r\n            }\r\n            if (ps != null) {\r\n                ps.close();\r\n            }\r\n            if (conn != null) {\r\n                conn.close();\r\n            }\r\n        }\r\n\r\n        return user;\r\n    }\r\n\r\n    public void updateUserAvatar(int userId, String avatar) throws SQLException {\r\n        Connection conn = null;\r\n        PreparedStatement ps = null;\r\n\r\n        try {\r\n            conn = connection;\r\n            String query = \"UPDATE `user` SET avt = ? WHERE id = ?\";\r\n            ps = conn.prepareStatement(query);\r\n            ps.setString(1, avatar);\r\n            ps.setInt(2, userId);\r\n            ps.executeUpdate();\r\n        } finally {\r\n            if (ps != null) {\r\n                ps.close();\r\n            }\r\n            if (conn != null) {\r\n                conn.close();\r\n            }\r\n        }\r\n    }\r\n\r\n    private Role getRole(int id) {\r\n        String sql = \"select * from role where id = ?;\";\r\n        Role r;\r\n        try {\r\n            PreparedStatement st = connection.prepareStatement(sql);\r\n            st.setInt(1, id);\r\n            ResultSet rs = st.executeQuery();\r\n            if (rs.next()) {\r\n                r = new Role();\r\n                r.setId(id);\r\n                r.setName(rs.getString(\"name\"));\r\n                return r;\r\n            }\r\n        } catch (SQLException e) {\r\n            System.out.println(e.getMessage());\r\n        }\r\n        return null;\r\n    }\r\n\r\n    private User getUserInfo(ResultSet rs) throws SQLException {\r\n        User u = new User();\r\n        u.setId(rs.getInt(\"id\"));\r\n        u.setName(rs.getString(\"name\"));\r\n        u.setEmail(rs.getString(\"email\"));\r\n        u.setAvatar(rs.getString(\"avt\"));\r\n        u.setStatus(rs.getInt(\"status\"));\r\n        int roleId = rs.getInt(\"role\");\r\n        u.setRole(roleId);\r\n        u.setR(getRole(roleId));\r\n        u.setDateCreated(rs.getDate(\"date_created\"));\r\n        return u;\r\n    }\r\n\r\n    public ArrayList<User> getAllUsers() {\r\n        String sql = \"select * from user where role > 0;\";\r\n        ArrayList<User> list = new ArrayList<>();\r\n        try {\r\n            PreparedStatement st = connection.prepareStatement(sql);\r\n            ResultSet rs = st.executeQuery();\r\n            while (rs.next()) {\r\n                User u = getUserInfo(rs);\r\n                list.add(u);\r\n            }\r\n        } catch (SQLException e) {\r\n            System.out.println(e.getMessage());\r\n        }\r\n        return list;\r\n    }\r\n\r\n    public int getNumberOfStudents() {\r\n        String sql = \"SELECT COUNT(*) AS number FROM `user` WHERE role = 3\";\r\n        int count = 0;\r\n        try {\r\n            PreparedStatement st = connection.prepareStatement(sql);\r\n            ResultSet rs = st.executeQuery();\r\n            if (rs.next()) {\r\n                count = rs.getInt(\"number\");\r\n            }\r\n        } catch (SQLException e) {\r\n            System.out.println(e.getMessage());\r\n        }\r\n        return count;\r\n    }\r\n\r\n    public int getNumberOfTeachers() {\r\n        String sql = \"SELECT COUNT(*) AS number FROM `user` WHERE role = 2\";\r\n        int count = 0;\r\n        try {\r\n            PreparedStatement st = connection.prepareStatement(sql);\r\n            ResultSet rs = st.executeQuery();\r\n            if (rs.next()) {\r\n                count = rs.getInt(\"number\");\r\n            }\r\n        } catch (SQLException e) {\r\n            System.out.println(e.getMessage());\r\n        }\r\n        return count;\r\n    }\r\n\r\n    public ArrayList<User> getAllAccount() {\r\n        ArrayList<User> list = new ArrayList<>();\r\n\r\n        String query = \"SELECT * FROM user;\";\r\n        try {\r\n            PreparedStatement ps = connection.prepareStatement(query);\r\n            ResultSet rs = ps.executeQuery();\r\n            while (rs.next()) {\r\n                User s = new User();\r\n                s.setId(rs.getInt(\"id\"));\r\n                s.setName(rs.getString(\"name\"));\r\n                s.setEmail(rs.getString(\"email\"));\r\n                s.setRole(rs.getInt(\"role\"));\r\n                s.setAvatar(rs.getString(\"avt\"));\r\n                s.setStatus(rs.getInt(\"status\"));\r\n                list.add(s);\r\n            }\r\n        } catch (SQLException e) {\r\n            System.out.println(e.getMessage());\r\n        }\r\n        return list;\r\n    }\r\n\r\n    public User getUserByID(int Id) {\r\n\r\n        User user = new User();\r\n        String query = \"select * from user where Id= ?\";\r\n\r\n        try {\r\n            PreparedStatement ps;\r\n            ResultSet rs;\r\n            if (connection != null) {\r\n                ps = connection.prepareStatement(query);\r\n                ps.setInt(1, Id);\r\n                rs = ps.executeQuery();\r\n                while (rs.next()) {\r\n                    user.setId(rs.getInt(1));\r\n                    user.setName(rs.getString(2));\r\n                    user.setEmail(rs.getString(3));\r\n                    int role = rs.getInt(5);\r\n                    user.setRole(role);\r\n                    user.setAvatar(rs.getString(6));\r\n                    user.setR(getRole(role));\r\n                }\r\n            }\r\n        } catch (SQLException ignored) {\r\n        }\r\n        return user;\r\n    }\r\n\r\n    public void updatePassword(String email, String currentPassword, String newPassword) throws SQLException {\r\n        Connection conn = null;\r\n        PreparedStatement psSelect = null;\r\n        PreparedStatement psUpdate = null;\r\n        ResultSet rs = null;\r\n        User user;\r\n\r\n        try {\r\n            // Assuming `connection` is a valid Connection object\r\n            conn = connection;\r\n\r\n            // Step 1: Verify the user's current password\r\n            String selectQuery = \"SELECT * FROM `user` WHERE email = ?\";\r\n            psSelect = conn.prepareStatement(selectQuery);\r\n            psSelect.setString(1, email);\r\n\r\n            rs = psSelect.executeQuery();\r\n            if (rs.next()) {\r\n                if (BCrypt.checkpw(currentPassword, rs.getString(\"password\"))) {\r\n                    // Step 2: Update the user's password\r\n                    String updateQuery = \"UPDATE `user` SET password = ? WHERE email = ?\";\r\n                    psUpdate = conn.prepareStatement(updateQuery);\r\n                    newPassword = BCrypt.hashpw(newPassword, BCrypt.gensalt(12));\r\n                    psUpdate.setString(1, newPassword);\r\n                    psUpdate.setString(2, email);\r\n                    psUpdate.executeUpdate();\r\n\r\n                    // Step 3: Retrieve the updated user\r\n                    user = new User();\r\n                    user.setId(rs.getInt(\"id\"));\r\n                    user.setName(rs.getString(\"name\"));\r\n                    user.setEmail(rs.getString(\"email\"));\r\n                    user.setAvatar(rs.getString(\"avt\"));\r\n                    user.setRole(rs.getInt(\"role\"));\r\n                }\r\n            }\r\n        } catch (SQLException e) {\r\n            throw new RuntimeException(e);\r\n        } finally {\r\n            // Close ResultSet\r\n            if (rs != null) {\r\n                rs.close();\r\n            }\r\n            // Close PreparedStatements\r\n            if (psSelect != null) {\r\n                psSelect.close();\r\n            }\r\n            if (psUpdate != null) {\r\n                psUpdate.close();\r\n            }\r\n            // Close Connection\r\n            if (conn != null) {\r\n                conn.close();\r\n            }\r\n        }\r\n\r\n    }\r\n\r\n    public void resetPassword(String email, String newpassword) {\r\n        String query = \"UPDATE user SET password = ? WHERE email = ?\";\r\n        try {\r\n            PreparedStatement ps = connection.prepareStatement(query);\r\n            newpassword = BCrypt.hashpw(newpassword, BCrypt.gensalt(12));\r\n            ps.setString(1, newpassword);\r\n            ps.setString(2, email);\r\n            ps.executeUpdate();\r\n        } catch (SQLException e) {\r\n            System.out.println(e.getMessage());\r\n        }\r\n    }\r\n\r\n    public Boolean checkEmailExist(String email) {\r\n        String query = \"SELECT * FROM user WHERE email = ?\";\r\n        try {\r\n            PreparedStatement ps = connection.prepareStatement(query);\r\n            ps.setString(1, email);\r\n            ResultSet rs = ps.executeQuery();\r\n            if (rs.next()) {\r\n                return true;\r\n            }\r\n        } catch (SQLException e) {\r\n            System.out.println(e.getMessage());\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    public String getPasswordByEmail(String email) {\r\n        String query = \"SELECT password FROM user WHERE email = ?\";\r\n        try {\r\n            PreparedStatement ps = connection.prepareStatement(query);\r\n            ps.setString(1, email);\r\n            ResultSet rs = ps.executeQuery();\r\n            if (rs.next()) {\r\n                return rs.getString(\"password\");\r\n            }\r\n        } catch (SQLException e) {\r\n            System.out.println(e.getMessage());\r\n        }\r\n        return null;\r\n    }\r\n\r\n    private int getStatusById(int id) {\r\n        String sql = \"select status from `user` where id = ?;\";\r\n        try {\r\n            PreparedStatement st = connection.prepareStatement(sql);\r\n            st.setInt(1, id);\r\n            ResultSet rs = st.executeQuery();\r\n            if (rs.next()) {\r\n                return rs.getInt(\"status\");\r\n            }\r\n        } catch (SQLException e) {\r\n            System.out.println(e.getMessage());\r\n        }\r\n        return -1;\r\n    }\r\n\r\n    public void changeUserStatus(int id) {\r\n        int newStatus;\r\n        if (getStatusById(id) == 1) {\r\n            newStatus = 0;\r\n        } else {\r\n            newStatus = 1;\r\n        }\r\n        String sql = \"update `user` set status = ? where id = ?;\";\r\n        try {\r\n            PreparedStatement st = connection.prepareStatement(sql);\r\n            st.setInt(1, newStatus);\r\n            st.setInt(2, id);\r\n            st.execute();\r\n        } catch (SQLException e) {\r\n            System.out.println(e.getMessage());\r\n        }\r\n    }\r\n\r\n    public ArrayList<Role> getAllRoles() {\r\n        ArrayList<Role> list = new ArrayList<>();\r\n        String sql = \"select * from `role`;\";\r\n        try {\r\n            PreparedStatement st = connection.prepareStatement(sql);\r\n            ResultSet rs = st.executeQuery();\r\n            while (rs.next()) {\r\n                Role role = new Role();\r\n                role.setId(rs.getInt(\"id\"));\r\n                role.setName(rs.getString(\"name\"));\r\n                list.add(role);\r\n            }\r\n        } catch (SQLException e) {\r\n            System.out.println(e.getMessage());\r\n        }\r\n        return list;\r\n    }\r\n\r\n    public User getUserById(int id) {\r\n        String sql = \"select * from user where id = ?\";\r\n        try {\r\n            PreparedStatement st = connection.prepareStatement(sql);\r\n            st.setInt(1, id);\r\n            ResultSet rs = st.executeQuery();\r\n            if (rs.next()) {\r\n                return getUserInfo(rs);\r\n            }\r\n        } catch (SQLException e) {\r\n            System.out.println(e.getMessage());\r\n        }\r\n        return null;\r\n    }\r\n\r\n    public void updateUser(User u) throws SQLException {\r\n        String sql = \"update user set role = ?, name = ? where id = ?\";\r\n        PreparedStatement st = connection.prepareStatement(sql);\r\n        st.setInt(1, u.getRole());\r\n        st.setString(2, u.getName());\r\n        st.setInt(3, u.getId());\r\n        st.execute();\r\n    }\r\n\r\n    public void updateAvatar(User u) throws SQLException {\r\n        String sql = \"update user set avt = ? where id = ?;\";\r\n        PreparedStatement st = connection.prepareStatement(sql);\r\n        st.setString(1, u.getAvatar());\r\n        st.setInt(2, u.getId());\r\n        st.execute();\r\n    }\r\n\r\n    public boolean isAvtExist(String uri) {\r\n        String sql = \"select * from user where avt = ?;\";\r\n        try {\r\n            PreparedStatement st = connection.prepareStatement(sql);\r\n            st.setString(1, uri);\r\n            ResultSet rs = st.executeQuery();\r\n            if (rs.next()) {\r\n                return true;\r\n            }\r\n        } catch (SQLException e) {\r\n            System.out.println(e.getMessage());\r\n        }\r\n        return false;\r\n    }\r\n\r\n    public void addUser(User user, String password) throws SQLException {\r\n        String sql = \"INSERT INTO `user` (name, email, avt, password, role, status)\"\r\n                + \"VALUES (?, ?, ?, ?, ?, ?)\";\r\n        PreparedStatement st = connection.prepareStatement(sql);\r\n        st.setString(1, user.getName());\r\n        st.setString(2, user.getEmail());\r\n        st.setString(3, user.getAvatar());\r\n        String hashedpw = BCrypt.hashpw(password, BCrypt.gensalt(12));\r\n        st.setString(4, hashedpw);\r\n        st.setInt(5, user.getRole());\r\n        st.setInt(6, user.getStatus());\r\n        st.execute();\r\n    }\r\n\r\n    public void setNewPassword(int userId, String newPassword) throws SQLException {\r\n        String sql = \"update user set password = ?, status = 1 where id = ?\";\r\n        PreparedStatement st = connection.prepareStatement(sql);\r\n        String hashedpw = BCrypt.hashpw(newPassword, BCrypt.gensalt(12));\r\n        st.setString(1, hashedpw);\r\n        st.setInt(2, userId);\r\n        st.execute();\r\n    }\r\n\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/java/dal/UserDAO.java b/src/java/dal/UserDAO.java
--- a/src/java/dal/UserDAO.java	(revision d6ad1445e1c07c5da0ab8951156084fe4a182d1f)
+++ b/src/java/dal/UserDAO.java	(date 1721252670148)
@@ -9,7 +9,7 @@
 import java.sql.ResultSet;
 import java.sql.SQLException;
 import java.util.ArrayList;
-
+import model.subject.Subject;
 import model.user.Role;
 
 public class UserDAO extends DBContext implements Serializable {
@@ -145,27 +145,27 @@
 
         return user;
     }
-
-    public void updateUserAvatar(int userId, String avatar) throws SQLException {
-        Connection conn = null;
-        PreparedStatement ps = null;
-
-        try {
-            conn = connection;
-            String query = "UPDATE `user` SET avt = ? WHERE id = ?";
-            ps = conn.prepareStatement(query);
-            ps.setString(1, avatar);
-            ps.setInt(2, userId);
-            ps.executeUpdate();
-        } finally {
-            if (ps != null) {
-                ps.close();
-            }
-            if (conn != null) {
-                conn.close();
-            }
-        }
-    }
+//
+//    public void updateUserAvatar(int userId, String avatar) throws SQLException {
+//        Connection conn = null;
+//        PreparedStatement ps = null;
+//
+//        try {
+//            conn = connection;
+//            String query = "UPDATE `user` SET avt = ? WHERE id = ?";
+//            ps = conn.prepareStatement(query);
+//            ps.setString(1, avatar);
+//            ps.setInt(2, userId);
+//            ps.executeUpdate();
+//        } finally {
+//            if (ps != null) {
+//                ps.close();
+//            }
+//            if (conn != null) {
+//                conn.close();
+//            }
+//        }
+//    }
 
     private Role getRole(int id) {
         String sql = "select * from role where id = ?;";
@@ -518,5 +518,38 @@
         st.setInt(2, userId);
         st.execute();
     }
+
+    public ArrayList<Subject> getAllSubjectsInCharged(int id) {
+        SubjectDAO subjectDAO = new SubjectDAO();
+        String sql = "select * from subject_in_charged where user_id = ?;";
+        ArrayList<Subject> ret = new ArrayList<>();
+        try {
+            PreparedStatement st = connection.prepareStatement(sql);
+            st.setInt(1, id);
+            ResultSet rs = st.executeQuery();
+            while (rs.next()) {
+                ret.add(subjectDAO.getSubjectMatchId(rs.getInt("subject_id")));
+            }
+        } catch (SQLException e) {
+            System.out.println(e.getMessage());
+        }
+        return ret;
+    }
+
+    public void assignSubject(int userId, int subjectId) throws SQLException {
+        String sql = "insert into subject_in_charged (user_id, subject_id) values (?,?);";
+        PreparedStatement st = connection.prepareStatement(sql);
+        st.setInt(1, userId);
+        st.setInt(2, subjectId);
+        st.execute();
+    }
+    
+    public void removeAssignedSubject(int userId, int subjectId) throws SQLException{
+        String sql = "delete from subject_in_charged where user_id = ? and subject_id = ?;";
+        PreparedStatement st = connection.prepareStatement(sql);
+        st.setInt(1, userId);
+        st.setInt(2, subjectId);
+        st.execute();
+    }
 
 }
Index: src/java/common/MaterialHandler.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/java/common/MaterialHandler.java b/src/java/common/MaterialHandler.java
new file mode 100644
--- /dev/null	(date 1721252670148)
+++ b/src/java/common/MaterialHandler.java	(date 1721252670148)
@@ -0,0 +1,44 @@
+package common;
+
+import dal.MaterialDAO;
+import jakarta.servlet.http.Part;
+import java.io.File;
+import java.io.IOException;
+import java.sql.SQLException;
+import model.Material;
+
+public class MaterialHandler {
+    
+    static MaterialDAO materialDAO = new MaterialDAO();
+    
+    private static void removeMaterialFile(String workingDir, String uri) {
+        File file = new File(workingDir + "\\" + uri.replace("/", "\\"));
+        if (file.exists()) {
+            file.delete();
+        }
+    }
+    
+    public static void addMaterial(int lessonId, String workingFolder,
+            String workingDir, Part filePart)
+            throws IOException, SQLException {
+        FileHandler fileHandler = new FileHandler(workingFolder);
+        String uri = fileHandler.fileUpload(workingDir, filePart);
+        uri = ("" + uri).replace("\\", "/");
+        
+        if (!materialDAO.isMaterialExist(lessonId, uri)) {
+            materialDAO.insertMaterial(lessonId, uri);
+        }
+    }
+    
+    public static void removeMaterial(int lessonId, int materialId, String workingDir) throws SQLException {
+        materialDAO.removeFromMaterial_Lesson(lessonId, materialId);
+        if (!materialDAO.isMaterialUsed(materialId)) {
+            Material m = materialDAO.getMaterialMatchId(materialId);
+            if (m != null) {
+                materialDAO.removeMaterial(m);
+                removeMaterialFile(workingDir, m.getUri());
+            }
+        }
+    }
+    
+}
Index: src/java/model/material/Material.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/java/model/material/Material.java b/src/java/model/Material.java
rename from src/java/model/material/Material.java
rename to src/java/model/Material.java
--- a/src/java/model/material/Material.java	(revision d6ad1445e1c07c5da0ab8951156084fe4a182d1f)
+++ b/src/java/model/Material.java	(date 1721252670159)
@@ -1,26 +1,17 @@
-package model.material;
+package model;
 
 public class Material {
 
     int id;
-    String uri, name, webUri;
+    String uri, name;
 
     public Material() {
     }
 
-    public Material(int id, String uri, String name, String webUri) {
+    public Material(int id, String uri, String name) {
         this.id = id;
         this.uri = uri;
         this.name = name;
-        this.webUri = webUri;
-    }
-
-    public String getWebUri() {
-        return webUri;
-    }
-
-    public void setWebUri(String webUri) {
-        this.webUri = webUri;
     }
 
     public int getId() {
